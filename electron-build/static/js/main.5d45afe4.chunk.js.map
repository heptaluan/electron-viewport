{"version":3,"sources":["components/common/IconFont/iconFont.js","hook/useWindowSize.js","util/index.js","components/common/CustomOverlay/CustomOverlay.js","components/ViewerMain/ViewerMain.js","components/LeftSidePanel/LeftSidePanel.js","components/common/IconFont/index.js","components/ModalContent/ModalContent.js","components/Toolbar/Toolbar.js","components/MiddleSidePanel/MiddleSidePanel.js","components/common/MarkNoduleTool/toolColors.js","components/common/MarkNoduleTool/toolStyle.js","components/common/MarkNoduleTool/util.js","components/common/MarkNoduleTool/MarkNoduleTool.js","components/common/AddNoduleTool/toolColors.js","components/common/AddNoduleTool/toolStyle.js","components/common/AddNoduleTool/util.js","components/common/AddNoduleTool/AddNoduleTool.js","components/common/AddNewNode/AddNewNode.js","util/sqlite.js","pages/Viewer/Viewer.js","components/About/About.js","components/SelectFile/SelectFile.js","pages/StudyList/StudyList.js","App.js","reportWebVitals.js","initCornerstone.js","index.js"],"names":["a","h","t","l","c","o","i","e","document","getElementsByTagName","length","getAttribute","__iconfont__svg__cssinject__","write","console","log","n","createElement","innerHTML","setAttribute","style","position","width","height","overflow","body","firstChild","parentNode","insertBefore","v","appendChild","addEventListener","indexOf","readyState","setTimeout","removeEventListener","attachEvent","s","documentElement","doScroll","onreadystatechange","window","useWindowSize","useState","clientWidth","clientHeight","size","setSize","onResize","useCallback","useEffect","readFileInfo","file","arrayBuffer","fs","readFileSync","path","buffer","dcmjs","data","DicomMessage","readFile","dicomDateTimeToLocale","dateTime","divide","date","Date","substring","time","localeDate","toLocaleDateString","dicomTimeToLocale","formatFile","fileList","imagesIDConfig","existsSync","fileName","split","pop","File","type","imageId","cornerstoneWADOImageLoader","wadouri","fileManager","add","push","downloadFile","sheet","XLSX","json_to_sheet","wb","book_new","book_append_sheet","workbookBlob","workbook2blob","openDownload","blob","Blob","URL","createObjectURL","event","aLink","href","download","MouseEvent","createEvent","initMouseEvent","dispatchEvent","workbook","wbout","bookType","bookSST","s2ab","buf","ArrayBuffer","view","Uint8Array","charCodeAt","CustomOverlay","props","setData","cornerstone","loadImage","then","image","name","string","birth","patientId","sex","hospital","studyID","day","seriesNo","seriesDescription","sliceThickness","sliceLocation","Rowsize","rows","Colsize","columns","age","toString","slice","getFullYear","Number","className","textAlign","imageIndex","stackSize","scale","toFixed","windowWidth","windowCenter","display","flexDirection","justifyContent","ViewerThumbnail","canvasRef","imageIdIndex","createRef","isLoading","setLoading","setImage","renderToCanvas","current","dcmID","res","catch","err","ref","minWidth","minHeight","flex","ViewerMain","viewportOverlayComponent","onElementEnabled","elementEnabledEvt","handleElementEnabledEvt","imageIds","imagesConfig","LeftSidePanel","thumbnailList","setThumbnailList","tempList","patientInfo","seriesInfo","methods","item","map","index","active","getSelectedSeries","onClick","cover","color","frameNum","key","IconFont","createFromIconfontCN","scriptUrl","iconfont","ModalContent","TabPane","Tabs","input1","setInput1","input2","setInput2","searchCurrent","setSearchCurrent","dict","meta","dcmHTML","thisData","setThisData","info","selectedPath","rawInfo","globalData","framePath","DataView","formatRawData","rawInfoBoxFormat","daikon","Series","parseImage","pr","textFormat","txt","onSearch","pageIndex","next","lowerTxt","toLowerCase","markArr","innerClassName","instance","Mark","querySelectorAll","unmark","mark","element","innerTxt","textContent","includes","scrollIntoView","content","temp","replaceAll","inputChange","target","value","defaultActiveKey","centered","onChange","tab","placeholder","allowClear","icon","ArrowUpOutlined","ArrowDownOutlined","dangerouslySetInnerHTML","__html","toolbarList","id","text","fontSize","checked","filter","Toolbar","visible","setVisible","state","setstate","setShowViewer","handleToolbarClick","title","handleExportExcel","marginRight","onOk","onCancel","bodyStyle","destroyOnClose","footer","TextArea","Input","MiddleSidePanel","suggest","setSuggest","textAreaRef","noduleSuggest","column","Item","label","patientName","patientGender","patientBirthday","patientID","acquisitionDate","noduleList","disabled","num","onCheckChange","handleListClick","lung","lobe","okText","cancelText","placement","onConfirm","handleDeleteNode","noduleNum","bordered","maxLength","resize","handleTextareaOnChange","defaultColor","activeColor","fillColor","toolColors","setFillColor","getFillColor","setToolColor","getToolColor","setActiveColor","getActiveColor","getColorIfActive","defaultWidth","activeWidth","toolStyle","setToolWidth","getToolWidth","setActiveWidth","getActiveWidth","getToolState","toolName","getEnabledElement","toolStateManager","getElementToolStateManager","get","rotatePoint","point","center","angle","angleRadians","Math","PI","x","cos","sin","y","context","options","fn","lineWidth","fillStyle","lineDash","shouldDrawLines","beginPath","strokeStyle","undefined","setLineDash","fill","stroke","drawRect","corner1","corner2","coordSystem","initialRotation","pixelToCanvas","viewport","getViewport","translation","rotation","centerPoint","abs","w","min","corner3","corner4","moveTo","lineTo","calculateSUV","storedPixelValue","skipRescale","patientStudyModule","metaData","seriesModule","modality","modalityPixelValue","slope","intercept","patientWeight","petSequenceModule","radiopharmaceuticalInfo","startTime","radiopharmaceuticalStartTime","totalDose","radionuclideTotalDose","halfLife","radionuclideHalfLife","seriesAcquisitionTime","seriesTime","acquisitionTimeInSeconds","fracToDec","fractionalSeconds","seconds","minutes","hours","injectionStartTimeInSeconds","durationInSeconds","correctedDose","exp","suv","fractionalValue","parseFloat","MarkNoduleTool","defaultProps","supportedInteractionTypes","configuration","drawHandles","drawHandlesOnHover","hideHandlesIfMoving","renderDashed","eventData","invalidated","handles","start","currentPoints","highlight","end","coords","interactionType","pixelSpacing","imagePlane","rowPixelSpacing","rowImagePixelSpacing","colPixelSpacing","columnPixelSpacing","colImagePixelSpacing","getPixelSpacing","stats","meanStdDevSUV","roiCoordinates","startHandle","endHandle","left","top","roiMeanStdDev","sp","rectangle","sum","sumSquared","count","max","mean","variance","stdDev","sqrt","_calculateRectangleStats","getPixels","area","perimeter","_calculateStats","cachedStats","evt","toolData","currentTarget","this","detail","save","restore","draw","canvas","getContext","setTransform","getNewContext","canvasContext","rectOptions","csTools","importInternal","AddNoduleTool","Option","Select","AddNewNode","findIndex","getImage","cornerstoneElement","toolList","Group","updateToolList","onLungChange","uuid","onLobeChange","val","marginTop","handleToolListTextareaChange","onBlur","handleToolListTextareaBlur","winston","dbSlot","backupTimer","logger","createLogger","level","format","combine","timestamp","printf","message","transports","filename","resourceDir","resolve","dbDir","backupDBDir","filePath","join","sqlite","verbose","resourceExists","backupExists","exists","mkdirSync","days","fileStats","statSync","now","timeInterval","readdirSync","fsList","forEach","ele","sort","b","getTime","birthtimeMs","calculateDate","isNaN","backupInterval","timeName","destination","copyFile","backupDBFile","openSync","sqlite3","Database","createTable","sql","serialize","run","insertData","objects","callback","stmt","prepare","k","hasOwnProperty","finalize","queryData","all","deleteTableSql","SQLContainer","queryStudyByPatientID","DBFunction","querySeriesByStudyID","queryNodeList","queryAllNodeList","querySeriesSuggest","studyId","Viewer","setImagesConfig","setNoduleList","noduleMapList","setNoduleMapList","setNoduleSuggest","currentImageIdIndex","setCurrentImageIdIndex","setCornerstoneElement","setPatientID","nodeRef","useRef","find","imageIDList","formatNodeData","resultInfo","nodulesList","nodulesMapList","nodeBox","noduleName","lungLocation","lobeLocation","featureLabel","featureLabelG","startX","startY","endX","endY","addNodeTool","checkItme","cornerstoneTools","clearToolState","checkNode","measurementData","addToolState","updateImage","handleCheckedListClick","el","corElement","changeActiveImage","setToolActive","mouseButtonMask","changeToolActive","hflip","setViewport","vflip","playClip","stopClip","reset","displayImage","addStackStateManager","saveResults","postData","formatPostData","success","draggleRef","React","modalVisible","setModalVisible","modalDisabled","setModalDisabled","bottom","right","modalBounds","setModalBounds","setToolList","showMarkDialog","tool","getElementById","classList","contains","formatNewNodeData","handleCloseCallback","removeToolState","exportData","selectedSeries","toolFlag","newImage","curImageId","WwwcTool","addTool","StackScrollMouseWheelTool","RectangleRoiTool","EraserTool","MagnifyTool","EllipticalRoiTool","AngleTool","LengthTool","PanTool","ZoomTool","setToolEnable","activeTool","querySelector","dataset","setActiveToolState","params","axios","post","stopPropagation","noduleIndex","noduleMapIndex","splice","cursor","onMouseOver","onMouseOut","onFocus","maskClosable","warn","newNoduleList","newNoduleMapList","modalRender","modal","bounds","onStart","uiData","targetRect","getBoundingClientRect","About","SelectFile","CDVisible","setCDVisible","importFailed","setImportFailed","importSucceed","setImportSucceed","importDuplicated","setImportDuplicated","importSucceedCounter","setImportSucceedCounter","importFailedCounter","setImportFailedCounter","importDuplicatedCounter","setImportDuplicatedCounter","fileAmount","setFileAmount","isSeriesDuplicate","dicomList","patientList","studyList","seriesList","creatPatient","theDay","Value","theTime","replace","institution","deviceManufacturer","deviceModelName","addTime","studyNum","studyInfo","createStudy","studyIDFormat","studyDescription","sequenceNum","createSeries","seriesNoFormat","layer","instanceNumber","importHandler","inputObj","removeChild","openDir","click","checkDICMType","dicmBox","reader","FileReader","Promise","reject","readAsArrayBuffer","onload","DONE","array","result","String","fromCharCode","uploadData","createInstanceList","list","toLocaleString","seriesInstanceUID","queryInstanceData","decodeFileList","dicomDict","ciod","prev","specialID","patientPartInLocal","studyPartInLocal","seriesPartInLocal","checkDICOMIntegrity","createInstance","indexKey","indexPatient","indexStudy","indexSeries","createDBTables","studyEle","sEle","pEle","removeDuplicates","warning","allSeries","files","fileArr","Set","tempArr","Array","from","promises","reason","error","CheckCircleTwoTone","twoToneColor","ExclamationCircleTwoTone","dicomColumns","dataIndex","defaultSortOrder","sorter","testColumns","render","listColumns","StudyList","patientData","setPatientData","studyData","setStudyData","seriesData","setSeriesData","selectedData","setSelectedData","selectedRows","setSelectedRows","searchData","setSearchData","getDicomFromDB","getStudyFromDB","getSeriesFromDB","loading","isSeriesGetAll","queryInstanceByStudyID","sortPathByInstanceNumber","seriesGetAll","instanceNumbers","paths","returnIndex","indices","keys","getAllByPatientID","selectedIndex","isArray","rowSelection","selectedRowKeys","getCheckboxProps","record","handleSearch","queryPatientList","selectedRowStyle","resource","styleActive","addDicomFromUpload","concat","patientCallback","res1","res2","res3","dataSource","showSorterTooltip","rowClassName","onRow","patientRowClicked","onDoubleClick","patientGetAll","studyRowClicked","studyGetAll","App","showViewer","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","external","Hammer","cornerstoneMath","init","textStyle","setFont","store","touchProximity","dicomParser","webWorkerManager","initialize","maxWebWorkers","navigator","hardwareConcurrency","startWebWorkersOnDemand","taskConfiguration","decodeTask","initializeCodecsOnStartup","usePDFJS","strict","ReactDOM"],"mappings":"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","file":"static/js/main.5d45afe4.chunk.js","sourcesContent":["/* eslint-disable */\r\n!function(a){var h,t,l,c,o,i='<svg><symbol id=\"icon-juxing2\" viewBox=\"0 0 1024 1024\"><path d=\"M876.4664713541666 302.9680989583333H776.4029947916665V202.90462239583334c0-11.865234374999998-9.8876953125-21.7529296875-21.7529296875-21.7529296875s-21.7529296875 9.8876953125-21.7529296875 21.7529296875v100.0634765625H632.8336588541666c-11.865234374999998 0-21.7529296875 9.8876953125-21.7529296875 21.7529296875s9.8876953125 21.7529296875 21.7529296875 21.7529296875h100.0634765625v100.0634765625c0 11.865234374999998 9.8876953125 21.7529296875 21.7529296875 21.7529296875s21.7529296875-9.8876953125 21.7529296875-21.7529296875V346.4739583333333H876.4664713541666c11.865234374999998 0 21.7529296875-9.8876953125 21.7529296875-21.7529296875 0-12.2607421875-9.8876953125-21.7529296875-21.7529296875-21.7529296875zM146.75455729166666 386.0247395833333c11.07421875 0 19.775390625-8.701171874999998 19.775390625-19.775390625h0.7910156249999999v-21.7529296875h36.38671875c10.678710937499998 0 19.775390625-8.701171874999998 19.775390625-19.775390625s-9.0966796875-19.775390625-19.775390625-19.775390625l-56.953125-0.39550781249999994c-11.07421875 0-19.775390625 8.701171874999998-19.775390625 19.775390625v42.71484374999999c0 9.8876953125 8.701171874999998 18.984374999999996 19.775390625 18.984374999999996z m135.26367187500003-41.92382812499999h98.876953125c11.07421875 0 19.775390625-8.701171874999998 19.775390625-19.775390625s-8.701171874999998-19.775390625-19.775390625-19.775390625h-98.876953125c-11.07421875 0-19.775390625 9.0966796875-19.775390625 19.775390625 0 11.07421875 9.0966796875 19.775390625 19.775390625 19.775390625z m177.1875 0h98.876953125c11.07421875 0 19.775390625-8.701171874999998 19.775390625-19.775390625s-8.701171874999998-19.775390625-19.775390625-19.775390625h-98.876953125c-11.07421875 0-19.775390625 9.0966796875-19.775390625 19.775390625 0.7910156249999999 11.07421875 8.701171874999998 19.775390625 19.775390625 19.775390625zM774.8209635416665 560.8391927083335c0-11.07421875-8.701171874999998-19.775390625-19.775390625-19.775390625s-19.775390625 8.701171874999998-19.775390625 19.775390625v98.876953125c0 11.07421875 8.701171874999998 19.775390625 19.775390625 19.775390625s19.775390625-8.701171874999998 19.775390625-19.775390625v-98.876953125z m-19.775390625 157.41210937500003c-11.07421875 0-19.775390625 9.0966796875-19.775390625 19.775390625v64.072265625h-79.1015625v1.1865234374999998c-11.07421875 0-19.775390625 8.701171874999998-19.775390625 19.775390625s8.701171874999998 19.775390625 19.775390625 19.775390625h98.876953125c11.07421875 0 19.775390625-8.701171874999998 19.775390625-19.775390625V738.8177083333334c0-11.865234374999998-9.0966796875-20.56640625-19.775390625-20.56640625zM581.0221354166666 802.0989583333333L166.52994791666666 801.3079427083333V423.2024739583333h-0.7910156249999999c0-11.07421875-8.701171874999998-19.775390625-19.775390625-19.775390625s-19.775390625 8.701171874999998-19.775390625 19.775390625V821.8743489583334c0 11.07421875 8.701171874999998 19.775390625 19.775390625 19.775390625H579.8356119791666c11.07421875 0 19.775390625-9.0966796875 19.775390625-19.775390625 0-11.07421875-9.0966796875-19.775390625-18.5888671875-19.775390625z\"  ></path></symbol><symbol id=\"icon-mianjiceliang\" viewBox=\"0 0 1024 1024\"><path d=\"M305.222589 369.323416l56.875454-56.875453 361.982812 361.984234-56.875454 56.875454z\"  ></path><path d=\"M1024.270294 292.685236V0H731.058696v103.422848H292.685236V0H0v292.685236h103.465526v438.629528H0v292.685236h292.685236v-103.422848h438.615302v103.422848H1023.985774V731.314764h-106.125783V292.685236zM825.988636 98.628694h99.752546v98.657145h-99.752546z m-728.469568-1.010045h97.547519v97.632876H97.519068z m97.547519 831.977772H97.519068V828.947639h97.547519z m731.314764-3.044359h-94.517387V828.947639h94.517387z m-88.95503-195.237298h-106.125783v103.422847H292.685236v-103.422847H189.205485V292.685236h103.451299V189.205485h438.401912v103.422847h106.367625z\"  ></path></symbol><symbol id=\"icon-celiang\" viewBox=\"0 0 1024 1024\"><path d=\"M981.333333 341.333333a42.666667 42.666667 0 0 0 42.666667-42.666666V42.666667a42.666667 42.666667 0 0 0-42.666667-42.666667h-256a42.666667 42.666667 0 0 0-42.666666 42.666667v85.333333H341.333333V42.666667a42.666667 42.666667 0 0 0-42.666666-42.666667H42.666667a42.666667 42.666667 0 0 0-42.666667 42.666667v256a42.666667 42.666667 0 0 0 42.666667 42.666666h85.333333v341.333334H42.666667a42.666667 42.666667 0 0 0-42.666667 42.666666v256a42.666667 42.666667 0 0 0 42.666667 42.666667h256a42.666667 42.666667 0 0 0 42.666666-42.666667v-85.333333h341.333334v85.333333a42.666667 42.666667 0 0 0 42.666666 42.666667h256a42.666667 42.666667 0 0 0 42.666667-42.666667v-256a42.666667 42.666667 0 0 0-42.666667-42.666666h-85.333333V341.333333z m-213.333333-256h170.666667v170.666667h-170.666667zM85.333333 256V85.333333h170.666667v170.666667z m170.666667 682.666667H85.333333v-170.666667h170.666667z m682.666667-170.666667v170.666667h-170.666667v-170.666667z m-128-85.333333h-85.333334a42.666667 42.666667 0 0 0-42.666666 42.666666v85.333334H341.333333v-85.333334a42.666667 42.666667 0 0 0-42.666666-42.666666H213.333333V341.333333h85.333334a42.666667 42.666667 0 0 0 42.666666-42.666666V213.333333h341.333334v85.333334a42.666667 42.666667 0 0 0 42.666666 42.666666h85.333334z\"  ></path><path d=\"M456.96 396.373333A42.666667 42.666667 0 0 0 396.8 456.533333l149.333333 149.333334a42.666667 42.666667 0 0 0 60.16-60.16z\"  ></path></symbol><symbol id=\"icon-juxing1\" viewBox=\"0 0 1024 1024\"><path d=\"M273.9 168.3H739v37.1H273.9zM273.9 819.6H739v37.1H273.9zM165.812 740.898v-465.1h37.1v465.1zM821.11 740.896v-465.1h37.1v465.1z\" fill=\"#748696\" ></path><path d=\"M184.7 66.2c-66.8 0-121 54.2-121 121s54.2 121 121 121 121-54.2 121-121-54.1-121-121-121z m-0.1 203.5c-45.7 0-82.7-37-82.7-82.7s37-82.7 82.7-82.7 82.7 37 82.7 82.7c0.1 45.7-37 82.7-82.7 82.7zM184.7 717.5c-66.8 0-121 54.2-121 121s54.2 121 121 121 121-54.2 121-121-54.1-121-121-121z m-0.1 203.6c-45.7 0-82.7-37-82.7-82.7s37-82.7 82.7-82.7 82.7 37 82.7 82.7c0.1 45.6-37 82.7-82.7 82.7zM840 717.5c-66.8 0-121 54.2-121 121s54.2 121 121 121 121-54.2 121-121-54.1-121-121-121z m-0.1 203.6c-45.7 0-82.7-37-82.7-82.7s37-82.7 82.7-82.7 82.7 37 82.7 82.7c0.1 45.6-37 82.7-82.7 82.7zM840 66.2c-66.8 0-121 54.2-121 121s54.2 121 121 121 121-54.2 121-121-54.1-121-121-121z m-0.1 203.5c-45.7 0-82.7-37-82.7-82.7s37-82.7 82.7-82.7 82.7 37 82.7 82.7c0.1 45.7-37 82.7-82.7 82.7z\" fill=\"#748696\" ></path></symbol><symbol id=\"icon-move\" viewBox=\"0 0 1024 1024\"><path d=\"M486.4 776.533333v-213.333333H247.466667v106.666667L85.333333 512l162.133334-162.133333V512h238.933333V247.466667H349.866667L512 85.333333l162.133333 162.133334h-132.266666V512h238.933333V349.866667L938.666667 512l-162.133334 162.133333v-106.666666h-238.933333v213.333333h132.266667L512 938.666667l-162.133333-162.133334h136.533333z\"  ></path></symbol><symbol id=\"icon-reset_defalut\" viewBox=\"0 0 1024 1024\"><path d=\"M193.070545 70.353455l5.422546 0.930909A34.909091 34.909091 0 0 1 226.862545 111.709091l-0.023272 0.069818-12.869818 72.541091a448.698182 448.698182 0 0 1 293.888-108.939636c246.830545 0 447.022545 197.911273 447.022545 442.181818s-200.192 442.181818-447.022545 442.181818c-160.186182 0-305.687273-84.084364-385.466182-218.158545a37.794909 37.794909 0 0 1 13.358545-51.921455 38.167273 38.167273 0 0 1 52.154182 13.288727c66.210909 111.243636 186.903273 180.992 319.953455 180.992 204.869818 0 370.850909-164.096 370.850909-366.382545S712.727273 151.179636 507.857455 151.179636c-107.287273 0-206.801455 45.265455-276.317091 121.995637h141.498181a34.909091 34.909091 0 0 1 0 69.818182h-209.454545c-2.606545 0-5.189818-0.279273-7.656727-0.837819a34.629818 34.629818 0 0 1-5.259637-0.512l-5.422545-0.930909a34.909091 34.909091 0 0 1-28.346182-40.494545L152.669091 98.629818a34.909091 34.909091 0 0 1 40.401454-28.276363z\"  ></path></symbol><symbol id=\"icon-zoom\" viewBox=\"0 0 1024 1024\"><path d=\"M192 720v96h160v64H128v-160h64z m704 0v160h-224v-64h160v-96h64z m0-576v160h-64v-96h-160v-64h224z m-544 0v64H192v96H128v-160h224z\"  ></path></symbol><symbol id=\"icon-back\" viewBox=\"0 0 1024 1024\"><path d=\"M363.840919 472.978737C336.938714 497.358861 337.301807 537.486138 364.730379 561.486138L673.951902 832.05497C682.818816 839.813519 696.296418 838.915012 704.05497 830.048098 711.813519 821.181184 710.915012 807.703582 702.048098 799.94503L392.826577 529.376198C384.59578 522.174253 384.502227 511.835287 392.492414 504.59418L702.325747 223.807723C711.056111 215.895829 711.719614 202.404616 703.807723 193.674252 695.895829 184.943889 682.404617 184.280386 673.674253 192.192278L363.840919 472.978737Z\"  ></path></symbol><symbol id=\"icon-searchclose\" viewBox=\"0 0 1024 1024\"><path d=\"M517.08411984 479.11475483L301.90637831 263.93753776a26.85237631 26.85237631 0 1 0-37.98667221 37.95153335l215.17669262 215.19504873L263.91970607 732.27864411a26.85237631 26.85237631 0 1 0 37.96936504 37.96884057l215.19504878-215.17669264 215.19504866 215.17669264a26.85237631 26.85237631 0 1 0 37.9688406-37.95100889l-215.17669262-215.2123559 215.17669262-215.1772171a26.85237631 26.85237631 0 1 0-37.9688406-37.96936505L517.10195147 479.11475483z\"  ></path></symbol><symbol id=\"icon-qingchuhuancun\" viewBox=\"0 0 1024 1024\"><path d=\"M380.220734 960.178685v-223.356732a32.673899 32.673899 0 0 1 65.283983 0V960.178685h130.504148v-223.356732a32.673899 32.673899 0 0 1 65.283982 0V960.178685h195.724314V513.46522H184.368788v446.713465h195.851946z m-261.008296-463.880025a126.483727 126.483727 0 0 1-60.753031-143.522655A130.057435 130.057435 0 0 1 184.304972 258.200383h195.915762V130.567964a130.567964 130.567964 0 0 1 261.135929 0v127.632419h195.724314a129.993618 129.993618 0 0 1 126.10083 94.575622 126.483727 126.483727 0 0 1-60.753032 143.586471V960.178685a64.582004 64.582004 0 0 1-65.283982 63.81621H184.368788a64.582004 64.582004 0 0 1-65.283982-63.81621V496.362476zM836.825712 449.649011a63.816209 63.816209 0 1 0 0-127.632419h-261.008296V130.567964a65.283982 65.283982 0 0 0-130.504148 0v191.448628h-261.008296a63.816209 63.816209 0 1 0 0 127.632419h652.456924z\"  ></path></symbol><symbol id=\"icon-asmkticon0229\" viewBox=\"0 0 1024 1024\"><path d=\"M512 128c-211.84 0-384 172.16-384 384s172.16 384 384 384 384-172.16 384-384S723.84 128 512 128zM512 857.6c-190.72 0-345.6-154.88-345.6-345.6s154.88-345.6 345.6-345.6 345.6 154.88 345.6 345.6S702.72 857.6 512 857.6z\"  ></path><path d=\"M654.72 489.6 454.4 374.4c-3.84-2.56-8.32-3.2-12.8-3.2-13.44 0-25.6 10.88-25.6 25.6l0 231.04c0 14.72 12.16 25.6 25.6 25.6 4.48 0 8.32-1.28 12.8-3.2l200.32-115.84C672 524.16 672 499.84 654.72 489.6zM454.4 605.44 454.4 418.56 616.32 512 454.4 605.44z\"  ></path></symbol><symbol id=\"icon-shuipingfanzhuan\" viewBox=\"0 0 1024 1024\"><path d=\"M799.285029 511.225357 668.763346 380.704698 668.763346 465.179648 354.608344 465.179648 354.608344 380.704698 224.087685 511.227404 354.608344 641.749086 354.608344 558.675042 668.763346 558.675042 668.763346 641.749086Z\"  ></path></symbol><symbol id=\"icon-chuizhifanzhuan\" viewBox=\"0 0 1024 1024\"><path d=\"M173 514.3534 849.277 519.2724 849.561 477.8214 173.283 472.9034Z\"  ></path><path d=\"M430.5251 602.0503 429.2501 806.1233 293.1201 806.1233 513.1221 1024.0003 731.8281 806.1233 595.7591 806.1233 595.7591 602.0503 430.5251 602.0503ZM393.8721 847.5743 470.4571 847.5743 471.7321 643.5003 554.3091 643.5003 554.3091 847.5743 631.4821 847.5743 513.0411 965.5893 393.8721 847.5743Z\"  ></path><path d=\"M513.0902-0.0001 343.4972 167.9479 449.8482 167.9479 451.1392 372.0359 575.0422 372.0359 575.0422 167.9479 681.6522 167.9479Z\"  ></path></symbol><symbol id=\"icon-fangda\" viewBox=\"0 0 1024 1024\"><path d=\"M444.928 445.44v-96.768c0-13.312 10.752-24.064 24.064-24.064s24.064 10.752 24.064 24.064V445.44h103.936c10.24 0 17.92 10.752 17.92 24.064s-8.192 24.064-17.92 24.064h-103.936v96.768c0 13.312-10.752 24.064-24.064 24.064s-24.064-10.752-24.064-24.064v-96.768H343.04c-9.728 0-17.92-10.752-17.92-24.064s8.192-24.064 17.92-24.064h101.888z m246.784 211.968l145.92 145.92c6.144 6.144 8.704 14.848 6.144 23.552-2.048 8.192-8.704 14.848-16.896 16.896-8.192 2.048-17.408 0-23.552-6.144l-145.92-145.92c-52.224 44.544-118.784 68.608-187.392 68.608-160.256 0-290.816-130.048-290.816-290.816 0-160.256 130.048-290.816 290.816-290.816 160.256 0 290.816 130.048 290.816 290.816-0.512 71.68-26.112 137.216-69.12 187.904z m-221.696 54.784c133.632 0 242.176-108.544 242.176-242.176 0-133.632-108.544-242.176-242.176-242.176-133.632 0-242.176 108.544-242.176 242.176 0 133.632 108.032 242.176 242.176 242.176z m0 0\"  ></path></symbol><symbol id=\"icon-yuanxing\" viewBox=\"0 0 1024 1024\"><path d=\"M511.28793597 879.48493867c-203.64442905 0-369.30957687-165.66430491-369.30957687-369.31463527 0-203.64442905 165.66430491-369.30957687 369.30957688-369.30957687 203.65033117 0 369.31463608 165.66430491 369.31463607 369.30957688 0 203.65033117-165.66430491 369.31463608-369.31463608 369.31463525z m0-685.86654502c-174.55140417 0-316.55190893 142.00050476-316.55190893 316.55190975 0 174.55646338 142.00050476 316.55696814 316.55190893 316.55696814 174.55646338 0 316.55696814-142.00050476 316.55696814-316.55696814 0-174.55140417-142.00050476-316.55190893-316.55696813-316.55190975z m0 0\"  ></path></symbol><symbol id=\"icon-fanzhuan\" viewBox=\"0 0 1024 1024\"><path d=\"M513.422 153.6a21.333 21.333 0 0 0-21.333 21.333v674.134a21.333 21.333 0 0 0 42.667 0V174.933a21.333 21.333 0 0 0-21.334-21.333zM364.09 295.822a59.733 59.733 0 0 0-64 12.8L126.578 477.867a56.889 56.889 0 0 0-17.067 41.244 56.889 56.889 0 0 0 17.067 41.245L301.51 731.022a58.311 58.311 0 0 0 39.822 15.645 59.733 59.733 0 0 0 22.756-4.267 56.889 56.889 0 0 0 36.978-54.044V347.022a56.889 56.889 0 0 0-36.978-51.2zM358.4 689.778A15.644 15.644 0 0 1 348.444 704a17.067 17.067 0 0 1-18.488-2.844L155.022 530.489a15.644 15.644 0 0 1-4.266-11.378 15.644 15.644 0 0 1 4.266-11.378l174.934-170.666a17.067 17.067 0 0 1 18.488-2.845 15.644 15.644 0 0 1 9.956 14.222z m539.022-211.911L722.49 307.2a59.733 59.733 0 0 0-64-12.8 56.889 56.889 0 0 0-36.978 54.044v341.334a56.889 56.889 0 0 0 36.978 54.044 59.733 59.733 0 0 0 22.755 4.267 58.311 58.311 0 0 0 41.245-17.067l174.933-170.666a56.889 56.889 0 0 0 17.067-41.245 56.889 56.889 0 0 0-17.067-41.244z m-29.866 51.2L692.622 699.733a17.067 17.067 0 0 1-18.489 2.845 15.644 15.644 0 0 1-9.955-14.222V347.022a15.644 15.644 0 0 1 9.955-14.222h8.534a17.067 17.067 0 0 1 11.377 4.267l174.934 170.666a15.644 15.644 0 0 1 4.266 11.378 15.644 15.644 0 0 1-4.266 11.378z\"  ></path></symbol><symbol id=\"icon-jiaoduceliang\" viewBox=\"0 0 1024 1024\"><path d=\"M85.869714 723.675429C38.326857 723.675429 0 762.148571 0 809.545143 0 856.941714 38.326857 895.268571 85.869714 895.268571s85.869714-38.326857 85.869715-85.869714-38.473143-85.723429-85.869715-85.723428z m0 127.707428c-22.966857 0-41.837714-18.724571-41.837714-41.837714s18.724571-41.837714 41.837714-41.837714 41.837714 18.724571 41.837715 41.837714c-0.146286 23.259429-18.724571 41.837714-41.837715 41.837714z\"  ></path><path d=\"M937.252571 723.675429c-40.082286 0-73.874286 27.648-83.236571 64.804571H153.014857v41.837714H854.308571c9.362286 37.302857 43.008 64.804571 83.236572 64.804572 47.396571 0 85.869714-38.326857 85.869714-85.869715-0.146286-47.250286-38.765714-85.577143-86.162286-85.577142z m0 127.707428c-22.966857 0-41.837714-18.724571-41.837714-41.837714s18.724571-41.837714 41.837714-41.837714c22.966857 0 41.837714 18.724571 41.837715 41.837714 0 23.259429-18.578286 41.837714-41.837715 41.837714z\"  ></path><path d=\"M626.834286 163.401143c-28.525714 28.525714-32.768 71.826286-13.019429 104.740571l-495.908571 495.616 29.549714 29.549715 495.908571-495.616c32.914286 19.748571 76.214857 15.506286 104.740572-13.019429 33.499429-33.499429 33.499429-87.917714 0-121.270857-33.353143-33.499429-87.771429-33.645714-121.270857 0z m90.258285 90.258286c-16.384 16.384-42.861714 16.384-58.953142 0-16.384-16.384-16.384-42.861714 0-58.953143 16.384-16.384 42.861714-16.384 58.953142 0 16.237714 16.091429 16.237714 42.569143 0 58.953143z\"  ></path><path d=\"M397.165714 524.580571s130.779429 104.448 137.508572 275.163429l-35.254857 2.779429s-6.582857-158.134857-130.779429-253.074286l28.525714-24.868572z\"  ></path></symbol><symbol id=\"icon-shizi-\" viewBox=\"0 0 1024 1024\"><path d=\"M461.15 83.21h101.92v285.81H461.15z\"  ></path><path d=\"M548 98.21l0.09 255.8h-71.9l-0.08-255.81H548m30-30H446.1v30l0.09 255.8v30h131.93v-30L578 98.2v-30z\" fill=\"#FFFFFF\" ></path><path d=\"M83.04 461.13h283.75v102H83.04z\"  ></path><path d=\"M351.79 476.12v72H98v-72h253.79m30-30H68v132h313.79v-132z\" fill=\"#FFFFFF\" ></path><path d=\"M657 461.37h285.87v102H657z\"  ></path><path d=\"M927.87 476.37v72H672v-72h255.87m30-30H642v132h315.87v-132z\" fill=\"#FFFFFF\" ></path><path d=\"M461.12 655.98h101.95v285.65H461.12z\"  ></path><path d=\"M548.05 671l0.05 255.64h-72V670.99h71.95m30-30h-132v315.64h132V641z\" fill=\"#FFFFFF\" ></path><path d=\"M511.5 511.5m-40.52429 40.52429a57.31 57.31 0 1 0 81.04858-81.04858 57.31 57.31 0 1 0-81.04858 81.04858Z\"  ></path><path d=\"M511.5 469.19a42.31 42.31 0 1 1-42.31 42.31 42.31 42.31 0 0 1 42.31-42.31m0-30a72.31 72.31 0 1 0 72.31 72.31 72.39 72.39 0 0 0-72.31-72.31z\" fill=\"#FFFFFF\" ></path></symbol><symbol id=\"icon-jujiao\" viewBox=\"0 0 1024 1024\"><path d=\"M512 170.688a341.312 341.312 0 1 1 0 682.624A341.312 341.312 0 0 1 512 170.688M512 128a384 384 0 1 0 0 768A384 384 0 0 0 512 128z\"  ></path><path d=\"M298.688 533.312h-128a21.312 21.312 0 0 1 0-42.624h128a21.312 21.312 0 1 1 0 42.624z m554.624 0h-128a21.312 21.312 0 0 1 0-42.624h128a21.312 21.312 0 0 1 0 42.624zM512 320a21.312 21.312 0 0 1-21.312-21.312v-128a21.312 21.312 0 0 1 42.624 0v128C533.312 310.4 523.776 320 512 320z m0 554.688a21.312 21.312 0 0 1-21.312-21.376v-128a21.312 21.312 0 0 1 42.624 0v128a21.312 21.312 0 0 1-21.312 21.376z\"  ></path></symbol><symbol id=\"icon-fanzhuan1\" viewBox=\"0 0 1024 1024\"><path d=\"M896 494.08000001l0 35.32799999-768 0 0-35.32799999zM305.152 417.28L668.16 417.28000001l19.968 0.51199999 5.12-9.216 5.12000001-8.704L496.64 51.2l-20.48 0-190.976 331.264-10.24 17.408 5.12 8.704 5.12 8.704 19.968 0z m20.47999999-35.328L486.4 103.424l160.768 278.528-321.53600001 0zM688.128 642.048l10.24000001-17.92-5.12000001-8.704-5.12-8.704L304.64 606.72l-19.968-0.512-5.12 9.216-5.12 8.704L476.16 972.8l20.48 0 191.488-330.752z m-362.49600001 0L647.168 642.048l-160.768 278.528-160.76800001-278.528z\"  ></path></symbol><symbol id=\"icon-02-chizi\" viewBox=\"0 0 1024 1024\"><path d=\"M894.151111 351.089778L351.089778 894.151111l-221.240889-221.240889 80.469333-80.469333 20.110222-20.110222 40.220445-40.220445 20.110222-20.110222 40.220445-40.220444 20.110222-20.110223 40.220444-40.248889 20.110222-20.110222 40.220445-40.220444 20.110222-20.110222 40.220445-40.220445 20.110222-20.110222L572.302222 230.4l20.110222-20.110222 80.469334-80.440889z m-241.351111-40.220445l-60.330667-60.359111-40.220444 40.248889 120.689778 120.661333-20.110223 20.110223-120.689777-120.661334-40.220445 40.220445 60.330667 60.330666-20.110222 20.110223-60.330667-60.330667-40.220444 40.220444 120.689777 120.689778-20.110222 20.110222-120.689778-120.689777-40.220444 40.248889 60.330667 60.330666-20.110223 20.110222-60.330666-60.330666-40.220445 40.220444 120.689778 120.689778-20.110222 20.110222-120.689778-120.689778-40.220444 40.220445 60.330666 60.359111-20.110222 20.110222L230.4 612.551111l-60.330667 60.359111 181.020445 181.020445 502.840889-502.840889-181.020445-181.020445L612.551111 230.4l60.330667 60.359111z\"  ></path></symbol><symbol id=\"icon-juxing\" viewBox=\"0 0 1024 1024\"><path d=\"M853.333333 810.666667H170.666667V213.333333h682.666666v597.333334zM213.333333 256v512h597.333334V256z\"  ></path></symbol><symbol id=\"icon-leimupinleifenleileibie\" viewBox=\"0 0 1024 1024\"><path d=\"M320 512 192 512c-70.4 0-128 57.6-128 128l0 128c0 70.4 57.6 128 128 128l128 0c70.4 0 128-57.6 128-128l0-128C448 569.6 390.4 512 320 512zM384 768c0 35.2-28.8 64-64 64L192 832c-35.2 0-64-28.8-64-64l0-128c0-35.2 28.8-64 64-64l128 0c35.2 0 64 28.8 64 64L384 768zM768 64l-128 0C569.6 64 512 121.6 512 192l0 128c0 70.4 57.6 128 128 128l128 0c70.4 0 128-57.6 128-128L896 192C896 121.6 838.4 64 768 64zM832 320c0 35.2-28.8 64-64 64l-128 0C604.8 384 576 355.2 576 320L576 192c0-35.2 28.8-64 64-64l128 0c35.2 0 64 28.8 64 64L832 320zM768 512l-128 0c-70.4 0-128 57.6-128 128l0 128c0 70.4 57.6 128 128 128l128 0c70.4 0 128-57.6 128-128l0-128C896 569.6 838.4 512 768 512zM832 768c0 35.2-28.8 64-64 64l-128 0c-35.2 0-64-28.8-64-64l0-128c0-35.2 28.8-64 64-64l128 0c35.2 0 64 28.8 64 64L832 768zM320 64 192 64C121.6 64 64 121.6 64 192l0 128c0 70.4 57.6 128 128 128l128 0c70.4 0 128-57.6 128-128L448 192C448 121.6 390.4 64 320 64zM384 320c0 35.2-28.8 64-64 64L192 384C156.8 384 128 355.2 128 320L128 192c0-35.2 28.8-64 64-64l128 0c35.2 0 64 28.8 64 64L384 320z\"  ></path></symbol><symbol id=\"icon-shenglvehao\" viewBox=\"0 0 1024 1024\"><path d=\"M176 511a56 56 0 1 0 112 0 56 56 0 1 0-112 0zM456 511a56 56 0 1 0 112 0 56 56 0 1 0-112 0zM736 511a56 56 0 1 0 112 0 56 56 0 1 0-112 0z\"  ></path></symbol></svg>',e=(e=document.getElementsByTagName(\"script\"))[e.length-1].getAttribute(\"data-injectcss\"),v=function(a,h){h.parentNode.insertBefore(a,h)};if(e&&!a.__iconfont__svg__cssinject__){a.__iconfont__svg__cssinject__=!0;try{document.write(\"<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>\")}catch(a){console&&console.log(a)}}function n(){o||(o=!0,l())}function s(){try{c.documentElement.doScroll(\"left\")}catch(a){return void setTimeout(s,50)}n()}h=function(){var a,h=document.createElement(\"div\");h.innerHTML=i,i=null,(h=h.getElementsByTagName(\"svg\")[0])&&(h.setAttribute(\"aria-hidden\",\"true\"),h.style.position=\"absolute\",h.style.width=0,h.style.height=0,h.style.overflow=\"hidden\",h=h,(a=document.body).firstChild?v(h,a.firstChild):a.appendChild(h))},document.addEventListener?~[\"complete\",\"loaded\",\"interactive\"].indexOf(document.readyState)?setTimeout(h,0):(t=function(){document.removeEventListener(\"DOMContentLoaded\",t,!1),h()},document.addEventListener(\"DOMContentLoaded\",t,!1)):document.attachEvent&&(l=h,c=a.document,o=!1,s(),c.onreadystatechange=function(){\"complete\"==c.readyState&&(c.onreadystatechange=null,n())})}(window);","import { useEffect, useState, useCallback } from 'react'\r\n\r\nexport default function useWindowSize() {\r\n  const [size, setSize] = useState({\r\n    width: document.documentElement.clientWidth,\r\n    height: document.documentElement.clientHeight,\r\n  })\r\n\r\n  const onResize = useCallback(() => {\r\n    setSize({\r\n      width: document.documentElement.clientWidth,\r\n      height: document.documentElement.clientHeight,\r\n    })\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    window.addEventListener('resize', onResize)\r\n    return () => {\r\n      window.removeEventListener('resize', onResize)\r\n    }\r\n  }, [onResize])\r\n\r\n  return size\r\n}\r\n","import cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader'\r\nimport cornerstone from 'cornerstone-core'\r\nimport dcmjs from 'dcmjs'\r\nimport * as XLSX from 'xlsx'\r\nimport axios from \"axios\";\r\n\r\nexport const readFileInfo = file => {\r\n  const arrayBuffer = window.fs.readFileSync(file.path).buffer\r\n  const dicomDict = dcmjs.data.DicomMessage.readFile(arrayBuffer)\r\n  return dicomDict\r\n}\r\nexport const readFileRaw  = (file) => {\r\n  const arrayBuffer = window.fs.readFileSync(file.path).buffer;\r\n  return arrayBuffer\r\n}\r\n\r\nexport const addDicomFile = file => {\r\n  const dcmID = cornerstoneWADOImageLoader.wadouri.fileManager.add(file)\r\n  return cornerstone.loadImage(dcmID).then(function (image) {\r\n    return image\r\n  })\r\n}\r\n\r\nexport const showImageByDCMID = dcmID => {\r\n  return cornerstone.loadImage(dcmID).then(function (image) {\r\n    return image\r\n  })\r\n}\r\n\r\nexport const showDicomImage = file => {\r\n  const dcmID = cornerstoneWADOImageLoader.wadouri.fileManager.add(file)\r\n  console.log('dcmID: ', dcmID)\r\n  const element = document.querySelector('.viewport-element')\r\n  cornerstone.enable(element, { colormap: '' })\r\n\r\n  return cornerstone.loadImage(dcmID).then(function (image) {\r\n    console.log(image)\r\n    const viewport = cornerstone.getDefaultViewportForImage(element, image)\r\n    cornerstone.displayImage(element, image, viewport)\r\n    return image\r\n  })\r\n}\r\n\r\nexport function dicomDateTimeToLocale(dateTime, divide) {\r\n  if (dateTime) {\r\n    const date = new Date(dateTime.substring(0, 4) + '-' + dateTime.substring(4, 6) + '-' + dateTime.substring(6, 8))\r\n    const time = dateTime.substring(9, 11) + ':' + dateTime.substring(11, 13) + ':' + dateTime.substring(13, 15)\r\n    const localeDate = date.toLocaleDateString()\r\n    if (!divide) {\r\n      return `${localeDate} ${time}`\r\n    } else if (divide === 'date') {\r\n      return `${localeDate}`\r\n    } else if (divide === 'time') {\r\n      return `${time}`\r\n    }\r\n  } else {\r\n    return 'Unknown'\r\n  }\r\n\r\n}\r\n\r\nexport function dicomTimeToLocale(dateTime) {\r\n  if (dateTime) {\r\n    const time = dateTime.substring(0, 2) + ':' + dateTime.substring(2, 4) + ':' + dateTime.substring(4, 6)\r\n    return `${time}`\r\n  } else {\r\n    return 'Unknown'\r\n  }\r\n\r\n}\r\n\r\nexport const formatFile = async fileList => {\r\n  // fileList = fileList.split(',')\r\n  const imagesIDConfig = []\r\n  for (let i = 0; i < fileList.length; i++) {\r\n    if (window.fs.existsSync(fileList[i])) {\r\n      const data = window.fs.readFileSync(fileList[i])\r\n      const fileName = fileList[i].split('\\\\').pop()\r\n      const file = new window.File([data], fileName, { type: 'application/dicom' })\r\n      const imageId = cornerstoneWADOImageLoader.wadouri.fileManager.add(file)\r\n      imagesIDConfig.push(imageId)\r\n    } else {\r\n      console.log(fileList[i], ' not exists!!!')\r\n      return\r\n    }\r\n  }\r\n  return imagesIDConfig\r\n}\r\n\r\nexport const keyFormat = txt => {\r\n  return txt.replace(/\\/|\\s/gi, '_')\r\n}\r\n\r\n// ====================================================\r\n// ====================================================\r\n\r\n// 下载文件\r\nexport const downloadFile = (data, fileName) => {\r\n  const sheet = XLSX.utils.json_to_sheet(data)\r\n  const wb = XLSX.utils.book_new()\r\n  XLSX.utils.book_append_sheet(wb, sheet, fileName)\r\n  const workbookBlob = workbook2blob(wb)\r\n  openDownload(workbookBlob, `${fileName}.csv`)\r\n}\r\n\r\n// 创建 blobUrl，通过 createObjectURL 实现下载\r\nexport const openDownload = (blob, fileName) => {\r\n  if (typeof blob === 'object' && blob instanceof Blob) {\r\n    blob = URL.createObjectURL(blob)\r\n  }\r\n  const aLink = document.createElement('a')\r\n  aLink.href = blob\r\n  aLink.download = fileName || ''\r\n  let event\r\n  if (window.MouseEvent) event = new MouseEvent('click')\r\n  else {\r\n    event = document.createEvent('MouseEvents')\r\n    event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null)\r\n  }\r\n  aLink.dispatchEvent(event)\r\n}\r\n\r\n// 将 workbook 转化为 blob 对象\r\nexport const workbook2blob = workbook => {\r\n  const wopts = {\r\n    bookType: 'csv',\r\n    bookSST: false,\r\n    type: 'binary',\r\n  }\r\n  const wbout = XLSX.write(workbook, wopts)\r\n  const blob = new Blob([s2ab(wbout)], {\r\n    type: 'application/octet-stream',\r\n  })\r\n  return blob\r\n}\r\n\r\n// 将字符串转ArrayBuffer\r\nexport const s2ab = s => {\r\n  const buf = new ArrayBuffer(s.length)\r\n  const view = new Uint8Array(buf)\r\n  for (let i = 0; i !== s.length; ++i) view[i] = s.charCodeAt(i) & 0xff\r\n  return buf\r\n}\r\n\r\n\r\n// APIs\r\nexport const queryPatientAPI = () => {\r\n  return axios.get(' http://localhost:56565/api/queryPatientData')\r\n}\r\nexport const createSeriesAPI = () => {\r\n  return axios.post(' http://localhost:56565/api/createSeriesTable')\r\n}\r\nexport const updateSuggestAPI = (params) => {\r\n  return axios.post(' http://localhost:56565/api/updateNode', params)\r\n}\r\nexport const deleteNodeAPI = (params) => {\r\n  return axios.post(' http://localhost:56565/api/deleteNode', params)\r\n}\r\n\r\nexport const getDicomType = () => {\r\n  return {\r\n  '1.2.840.10008.1.3.10': {name: 'Media Storage Directory Storage', ciod: 'Basic Directory'},\r\n  '1.2.840.10008.5.1.4.1.1.1': {name: 'Computed Radiography Image Storage', ciod: 'CR Image'},\r\n  '1.2.840.10008.5.1.4.1.1.1.1': {name: 'Digital X-Ray Image Storage - For Presentation', ciod: 'Digital X-Ray Image'},\r\n  '1.2.840.10008.5.1.4.1.1.1.1.1': {name: 'Digital X-Ray Image Storage - For Processing', ciod: 'Digital X-Ray Image'},\r\n  '1.2.840.10008.5.1.4.1.1.1.2': {name: 'Digital Mammography X-Ray Image Storage - For Presentation', ciod: 'Digital Mammography X-Ray Image'},\r\n  '1.2.840.10008.5.1.4.1.1.1.2.1': {name: 'Digital Mammography X-Ray Image Storage - For Processing', ciod: 'Digital Mammography X-Ray Image'},\r\n  '1.2.840.10008.5.1.4.1.1.1.3': {name: 'Digital Intra-Oral X-Ray Image Storage - For Presentation', ciod: 'Digital Intra-Oral X-Ray Image'},\r\n  '1.2.840.10008.5.1.4.1.1.1.3.1': {name: 'Digital Intra-Oral X-Ray Image Storage - For Processing', ciod: 'Digital Intra-Oral X-Ray Image'},\r\n  '1.2.840.10008.5.1.4.1.1.2': {name: 'CT Image Storage', ciod: 'CT Image'},\r\n  '1.2.840.10008.5.1.4.1.1.2.1': {name: 'Enhanced CT Image Storage', ciod: 'Enhanced CT Image'},\r\n  '1.2.840.10008.5.1.4.1.1.2.2': {name: 'Legacy Converted Enhanced CT Image Storage', ciod: 'Legacy Converted Enhanced CT Image'},\r\n  '1.2.840.10008.5.1.4.1.1.3.1': {name: 'Ultrasound Multi-frame Image Storage', ciod: 'US Multi-frame Image'},\r\n  '1.2.840.10008.5.1.4.1.1.4': {name: 'MR Image Storage', ciod: 'MR Image'},\r\n  '1.2.840.10008.5.1.4.1.1.4.1': {name: 'Enhanced MR Image Storage', ciod: 'Enhanced MR Image'},\r\n  '1.2.840.10008.5.1.4.1.1.4.2': {name: 'MR Spectroscopy Storage', ciod: 'MR Spectroscopy'},\r\n  '1.2.840.10008.5.1.4.1.1.4.3': {name: 'Enhanced MR Color Image Storage', ciod: 'Enhanced MR Color Image'},\r\n  '1.2.840.10008.5.1.4.1.1.4.4': {name: 'Legacy Converted Enhanced MR Image Storage', ciod: 'Legacy Converted Enhanced MR Image'},\r\n  '1.2.840.10008.5.1.4.1.1.6.1': {name: 'Ultrasound Image Storage', ciod: 'US Image'},\r\n  '1.2.840.10008.5.1.4.1.1.6.2': {name: 'Enhanced US Volume Storage', ciod: 'Enhanced US Volume'},\r\n  '1.2.840.10008.5.1.4.1.1.7': {name: 'Secondary Capture Image Storage', ciod: 'Secondary Capture Image'},\r\n  '1.2.840.10008.5.1.4.1.1.7.1': {name: 'Multi-frame Single Bit Secondary Capture Image Storage', ciod: 'Multi-frame Single Bit SC Image'},\r\n  '1.2.840.10008.5.1.4.1.1.7.2': {name: 'Multi-frame Grayscale Byte Secondary Capture Image Storage', ciod: 'Multi-frame Grayscale Byte SC Image'},\r\n  '1.2.840.10008.5.1.4.1.1.7.3': {name: 'Multi-frame Grayscale Word Secondary Capture Image Storage', ciod: 'Multi-frame Grayscale Word SC Image'},\r\n  '1.2.840.10008.5.1.4.1.1.7.4': {name: 'Multi-frame True Color Secondary Capture Image Storage', ciod: 'Multi-frame True Color SC Image'},\r\n  '1.2.840.10008.5.1.4.1.1.9.1.1': {name: '12-lead ECG Waveform Storage', ciod: '12-Lead ECG'},\r\n  '1.2.840.10008.5.1.4.1.1.9.1.2': {name: 'General ECG Waveform Storage', ciod: 'General ECG'},\r\n  '1.2.840.10008.5.1.4.1.1.9.1.3': {name: 'Ambulatory ECG Waveform Storage', ciod: 'Ambulatory ECG'},\r\n  '1.2.840.10008.5.1.4.1.1.9.2.1': {name: 'Hemodynamic Waveform Storage', ciod: 'Hemodynamic Waveform'},\r\n  '1.2.840.10008.5.1.4.1.1.9.3.1': {name: 'Cardiac Electrophysiology Waveform Storage', ciod: 'Basic Cardiac Electrophysiology Waveform'},\r\n  '1.2.840.10008.5.1.4.1.1.9.4.1': {name: 'Basic Voice Audio Waveform Storage', ciod: 'Basic Voice Audio Waveform'},\r\n  '1.2.840.10008.5.1.4.1.1.9.4.2': {name: 'General Audio Waveform Storage', ciod: 'General Audio Waveform'},\r\n  '1.2.840.10008.5.1.4.1.1.9.5.1': {name: 'Arterial Pulse Waveform Storage', ciod: 'Arterial Pulse Waveform'},\r\n  '1.2.840.10008.5.1.4.1.1.9.6.1': {name: 'Respiratory Waveform Storage', ciod: 'Respiratory Waveform'},\r\n  '1.2.840.10008.5.1.4.1.1.11.1': {name: 'Grayscale Softcopy Presentation State Storage', ciod: 'Grayscale Softcopy Presentation State'},\r\n  '1.2.840.10008.5.1.4.1.1.11.2': {name: 'Color Softcopy Presentation State Storage', ciod: 'Color Softcopy Presentation State'},\r\n  '1.2.840.10008.5.1.4.1.1.11.3': {name: 'Pseudo-Color Softcopy Presentation State Storage', ciod: 'Pseudo-Color Softcopy Presentation State'},\r\n  '1.2.840.10008.5.1.4.1.1.11.4': {name: 'Blending Softcopy Presentation State Storage', ciod: 'Blending Softcopy Presentation State'},\r\n  '1.2.840.10008.5.1.4.1.1.11.5': {name: 'XA/XRF Grayscale Softcopy Presentation State Storage', ciod: 'XA/XRF Grayscale Softcopy Presentation State'},\r\n  '1.2.840.10008.5.1.4.1.1.11.6': {name: 'Grayscale Planar MPR Volumetric Presentation State Storage', ciod: 'Planar MPR Volumetric Presentation State'},\r\n  '1.2.840.10008.5.1.4.1.1.11.7': {name: 'Compositing Planar MPR Volumetric Presentation State Storage', ciod: 'Planar MPR Volumetric Presentation State'},\r\n  '1.2.840.10008.5.1.4.1.1.11.8': {name: 'Advanced Blending Presentation State Storage', ciod: 'Advanced Blending Presentation State'},\r\n  '1.2.840.10008.5.1.4.1.1.11.9': {name: 'Volume Rendering Volumetric Presentation State Storage', ciod: 'Volume Rendering Volumetric Presentation State'},\r\n  '1.2.840.10008.5.1.4.1.1.11.10': {name: 'Segmented Volume Rendering Volumetric Presentation State Storage', ciod: 'Volume Rendering Volumetric Presentation State'},\r\n  '1.2.840.10008.5.1.4.1.1.11.11': {name: 'Multiple Volume Rendering Volumetric Presentation State Storage', ciod: 'Volume Rendering Volumetric Presentation State'},\r\n  '1.2.840.10008.5.1.4.1.1.12.1': {name: 'X-Ray Angiographic Image Storage', ciod: 'X-Ray Angiographic Image'},\r\n  '1.2.840.10008.5.1.4.1.1.12.1.1': {name: 'Enhanced XA Image Storage', ciod: 'Enhanced XA Image'},\r\n  '1.2.840.10008.5.1.4.1.1.12.2': {name: 'X-Ray Radiofluoroscopic Image Storage', ciod: 'X-Ray Radiofluoroscopic Image'},\r\n  '1.2.840.10008.5.1.4.1.1.12.2.1': {name: 'Enhanced XRF Image Storage', ciod: 'Enhanced XRF Image'},\r\n  '1.2.840.10008.5.1.4.1.1.13.1.1': {name: 'X-Ray 3D Angiographic Image Storage', ciod: 'X-Ray 3D Angiographic Image'},\r\n  '1.2.840.10008.5.1.4.1.1.13.1.2': {name: 'X-Ray 3D Craniofacial Image Storage', ciod: 'X-Ray 3D Craniofacial Image'},\r\n  '1.2.840.10008.5.1.4.1.1.13.1.3': {name: 'Breast Tomosynthesis Image Storage', ciod: 'Breast Tomosynthesis Image'},\r\n  '1.2.840.10008.5.1.4.1.1.13.1.4': {name: 'Breast Projection X-Ray Image Storage - For Presentation', ciod: 'Breast Projection X-Ray Image'},\r\n  '1.2.840.10008.5.1.4.1.1.13.1.5': {name: 'Breast Projection X-Ray Image Storage - For Processing', ciod: 'Breast Projection X-Ray Image'},\r\n  '1.2.840.10008.5.1.4.1.1.14.1': {name: 'Intravascular Optical Coherence Tomography Image Storage - For Presentation', ciod: 'Intravascular Optical Coherence Tomography Image'},\r\n  '1.2.840.10008.5.1.4.1.1.14.2': {name: 'Intravascular Optical Coherence Tomography Image Storage - For Processing', ciod: 'Intravascular Optical Coherence Tomography Image'},\r\n  '1.2.840.10008.5.1.4.1.1.20': {name: 'Nuclear Medicine Image Storage', ciod: 'NM Image'},\r\n  '1.2.840.10008.5.1.4.1.1.30': {name: 'Parametric Map Storage', ciod: 'Parametric Map'},\r\n  '1.2.840.10008.5.1.4.1.1.66': {name: 'Raw Data Storage', ciod: 'Raw Data'},\r\n  '1.2.840.10008.5.1.4.1.1.66.1': {name: 'Spatial Registration Storage', ciod: 'Spatial Registration'},\r\n  '1.2.840.10008.5.1.4.1.1.66.2': {name: 'Spatial Fiducials Storage', ciod: 'Spatial Fiducials'},\r\n  '1.2.840.10008.5.1.4.1.1.66.3': {name: 'Deformable Spatial Registration Storage', ciod: 'Deformable Spatial Registration'},\r\n  '1.2.840.10008.5.1.4.1.1.66.4': {name: 'Segmentation Storage', ciod: 'Segmentation'},\r\n  '1.2.840.10008.5.1.4.1.1.66.5': {name: 'Surface Segmentation Storage', ciod: 'Surface Segmentation'},\r\n  '1.2.840.10008.5.1.4.1.1.66.6': {name: 'Tractography Results Storage', ciod: 'Tractography Results'},\r\n  '1.2.840.10008.5.1.4.1.1.67': {name: 'Real World Value Mapping Storage', ciod: 'Real World Value Mapping'},\r\n  '1.2.840.10008.5.1.4.1.1.68.1': {name: 'Surface Scan Mesh Storage', ciod: 'Surface Scan Mesh'},\r\n  '1.2.840.10008.5.1.4.1.1.68.2': {name: 'Surface Scan Point Cloud Storage', ciod: 'Surface Scan Point Cloud'},\r\n  '1.2.840.10008.5.1.4.1.1.77.1.1': {name: 'VL Endoscopic Image Storage', ciod: 'VL Endoscopic Image'},\r\n  '1.2.840.10008.5.1.4.1.1.77.1.1.1': {name: 'Video Endoscopic Image Storage', ciod: 'Video Endoscopic Image'},\r\n  '1.2.840.10008.5.1.4.1.1.77.1.2': {name: 'VL Microscopic Image Storage', ciod: 'VL Microscopic Image'},\r\n  '1.2.840.10008.5.1.4.1.1.77.1.2.1': {name: 'Video Microscopic Image Storage', ciod: 'Video Microscopic Image'},\r\n  '1.2.840.10008.5.1.4.1.1.77.1.3': {name: 'VL Slide-Coordinates Microscopic Image Storage', ciod: 'VL Slide-Coordinates Microscopic Image'},\r\n  '1.2.840.10008.5.1.4.1.1.77.1.4': {name: 'VL Photographic Image Storage', ciod: 'VL Photographic Image'},\r\n  '1.2.840.10008.5.1.4.1.1.77.1.4.1': {name: 'Video Photographic Image Storage', ciod: 'Video Photographic Image'},\r\n  '1.2.840.10008.5.1.4.1.1.77.1.5.1': {name: 'Ophthalmic Photography 8 Bit Image Storage', ciod: 'Ophthalmic Photography 8 Bit Image'},\r\n  '1.2.840.10008.5.1.4.1.1.77.1.5.2': {name: 'Ophthalmic Photography 16 Bit Image Storage', ciod: 'Ophthalmic Photography 16 Bit Image'},\r\n  '1.2.840.10008.5.1.4.1.1.77.1.5.3': {name: 'Stereometric Relationship Storage', ciod: 'Stereometric Relationship'},\r\n  '1.2.840.10008.5.1.4.1.1.77.1.5.4': {name: 'Ophthalmic Tomography Image Storage', ciod: 'Ophthalmic Tomography Image'},\r\n  '1.2.840.10008.5.1.4.1.1.77.1.5.5': {name: 'Wide Field Ophthalmic Photography Stereographic Projection Image Storage', ciod: 'Wide Field Ophthalmic Photography Stereographic Projection Image'},\r\n  '1.2.840.10008.5.1.4.1.1.77.1.5.6': {name: 'Wide Field Ophthalmic Photography 3D Coordinates Image Storage', ciod: 'Wide Field Ophthalmic Photography 3D Coordinates Image'},\r\n  '1.2.840.10008.5.1.4.1.1.77.1.5.7': {name: 'Ophthalmic Optical Coherence Tomography En Face Image Storage', ciod: 'Ophthalmic Optical Coherence Tomography En Face Image'},\r\n  '1.2.840.10008.5.1.4.1.1.77.1.5.8': {name: 'Ophthalmic Optical Coherence Tomography B-scan Volume Analysis Storage', ciod: 'Ophthalmic Optical Coherence Tomography B-scan Volume Analysis'},\r\n  '1.2.840.10008.5.1.4.1.1.77.1.6': {name: 'VL Whole Slide Microscopy Image Storage', ciod: 'VL Whole Slide Microscopy Image'},\r\n  '1.2.840.10008.5.1.4.1.1.78.1': {name: 'Lensometry Measurements Storage', ciod: 'Lensometry Measurements'},\r\n  '1.2.840.10008.5.1.4.1.1.78.2': {name: 'Autorefraction Measurements Storage', ciod: 'Autorefraction Measurements'},\r\n  '1.2.840.10008.5.1.4.1.1.78.3': {name: 'Keratometry Measurements Storage', ciod: 'Keratometry Measurements'},\r\n  '1.2.840.10008.5.1.4.1.1.78.4': {name: 'Subjective Refraction Measurements Storage', ciod: 'Subjective Refraction Measurements'},\r\n  '1.2.840.10008.5.1.4.1.1.78.5': {name: 'Visual Acuity Measurements Storage', ciod: 'Visual Acuity Measurements'},\r\n  '1.2.840.10008.5.1.4.1.1.78.6': {name: 'Spectacle Prescription Report Storage', ciod: 'Spectacle Prescription Report'},\r\n  '1.2.840.10008.5.1.4.1.1.78.7': {name: 'Ophthalmic Axial Measurements Storage', ciod: 'Ophthalmic Axial Measurements'},\r\n  '1.2.840.10008.5.1.4.1.1.78.8': {name: 'Intraocular Lens Calculations Storage', ciod: 'Intraocular Lens Calculations'},\r\n  '1.2.840.10008.5.1.4.1.1.79.1': {name: 'Macular Grid Thickness and Volume Report', ciod: 'Macular Grid Thickness and Volume Report'},\r\n  '1.2.840.10008.5.1.4.1.1.80.1': {name: 'Ophthalmic Visual Field Static Perimetry Measurements Storage', ciod: 'Ophthalmic Visual Field Static Perimetry Measurements'},\r\n  '1.2.840.10008.5.1.4.1.1.81.1': {name: 'Ophthalmic Thickness Map Storage', ciod: 'Ophthalmic Thickness Map'},\r\n  '1.2.840.10008.5.1.4.1.1.82.1': {name: 'Corneal Topography Map Storage', ciod: 'Corneal Topography Map'},\r\n  '1.2.840.10008.5.1.4.1.1.88.11': {name: 'Basic Text SR Storage', ciod: 'Basic Text SR'},\r\n  '1.2.840.10008.5.1.4.1.1.88.22': {name: 'Enhanced SR Storage', ciod: 'Enhanced SR'},\r\n  '1.2.840.10008.5.1.4.1.1.88.33': {name: 'Comprehensive SR Storage', ciod: 'Comprehensive SR'},\r\n  '1.2.840.10008.5.1.4.1.1.88.34': {name: 'Comprehensive 3D SR Storage', ciod: 'Comprehensive 3D SR'},\r\n  '1.2.840.10008.5.1.4.1.1.88.35': {name: 'Extensible SR Storage', ciod: 'Extensible SR'},\r\n  '1.2.840.10008.5.1.4.1.1.88.40': {name: 'Procedure Log Storage', ciod: 'Procedure Log'},\r\n  '1.2.840.10008.5.1.4.1.1.88.50': {name: 'Mammography CAD SR Storage', ciod: 'Mammography CAD SR'},\r\n  '1.2.840.10008.5.1.4.1.1.88.59': {name: 'Key Object Selection Document Storage', ciod: 'Key Object Selection Document'},\r\n  '1.2.840.10008.5.1.4.1.1.88.65': {name: 'Chest CAD SR Storage', ciod: 'Chest CAD SR'},\r\n  '1.2.840.10008.5.1.4.1.1.88.67': {name: 'X-Ray Radiation Dose SR Storage', ciod: 'X-Ray Radiation Dose SR'},\r\n  '1.2.840.10008.5.1.4.1.1.88.68': {name: 'Radiopharmaceutical Radiation Dose SR Storage', ciod: 'Radiopharmaceutical Radiation Dose SR'},\r\n  '1.2.840.10008.5.1.4.1.1.88.69': {name: 'Colon CAD SR Storage', ciod: 'Colon CAD SR'},\r\n  '1.2.840.10008.5.1.4.1.1.88.70': {name: 'Implantation Plan SR Document Storage', ciod: 'Implantation Plan SR Document'},\r\n  '1.2.840.10008.5.1.4.1.1.88.71': {name: 'Acquisition Context SR Storage', ciod: 'Acquisition Context SR'},\r\n  '1.2.840.10008.5.1.4.1.1.88.72': {name: 'Simplified Adult Echo SR Storage', ciod: 'Simplified Adult Echo SR'},\r\n  '1.2.840.10008.5.1.4.1.1.88.73': {name: 'Patient Radiation Dose SR Storage', ciod: 'Patient Radiation Dose Structured Report'},\r\n  '1.2.840.10008.5.1.4.1.1.88.74': {name: 'Planned Imaging Agent Administration SR Storage', ciod: 'Planned Imaging Agent Administration SR'},\r\n  '1.2.840.10008.5.1.4.1.1.88.75': {name: 'Performed Imaging Agent Administration SR Storage', ciod: 'Performed Imaging Agent Administration SR'},\r\n  '1.2.840.10008.5.1.4.1.1.90.1': {name: 'Content Assessment Results Storage', ciod: 'Content Assessment Results'},\r\n  '1.2.840.10008.5.1.4.1.1.104.1': {name: 'Encapsulated PDF Storage', ciod: 'Encapsulated PDF'},\r\n  '1.2.840.10008.5.1.4.1.1.104.2': {name: 'Encapsulated CDA Storage', ciod: 'Encapsulated CDA'},\r\n  '1.2.840.10008.5.1.4.1.1.104.3': {name: 'Encapsulated STL Storage', ciod: 'Encapsulated STL'},\r\n  '1.2.840.10008.5.1.4.1.1.104.4': {name: 'Encapsulated OBJ Storage', ciod: 'Encapsulated OBJ'},\r\n  '1.2.840.10008.5.1.4.1.1.104.5': {name: 'Encapsulated MTL Storage', ciod: 'Encapsulated MTL'},\r\n  '1.2.840.10008.5.1.4.1.1.128': {name: 'Positron Emission Tomography Image Storage', ciod: 'PET Image'},\r\n  '1.2.840.10008.5.1.4.1.1.128.1': {name: 'Legacy Converted Enhanced PET Image Storage', ciod: 'Legacy Converted Enhanced PET Image'},\r\n  '1.2.840.10008.5.1.4.1.1.130': {name: 'Enhanced PET Image Storage', ciod: 'Enhanced PET Image'},\r\n  '1.2.840.10008.5.1.4.1.1.131': {name: 'Basic Structured Display Storage', ciod: 'Basic Structured Display'},\r\n  '1.2.840.10008.5.1.4.1.1.200.1': {name: 'CT Defined Procedure Protocol Storage', ciod: 'CT Defined Procedure Protocol'},\r\n  '1.2.840.10008.5.1.4.1.1.200.2': {name: 'CT Performed Procedure Protocol Storage', ciod: 'CT Performed Procedure Protocol'},\r\n  '1.2.840.10008.5.1.4.1.1.200.3': {name: 'Protocol Approval Storage', ciod: 'Protocol Approval'},\r\n  '1.2.840.10008.5.1.4.1.1.481.1': {name: 'RT Image Storage', ciod: 'RT Image'},\r\n  '1.2.840.10008.5.1.4.1.1.481.2': {name: 'RT Dose Storage', ciod: 'RT Dose'},\r\n  '1.2.840.10008.5.1.4.1.1.481.3': {name: 'RT Structure Set Storage', ciod: 'RT Structure Set'},\r\n  '1.2.840.10008.5.1.4.1.1.481.4': {name: 'RT Beams Treatment Record Storage', ciod: 'RT Beams Treatment Record'},\r\n  '1.2.840.10008.5.1.4.1.1.481.5': {name: 'RT Plan Storage', ciod: 'RT Plan'},\r\n  '1.2.840.10008.5.1.4.1.1.481.6': {name: 'RT Brachy Treatment Record Storage', ciod: 'RT Brachy Treatment Record'},\r\n  '1.2.840.10008.5.1.4.1.1.481.7': {name: 'RT Treatment Summary Record Storage', ciod: 'RT Treatment Summary Record'},\r\n  '1.2.840.10008.5.1.4.1.1.481.8': {name: 'RT Ion Plan Storage', ciod: 'RT Ion Plan'},\r\n  '1.2.840.10008.5.1.4.1.1.481.9': {name: 'RT Ion Beams Treatment Record Storage', ciod: 'RT Ion Beams Treatment Record'},\r\n  '1.2.840.10008.5.1.4.1.1.481.10': {name: 'RT Physician Intent Storage', ciod: 'RT Physician Intent'},\r\n  '1.2.840.10008.5.1.4.1.1.481.11': {name: 'RT Segment Annotation Storage', ciod: 'RT Segment Annotation'},\r\n  '1.2.840.10008.5.1.4.1.1.481.12': {name: 'RT Radiation Set Storage', ciod: 'RT Radiation Set'},\r\n  '1.2.840.10008.5.1.4.1.1.481.13': {name: 'C-Arm Photon-Electron Radiation Storage', ciod: 'C-Arm Photon-Electron Radiation'},\r\n  '1.2.840.10008.5.1.4.1.1.481.14': {name: 'Tomotherapeutic Radiation Storage', ciod: 'Tomotherapeutic Radiation'},\r\n  '1.2.840.10008.5.1.4.1.1.481.15': {name: 'Robotic-Arm Radiation Storage', ciod: 'Robotic-Arm Radiation'},\r\n  '1.2.840.10008.5.1.4.34.7': {name: 'RT Beams Delivery Instruction Storage', ciod: 'RT Beams Delivery Instruction'},\r\n  '1.2.840.10008.5.1.4.34.10': {name: 'RT Brachy Application Setup Delivery Instruction Storage', ciod: 'RT Brachy Application Setup Delivery Instruction'},\r\n  '1.2.840.10008.5.1.4.38.1': {name: 'Hanging Protocol Storage', ciod: 'Hanging Protocol'},\r\n  '1.2.840.10008.5.1.4.39.1': {name: 'Color Palette Storage', ciod: 'Color Palette'},\r\n  '1.2.840.10008.5.1.4.43.1': {name: 'Generic Implant Template Storage', ciod: 'Generic Implant Template'},\r\n  '1.2.840.10008.5.1.4.44.1': {name: 'Implant Assembly Template Storage', ciod: 'Implant Assembly Template'},\r\n  '1.2.840.10008.5.1.4.45.1': {name: 'Implant Template Group Storage', ciod: 'Implant Template Group'},\r\n  }\r\n}","import React, { useState, useEffect } from 'react'\r\nimport './CustomOverlay.scss'\r\nimport cornerstone from 'cornerstone-core'\r\nimport { dicomDateTimeToLocale } from '../../../util/index'\r\n\r\nconst CustomOverlay = props => {\r\n\r\n  const [data, setData] = useState(null)\r\n\r\n  useEffect(() => {\r\n    cornerstone.loadImage(props.imageId).then(image => {\r\n      \r\n      const data = {\r\n        name: image.data.string('x00100010'),\r\n        birth: image.data.string('x00100030'),\r\n        patientId: image.data.string('x00100020'),\r\n        sex: image.data.string('x00100040'),\r\n\r\n        hospital: image.data.string('x00080080'),\r\n        studyID: image.data.string('x00200010'),\r\n        day: dicomDateTimeToLocale(image.data.string('x00080022') + '.' + image.data.string('x00080032'), 'date'),\r\n        time: dicomDateTimeToLocale(image.data.string('x00080022') + '.' + image.data.string('x00080032'), 'time'),\r\n\r\n        seriesNo: image.data.string('x00200011'),\r\n        seriesDescription: image.data.string('x0008103e'),\r\n        \r\n        sliceThickness: image.data.string('x00180050'),\r\n        sliceLocation: image.data.string('x00201041'),\r\n\r\n        Rowsize: image.rows,\r\n        Colsize: image.columns,\r\n\r\n        age: '**',\r\n      }\r\n\r\n      if (data.birth && data.birth.toString().slice(0, 2) > 18) {\r\n        data.age = new Date().getFullYear() - Number(data.birth.toString().slice(0, 4))\r\n      }\r\n\r\n      setData(data)\r\n    })\r\n  }, [props.imageId])\r\n\r\n  return (\r\n    <div className=\"custom-overlay-box\">\r\n      <div className=\"top-box\">\r\n        <div>\r\n          <div className=\"list\">\r\n            姓名：<span>{data?.name}</span>\r\n          </div>\r\n          <div className=\"list\">\r\n            生日：<span>{data?.birth}</span>\r\n          </div>\r\n          <div className=\"list\">\r\n            Patient ID：<span>{data?.patientId}</span>\r\n          </div>\r\n          <div className=\"list\">\r\n            性别：<span>{data?.sex === '**' ? data?.sex : data?.sex === 'M' ? '男' : '女'}</span>\r\n          </div>\r\n          <div className=\"list\">\r\n            年龄：<span>{data?.age}</span>\r\n          </div>\r\n        </div>\r\n        <div style={{ textAlign: 'right' }}>\r\n          <div className=\"list\">\r\n            医院：<span>{data?.hospital}</span>\r\n          </div>\r\n          <div className=\"list\">\r\n            检测ID：<span>{data?.studyID}</span>\r\n          </div>\r\n          <div className=\"list\">\r\n            检查日期：<span>{data?.day}</span>\r\n          </div>\r\n          <div className=\"list\">\r\n            检查时间：<span>{data?.time}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className=\"bottom-box\">\r\n        <div>\r\n          <div className=\"list\">\r\n            图像帧：\r\n            <span>\r\n              {props.imageIndex - 1} / {props.stackSize}\r\n            </span>\r\n          </div>\r\n          <div className=\"list\">\r\n            缩放：<span>{props.scale.toFixed(2)}</span>\r\n          </div>\r\n          <div className=\"list\">\r\n            窗口/层级：\r\n            <span>\r\n              {Number(props.windowWidth).toFixed(2)} / {Number(props.windowCenter).toFixed(2)}{' '}\r\n            </span>\r\n          </div>\r\n          <div className=\"list\">\r\n            大小：<span>{`${data?.Rowsize} x ${data?.Colsize}`}</span>\r\n          </div>\r\n        </div>\r\n        <div style={{ textAlign: 'right', display: 'flex', flexDirection: 'column', justifyContent: 'flex-end' }}>\r\n          <div className=\"list\">\r\n            序列号：<span>{data?.seriesNo}</span>\r\n          </div>\r\n          <div className=\"list\">\r\n            序列描述：<span>{data?.seriesDescription ? data?.seriesDescription : '暂无描述'}</span>\r\n          </div>\r\n          <div className=\"list\">\r\n            层厚：<span>{data?.sliceThickness} mm</span>\r\n          </div>\r\n          <div className=\"list\">\r\n            位置：<span>{data?.sliceLocation} mm</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default CustomOverlay\r\n","import React, { useState, useEffect, createRef } from 'react'\r\nimport CornerstoneViewport from 'react-cornerstone-viewport'\r\nimport './ViewerMain.scss'\r\nimport cornerstone from 'cornerstone-core'\r\nimport useWindowSize from '../../hook/useWindowSize'\r\nimport CustomOverlay from '../common/CustomOverlay/CustomOverlay'\r\nimport { showImageByDCMID } from '../../util/index'\r\n\r\nconst ViewerMain = props => {\r\n  const size = useWindowSize()\r\n  return (\r\n    <div className=\"viewer-main-box\">\r\n      <CornerstoneViewport\r\n        imageIdIndex={props.imageIdIndex}\r\n        viewportOverlayComponent={CustomOverlay}\r\n        onElementEnabled={elementEnabledEvt => props.handleElementEnabledEvt(elementEnabledEvt)}\r\n        imageIds={props.imagesConfig}\r\n        style={{\r\n          minWidth: '100%',\r\n          height: `${size.height - 70}px`,\r\n          flex: '1',\r\n        }}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n\r\nexport const ViewerThumbnail = props => {\r\n  const { imageId, imageIdIndex } = props\r\n  const canvasRef = createRef()\r\n  const [isLoading, setLoading] = useState(false)\r\n  const [image, setImage] = useState({})\r\n\r\n  useEffect(() => {\r\n    if (image.imageId) {\r\n      cornerstone.renderToCanvas(canvasRef.current, image)\r\n      setLoading(false)\r\n    }\r\n  }, [canvasRef, image, image.imageId])\r\n\r\n  useEffect(() => {\r\n    // console.log('imageId：', imageId, ', image: ', image)\r\n    if (!image.imageId || image.imageId !== imageId) {\r\n      setLoading(true)\r\n      showImageByDCMID(imageId)\r\n        .then(res => {\r\n          setImage(res)\r\n        })\r\n        .catch(err => {\r\n          console.log('err: ', err)\r\n        })\r\n    }\r\n  }, [image.imageId, imageId])\r\n\r\n  // console.log('imageIdIndex: ', props.imageIdIndex)\r\n  // console.log('props:', props)\r\n  return (\r\n    <div>\r\n        <div className=\"image-thumbnail-canvas\">\r\n            <canvas ref={canvasRef} style={{\r\n                minWidth: '100%',\r\n                minHeight: '100px',\r\n                flex: '1',\r\n            }} />\r\n            {isLoading && <div className=\"image-thumbnail-loading-indicator\"></div>}\r\n        </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ViewerMain\r\n","import React, { useState, useEffect } from 'react'\r\n\r\nimport './LeftSidePanel.scss'\r\nimport { Tag } from 'antd'\r\nimport { ViewerThumbnail } from '../ViewerMain/ViewerMain'\r\n\r\nconst LeftSidePanel = props => {\r\n  const [thumbnailList, setThumbnailList] = useState([])\r\n  useEffect(() => {\r\n    let tempList = [...props.patientInfo.seriesInfo]\r\n    setThumbnailList(tempList)\r\n  }, [props.patientInfo.seriesInfo])\r\n\r\n  const methods = {\r\n    changeActive(item) {\r\n      thumbnailList?.map((res, index) => {\r\n        res.active = false\r\n      })\r\n      item.active = true\r\n      props.getSelectedSeries(item)\r\n      setThumbnailList([...thumbnailList])\r\n    },\r\n  }\r\n\r\n  return (\r\n    <div className=\"left-side-panel-box\">\r\n      <div className=\"list-box-wrap\">\r\n        <div className=\"list-box\">\r\n          {thumbnailList?.length === 0 ? (\r\n            <div className=\"empty\">暂无序列</div>\r\n          ) : (\r\n            thumbnailList?.map((item, index) => (\r\n              <div\r\n                key={item.key}\r\n                onClick={e => {\r\n                  methods.changeActive(item, index)\r\n                }}\r\n                className={item.active ? 'active list-item' : 'list-item'}\r\n              >\r\n                <div className=\"title\">序列：{item.seriesDescription}</div>\r\n                <div className=\"img-box\">\r\n                  <ViewerThumbnail imageId={item.cover} imageIdIndex={Number(item.seriesNo)} />\r\n                  <div className=\"sequence-num\">\r\n                    <Tag color=\"orange\">{item.frameNum} 帧</Tag>\r\n                  </div>\r\n                </div>\r\n                <div className=\"list-detail\">{item['acquisitionDate']}</div>\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default LeftSidePanel\r\n","import { createFromIconfontCN } from '@ant-design/icons'\r\nimport iconfont from './iconFont'\r\n\r\nconst IconFont = createFromIconfontCN({\r\n  scriptUrl: { iconfont },\r\n})\r\n\r\nexport default IconFont\r\n","import React, { useState, useEffect} from 'react'\r\nimport './ModalContent.scss'\r\nimport {readFileInfo, dicomDateTimeToLocale, dicomTimeToLocale, readFileRaw} from \"../../util\";\r\nimport {Button, Input, Tabs} from 'antd'\r\nimport daikon from \"daikon\"\r\nimport * as Mark from 'mark.js'\r\nimport {ArrowDownOutlined, ArrowUpOutlined} from \"@ant-design/icons\";\r\n\r\nconst ModalContent = (props) => {\r\n    const { TabPane } = Tabs;\r\n    const [input1, setInput1] = useState('')\r\n    const [input2, setInput2] = useState('')\r\n    const [searchCurrent, setSearchCurrent] = useState(0)\r\n    const [thisData, setThisData] = useState({\r\n        dict : null,\r\n        meta : null,\r\n        dcmHTML : null\r\n    })\r\n    // console.log('props: ', props.globalData)\r\n\r\n    useEffect(() => {\r\n        let selectedPath = null\r\n        let info = null\r\n        let rawInfo = null\r\n        for (let i = 0; i < props.globalData.seriesInfo.length; i ++) {\r\n            if (props.globalData.seriesInfo[i].active) {\r\n                selectedPath = {path: props.globalData.seriesInfo[i].framePath[0]}\r\n            }\r\n        }\r\n        info = readFileInfo(selectedPath)\r\n        rawInfo = readFileRaw(selectedPath)\r\n        const data = new DataView(rawInfo)\r\n        // daikon.Parser.verbose = true;\r\n        // console.log('info: ', info)\r\n        // console.log('daikon: ', daikon.Series.parseImage(data).toString())\r\n        const formatRawData = rawInfoBoxFormat(daikon.Series.parseImage(data).toString())\r\n        setThisData(pr => ({\r\n            ...pr,\r\n            dict: info['dict'],\r\n            meta: info['meta'],\r\n            dcmHTML: formatRawData,\r\n        }))\r\n    }, [])\r\n\r\n\r\n    const textFormat = (txt) => {\r\n        if (txt) {\r\n            return txt['Value'].toString()\r\n        } else {\r\n            return\r\n        }\r\n    }\r\n    const onSearch = (txt, pageIndex, next) => {\r\n        // console.log(txt)\r\n        const lowerTxt = txt.toLowerCase()\r\n        const markArr = []\r\n        const className = pageIndex === 0 ? '.descriptionBox' : '.rawInfoBox'\r\n        const innerClassName = pageIndex === 0 ? '.descriptionBox .item' : '.rawItem'\r\n        const instance = new Mark(document.querySelectorAll(className)[0])\r\n        instance.unmark()\r\n        instance.mark(lowerTxt, {\"separateWordSearch\": false})\r\n\r\n        for (const element of document.querySelectorAll(innerClassName)) {\r\n            // console.log(element.textContent)\r\n            const innerTxt = element.textContent\r\n            if (txt.length > 0 && innerTxt.toLowerCase().includes(lowerTxt)) {\r\n                markArr.push(element)\r\n            }\r\n        }\r\n\r\n        if (next === 'top') {\r\n            // document.querySelectorAll(className)[0].scrollIntoView(true)\r\n        }\r\n\r\n        if (markArr.length > 0) {\r\n            if (next === 'up') {\r\n                if (searchCurrent >= 1) {\r\n                    markArr[searchCurrent-1].scrollIntoView()\r\n                    setSearchCurrent(searchCurrent - 1)\r\n                }\r\n            } else if (next === 'down') {\r\n                if (searchCurrent < markArr.length) {\r\n                    markArr[searchCurrent].scrollIntoView()\r\n                    setSearchCurrent(searchCurrent + 1)\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    const rawInfoBoxFormat = (content) => {\r\n        let temp =  content.replaceAll('<span', '<div class=\"rawItem\"><span')\r\n        temp = temp.replaceAll('<br />','</div>')\r\n        temp = temp.replaceAll('&nbsp;',' ')\r\n        //\r\n        return temp\r\n        // return content\r\n    }\r\n\r\n    const onChange = (key) => {\r\n        // console.log(key);\r\n        setInput1('')\r\n        setInput2('')\r\n        // onSearch('', key === 0 ? 1: 0, 'top')\r\n        onSearch('', 0, 'top')\r\n        onSearch('', 1, 'top')\r\n    }\r\n    const inputChange = (e, index) => {\r\n        if (e.target.value == '') {\r\n            onSearch('', index, 'top')\r\n        }\r\n        if (index === 0) {\r\n            setInput1(e.target.value)\r\n        } else if (index === 1) {\r\n            setInput2(e.target.value)\r\n        }\r\n        setSearchCurrent(0)\r\n    }\r\n\r\n\r\n\r\n  return (\r\n    <div className=\"modal-content-wrap\" >\r\n        {\r\n            thisData.dict ?\r\n                <Tabs defaultActiveKey=\"0\" centered onChange={onChange}>\r\n                    <TabPane tab=\"关键DICOM属性\" key=\"0\">\r\n                        <div className=\"searchBox\">\r\n                            <Input\r\n                                value={input1}\r\n                                placeholder=\"输入查询字段\"\r\n                                allowClear\r\n                                onChange={e => inputChange(e, 0)}\r\n                            />\r\n                            <Button type=\"primary\" className=\"btn\" icon={<ArrowUpOutlined />}\r\n                                    onClick={e => onSearch(input1, 0, 'up')}\r\n                            ></Button>\r\n                            <Button type=\"primary\" className=\"btn\" icon={<ArrowDownOutlined />}\r\n                                    onClick={e => onSearch(input1, 0, 'down')}\r\n                            ></Button>\r\n                        </div>\r\n\r\n                        <div className=\"descriptionBox\">\r\n                            <div className=\"item\">\r\n                                <div className=\"itemHeader\">病人信息</div>\r\n                                <div className=\"itemTxt\">{\"Patient's Name：\" +textFormat(thisData.dict['00100010'])}</div>\r\n                                <div className=\"itemTxt\">{\"Patient's ID：\" +textFormat(thisData?.dict['00100020'])}</div>\r\n                                <div className=\"itemTxt\">{\"Patient's Gender：\" +textFormat(thisData?.dict['00100040'])}</div>\r\n                                <div className=\"itemTxt\">{\"Patient's Birth Date：\" +textFormat(thisData?.dict['00100030'])}</div>\r\n                            </div>\r\n                            <div className=\"item\">\r\n                                <div className=\"itemHeader\">CT机生产商信息</div>\r\n                                <div className=\"itemTxt\">{\"Manufacturer：\" +textFormat(thisData?.dict['00080070'])}</div>\r\n                                <div className=\"itemTxt\">{\"Manufacturer's Model Name：\" +textFormat(thisData?.dict['00081090'] ? thisData?.dict['00081090'] : 'No Model Name')}</div>\r\n                                <div className=\"itemTxt\">{\"Station Name：\" +textFormat(thisData?.dict['00081010'])}</div>\r\n                            </div>\r\n                            <div className=\"item\">\r\n                                <div className=\"itemHeader\">CT检测信息</div>\r\n                                <div className=\"itemTxt\">{\"Study Instance UID：\" +textFormat(thisData?.dict['0020000D'])}</div>\r\n                                <div className=\"itemTxt\">{\"Study Date：\" +dicomDateTimeToLocale(textFormat(thisData?.dict['00080020']),'date')}</div>\r\n                                <div className=\"itemTxt\">{\"Study Time：\" +dicomTimeToLocale(textFormat(thisData?.dict['00080030']))}</div>\r\n                                <div className=\"itemTxt\">{\"Study ID：\" +textFormat(thisData?.dict['00200010'])}</div>\r\n                                <div className=\"itemTxt\">{\"Study Description：\" +textFormat(thisData?.dict['00081030'])}</div>\r\n                            </div>\r\n                            <div className=\"item\">\r\n                                <div className=\"itemHeader\">序列</div>\r\n                                <div className=\"itemTxt\">{\"Series Instance UlD：\" + textFormat(thisData?.dict['0020000E'])}</div>\r\n                                <div className=\"itemTxt\">{\"Series Date：\" + dicomDateTimeToLocale(textFormat(thisData?.dict['00080021']),'date')}</div>\r\n                                <div className=\"itemTxt\">{\"Series Time：\" +dicomTimeToLocale(textFormat(thisData?.dict['00080031']))}</div>\r\n                                <div className=\"itemTxt\">{\"Series Number：\" +textFormat(thisData?.dict['00200011'])}</div>\r\n                                <div className=\"itemTxt\">{\"Modality：\" +textFormat(thisData?.dict['00080060'])}</div>\r\n                                <div className=\"itemTxt\">{\"Institution Name：\" +textFormat(thisData?.dict['00080080'] ? thisData?.dict['00080080'] : 'No Institution')}</div>\r\n                                <div className=\"itemTxt\">{\"Series Description：\" +textFormat(thisData?.dict['0008103E'])}</div>\r\n                            </div>\r\n                            <div className=\"item\">\r\n                                <div className=\"itemHeader\">DICOM对象</div>\r\n                                <div className=\"itemTxt\">{\"SOP Instance UID：\" +textFormat(thisData?.dict['00080018'])}</div>\r\n                                <div className=\"itemTxt\">{\"Image Type：\" +textFormat(thisData?.dict['00080008'])}</div>\r\n                                <div className=\"itemTxt\">{\"Transfer Syntax UID：\" +textFormat(thisData.meta['00020010'])}</div>\r\n                                <div className=\"itemTxt\">{\"Instance Number：\" +textFormat(thisData?.dict['00200013'])}</div>\r\n                                <div className=\"itemTxt\">{\"Photometric Interpretation：\" +textFormat(thisData?.dict['00280004'])}</div>\r\n                                <div className=\"itemTxt\">{\"Samples per Pixel：\" +textFormat(thisData?.dict['00280002'])}</div>\r\n                                <div className=\"itemTxt\">{\"Pixel Representation：\" +textFormat(thisData?.dict['00280103'])}</div>\r\n                                <div className=\"itemTxt\">{\"Rows：\" +textFormat(thisData?.dict['00280010'])}</div>\r\n                                <div className=\"itemTxt\">{\"Columns：\" +textFormat(thisData?.dict['00280011'])}</div>\r\n                                <div className=\"itemTxt\">{\"Bits Allocated：\" +textFormat(thisData?.dict['00280100'])}</div>\r\n                                <div className=\"itemTxt\">{\"Bits Stored：\" +textFormat(thisData?.dict['00280101'])}</div>\r\n                            </div>\r\n                        </div>\r\n                    </TabPane>\r\n                    <TabPane tab=\"全部DICOM属性\" key=\"1\">\r\n                        <div className=\"searchBox\">\r\n                            <Input\r\n                                value={input2}\r\n                                placeholder=\"输入查询字段\"\r\n                                allowClear\r\n                               onChange={e => inputChange(e, 1)}\r\n                            />\r\n                            <Button type=\"primary\" className=\"btn\" icon={<ArrowUpOutlined />}\r\n                                    onClick={e => onSearch(input2, 1, 'up')}\r\n                            ></Button>\r\n                            <Button type=\"primary\" className=\"btn\" icon={<ArrowDownOutlined />}\r\n                                    onClick={e => onSearch(input2, 1, 'down')}\r\n                            ></Button>\r\n                        </div>\r\n                        <div className=\"rawInfoBox\" dangerouslySetInnerHTML={{__html: thisData?.dcmHTML}}></div>\r\n                    </TabPane>\r\n                </Tabs>\r\n                :null\r\n        }\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ModalContent\r\n","import React, { useState } from 'react'\r\nimport './Toolbar.scss'\r\nimport IconFont from '../common/IconFont/index'\r\nimport { Tooltip, Button, Modal } from 'antd'\r\nimport ModalContent from '../ModalContent/ModalContent'\r\n\r\nconst toolbarList = [\r\n  {\r\n    id: 1,\r\n    text: '自动播放',\r\n    icon: <IconFont style={{ fontSize: '24px' }} type=\"icon-asmkticon0229\" />,\r\n    type: 'playClip',\r\n    checked: false,\r\n    filter: true,\r\n  },\r\n  {\r\n    id: 2,\r\n    text: '垂直翻转',\r\n    icon: <IconFont style={{ fontSize: '20px' }} type=\"icon-fanzhuan1\" />,\r\n    type: 'vflip',\r\n    checked: false,\r\n    filter: true,\r\n  },\r\n  {\r\n    id: 3,\r\n    text: '水平翻转',\r\n    icon: <IconFont style={{ fontSize: '20px' }} type=\"icon-fanzhuan\" />,\r\n    type: 'hflip',\r\n    checked: false,\r\n    filter: true,\r\n  },\r\n  {\r\n    id: 4,\r\n    text: '放大',\r\n    icon: <IconFont style={{ fontSize: '26px' }} type=\"icon-fangda\" />,\r\n    type: 'Magnify',\r\n    checked: false,\r\n  },\r\n  // {\r\n  //   id: 5,\r\n  //   text: '聚焦',\r\n  //   icon: <IconFont style={{ fontSize: '24px' }} type=\"icon-jujiao\" />,\r\n  //   type: 'focus',\r\n  //   checked: false,\r\n  // },\r\n  {\r\n    id: 6,\r\n    type: 'hr',\r\n  },\r\n  {\r\n    id: 7,\r\n    text: '圆形',\r\n    icon: <IconFont style={{ fontSize: '24px' }} type=\"icon-yuanxing\" />,\r\n    type: 'EllipticalRoi',\r\n    checked: false,\r\n  },\r\n  // {\r\n  //   id: 8,\r\n  //   text: '矩形',\r\n  //   icon: <IconFont style={{ fontSize: '24px' }} type=\"icon-juxing\" />,\r\n  //   type: 'RectangleRoi',\r\n  //   checked: false,\r\n  // },\r\n  {\r\n    id: 9,\r\n    text: '角度选择',\r\n    icon: <IconFont style={{ fontSize: '18px' }} type=\"icon-jiaoduceliang\" />,\r\n    type: 'Angle',\r\n    checked: false,\r\n  },\r\n  {\r\n    id: 10,\r\n    text: '尺子',\r\n    icon: <IconFont style={{ fontSize: '22px' }} type=\"icon-02-chizi\" />,\r\n    type: 'Length',\r\n    checked: false,\r\n  },\r\n  {\r\n    id: 17,\r\n    text: '矩形',\r\n    icon: <IconFont style={{ fontSize: '24px' }} type=\"icon-juxing\" />,\r\n    type: 'RectangleRoi',\r\n    checked: false,\r\n  },\r\n  {\r\n    id: 11,\r\n    text: '缩放',\r\n    icon: <IconFont style={{ fontSize: '18px' }} type=\"icon-zoom\" />,\r\n    type: 'Zoom',\r\n    checked: false,\r\n  },\r\n  {\r\n    id: 12,\r\n    text: '平移',\r\n    icon: <IconFont style={{ fontSize: '18px' }} type=\"icon-move\" />,\r\n    type: 'Pan',\r\n    checked: false,\r\n  },\r\n  {\r\n    id: 13,\r\n    type: 'hr',\r\n  },\r\n  {\r\n    id: 14,\r\n    text: '复原图像',\r\n    icon: <IconFont style={{ fontSize: '18px' }} type=\"icon-reset_defalut\" />,\r\n    type: 'Reset',\r\n    checked: false,\r\n  },\r\n  {\r\n    id: 15,\r\n    text: '清除标注',\r\n    icon: <IconFont style={{ fontSize: '18px' }} type=\"icon-qingchuhuancun\" />,\r\n    type: 'Eraser',\r\n    checked: false,\r\n  },\r\n  {\r\n    id: 16,\r\n    type: 'hr',\r\n  },\r\n  {\r\n    id: 18,\r\n    text: '结节标注',\r\n    icon: <IconFont style={{ fontSize: '26px' }} type=\"icon-juxing2\" />,\r\n    type: 'AddNodule',\r\n    checked: false,\r\n  },\r\n]\r\n\r\nconst Toolbar = props => {\r\n  const [visible, setVisible] = useState(false)\r\n  const [state, setstate] = useState(toolbarList)\r\n\r\n  const handleToolbarClick = (e, index, type) => {\r\n    if (type === 'playClip' || type === 'vflip' || type === 'hflip') {\r\n      state[index].checked = !state[index].checked\r\n      setstate([...state])\r\n    } else if (type === 'Reset') {\r\n      props.handleToolbarClick(type, state[index].checked)\r\n      state.map(item => {\r\n        if (item.type === 'vflip' || item.type === 'hflip') item.checked = false\r\n      })\r\n      setstate([...state])\r\n      return\r\n    } else {\r\n      state[index].checked = !state[index].checked\r\n      state.map(item => {\r\n        if (item.type !== type && item.type !== 'playClip' && item.type !== 'vflip' && item.type !== 'hflip')\r\n          item.checked = false\r\n      })\r\n      setstate([...state])\r\n    }\r\n\r\n    // 父组件传值\r\n    props.handleToolbarClick(type, state[index].checked)\r\n\r\n  }\r\n\r\n  return (\r\n    <ul className=\"tool-bar-wrap\">\r\n      <div className=\"tool-bar-box\">\r\n        <div className=\"back-btn\" onClick={() => props.setShowViewer(false)}>\r\n          <IconFont style={{ fontSize: '24px' }} type=\"icon-back\" />\r\n        </div>\r\n        <div className=\"tool-bar\">\r\n          {toolbarList.map((item, index) => {\r\n            return item.type === 'hr' ? (\r\n              <li key={item.id} className=\"hr\">\r\n                <div></div>\r\n              </li>\r\n            ) : (\r\n              <li\r\n                id={item.type === 'AddNodule' && item.checked ? 'mark' : null}\r\n                key={item.id}\r\n                className={item.checked ? (item.filter ? 'filter-active' : 'active') : ''}\r\n                onClick={e => handleToolbarClick(e, index, item.type)}\r\n                data-type={item.type}\r\n              >\r\n                <Tooltip title={item.text}>{item.icon}</Tooltip>\r\n              </li>\r\n            )\r\n          })}\r\n        </div>\r\n      </div>\r\n      <div className=\"show-modal\">\r\n        <Button onClick={props.handleExportExcel} style={{ marginRight: 15 }}>\r\n          导出结节信息\r\n        </Button>\r\n        <Button onClick={() => setVisible(true)}>查看头信息</Button>\r\n      </div>\r\n\r\n      <Modal\r\n        title=\"DICOM信息\"\r\n        centered\r\n        visible={visible}\r\n        onOk={() => setVisible(false)}\r\n        onCancel={() => setVisible(false)}\r\n        bodyStyle={{\r\n          height: 800,\r\n        }}\r\n        destroyOnClose={true}\r\n        width={600}\r\n        footer={null}\r\n      >\r\n        <ModalContent globalData={props.globalData} />\r\n      </Modal>\r\n    </ul>\r\n  )\r\n}\r\n\r\nexport default Toolbar\r\n","import React, { useState, createRef, useEffect } from 'react'\r\nimport './MiddleSidePanel.scss'\r\nimport { Checkbox, Button, Input, Descriptions, Popconfirm  } from 'antd'\r\n\r\nconst { TextArea } = Input\r\n\r\nconst MiddleSidePanel = props => {\r\n  const handleListClick = (index, num) => {\r\n    props.onCheckChange(index, num)\r\n  }\r\n\r\n  const [suggest, setSuggest] = useState('')\r\n\r\n  const textAreaRef = createRef()\r\n\r\n  const size = 'small'\r\n\r\n  useEffect(() => {\r\n    setSuggest(props.noduleSuggest)\r\n  }, [props.noduleSuggest])\r\n\r\n  const handleSave = () => {\r\n    props.handleTextareaOnChange(suggest)\r\n    // textAreaRef.current.blur()\r\n  }\r\n\r\n  return (\r\n    <div className=\"middle-side-panel-box-wrap\">\r\n      <div className=\"middle-side-panel-box\">\r\n        <div className=\"basic-info-box\">\r\n          <div className=\"title\">基本信息</div>\r\n          <Descriptions column={1} size={size}>\r\n            <Descriptions.Item label=\"姓名\">{props.data.patientName}</Descriptions.Item>\r\n            <Descriptions.Item label=\"性别\">\r\n              {props.data.patientGender === '**'\r\n                ? props.data.patientGender\r\n                : props.data.patientGender === 'M'\r\n                ? '男'\r\n                : '女'}\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"年龄\">\r\n              {props.data.patientBirthday && props.data.patientBirthday.toString().slice(0, 2) > 18\r\n                ? new Date().getFullYear() - Number(props.data.patientBirthday.toString().slice(0, 4))\r\n                : '**'}\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"病人ID\">{props.data.patientID}</Descriptions.Item>\r\n            <Descriptions.Item label=\"检查时间\">{props.data.acquisitionDate}</Descriptions.Item>\r\n          </Descriptions>\r\n        </div>\r\n        <div className=\"nodule-list-box\">\r\n          <div className=\"title\">结节列表（{props.noduleList?.length}）</div>\r\n          <div className=\"table-box\">\r\n            <div className=\"table-title\">\r\n              <Checkbox disabled checked={true}>\r\n                <div className=\"num\">中心帧</div>\r\n              </Checkbox>\r\n              <div className=\"lung\">肺</div>\r\n              <div className=\"lobe\">肺叶</div>\r\n              <div className=\"type\">类型</div>\r\n              <div className=\"suggest\">建议</div>\r\n              <div className=\"action\">操作</div>\r\n            </div>\r\n            <div id=\"tableIItemBox\" className=\"table-content\">\r\n              {props.noduleList?.map((item, index) => (\r\n                <div\r\n                  key={item.noduleNum}\r\n                  className={`table-item ${item.active ? 'item-active' : ''}`}\r\n                  onClick={e => handleListClick(index, item.num)}\r\n                >\r\n                  <Checkbox onChange={e => props.onCheckChange(index, item.num)} checked={item.checked}>\r\n                    <div className=\"num\">{item.num}</div>\r\n                  </Checkbox>\r\n                  <div className=\"lung\">{item.lung}</div>\r\n                  <div className=\"lobe\">{item.lobe}</div>\r\n                  <div className=\"type\">{item.type}</div>\r\n                  <div className=\"suggest\">{item.suggest}</div>\r\n                  <div className=\"action\">\r\n                    <Popconfirm title=\"确定删除该结节信息？\" okText=\"确定\" cancelText=\"取消\" placement=\"topRight\" onConfirm={e => props.handleDeleteNode(e, item)}>\r\n                      删除\r\n                    </Popconfirm>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"image-info-box\">\r\n          <div className=\"info-box\">\r\n            <div className=\"suggest-box\">\r\n              <div className=\"title\">结节总结</div>\r\n              <div className=\"suggest-content\">\r\n                <div className=\"suggest-content-wrap\">\r\n                  <TextArea\r\n                    ref={textAreaRef}\r\n                    placeholder=\"请输入结节总结信息\"\r\n                    bordered={false}\r\n                    rows={6}\r\n                    maxLength={150}\r\n                    style={{\r\n                      width: '100%',\r\n                      resize: 'none',\r\n                    }}\r\n                    value={suggest}\r\n                    onChange={e => setSuggest(e.target.value)}\r\n                  />\r\n                </div>\r\n                <div className=\"save\">\r\n                  <Button type=\"primary\" size=\"small\" onClick={handleSave}>\r\n                    保存\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default MiddleSidePanel\r\n","let defaultColor = 'red',\r\n  activeColor = 'red',\r\n  fillColor = 'transparent'\r\n\r\nfunction setFillColor(color) {\r\n  fillColor = color\r\n}\r\n\r\nfunction getFillColor() {\r\n  return fillColor\r\n}\r\n\r\nfunction setToolColor(color) {\r\n  defaultColor = color\r\n}\r\n\r\nfunction getToolColor() {\r\n  return defaultColor\r\n}\r\n\r\nfunction setActiveColor(color) {\r\n  activeColor = color\r\n}\r\n\r\nfunction getActiveColor() {\r\n  return activeColor\r\n}\r\n\r\nfunction getColorIfActive(data) {\r\n  if (data.color) {\r\n    return data.color\r\n  }\r\n\r\n  return data.active ? activeColor : defaultColor\r\n}\r\n\r\nconst toolColors = {\r\n  setFillColor,\r\n  getFillColor,\r\n  setToolColor,\r\n  getToolColor,\r\n  setActiveColor,\r\n  getActiveColor,\r\n  getColorIfActive,\r\n}\r\n\r\nexport default toolColors\r\n","let defaultWidth = 1,\r\n  activeWidth = 2\r\n\r\nfunction setToolWidth(width) {\r\n  defaultWidth = width\r\n}\r\n\r\nfunction getToolWidth() {\r\n  return defaultWidth\r\n}\r\n\r\nfunction setActiveWidth(width) {\r\n  activeWidth = width\r\n}\r\n\r\nfunction getActiveWidth() {\r\n  return activeWidth\r\n}\r\n\r\nconst toolStyle = {\r\n  setToolWidth,\r\n  getToolWidth,\r\n  setActiveWidth,\r\n  getActiveWidth,\r\n}\r\n\r\nexport default toolStyle\r\n","import cornerstone from 'cornerstone-core'\r\nimport toolStyle from './toolStyle.js'\r\n\r\nfunction getToolState(element, toolName) {\r\n  const toolStateManager = getElementToolStateManager(element)\r\n  return toolStateManager.get(element, toolName)\r\n}\r\n\r\nfunction getElementToolStateManager(element) {\r\n  const enabledElement = cornerstone.getEnabledElement(element)\r\n  return enabledElement.toolStateManager\r\n}\r\n\r\nfunction getNewContext(canvas) {\r\n  const context = canvas.getContext('2d')\r\n  context.setTransform(1, 0, 0, 1, 0, 0)\r\n  return context\r\n}\r\n\r\nfunction draw(context, fn) {\r\n  context.save()\r\n  fn(context)\r\n  context.restore()\r\n}\r\n\r\nfunction rotatePoint(point, center, angle) {\r\n  const angleRadians = angle * (Math.PI / 180) // Convert to radians\r\n  const rotatedX =\r\n    Math.cos(angleRadians) * (point.x - center.x) - Math.sin(angleRadians) * (point.y - center.y) + center.x\r\n  const rotatedY =\r\n    Math.sin(angleRadians) * (point.x - center.x) + Math.cos(angleRadians) * (point.y - center.y) + center.y\r\n\r\n  return {\r\n    x: rotatedX,\r\n    y: rotatedY,\r\n  }\r\n}\r\n\r\nfunction path(context, options = {}, fn) {\r\n  const { color, lineWidth, fillStyle, lineDash, shouldDrawLines = true } = options\r\n\r\n  context.beginPath()\r\n  context.strokeStyle = color || context.strokeStyle\r\n\r\n  context.lineWidth = lineWidth || (lineWidth === undefined && toolStyle.getToolWidth()) || context.lineWidth\r\n  if (lineDash) {\r\n    context.setLineDash(lineDash)\r\n  }\r\n\r\n  fn(context)\r\n\r\n  if (fillStyle) {\r\n    context.fillStyle = fillStyle\r\n    context.fill()\r\n  }\r\n\r\n  if (shouldDrawLines) {\r\n    context.stroke()\r\n  }\r\n\r\n  if (lineDash) {\r\n    context.setLineDash([])\r\n  }\r\n}\r\n\r\nfunction drawRect(context, element, corner1, corner2, options, coordSystem = 'pixel', initialRotation = 0.0) {\r\n  if (coordSystem === 'pixel') {\r\n    corner1 = cornerstone.pixelToCanvas(element, corner1)\r\n    corner2 = cornerstone.pixelToCanvas(element, corner2)\r\n  }\r\n\r\n  const viewport = cornerstone.getViewport(element)\r\n\r\n  // Calculate the center of the image\r\n  const { clientWidth: width, clientHeight: height } = element\r\n  const { scale, translation } = viewport\r\n  const rotation = viewport.rotation - initialRotation\r\n\r\n  const centerPoint = {\r\n    x: width / 2 + translation.x * scale,\r\n    y: height / 2 + translation.y * scale,\r\n  }\r\n\r\n  if (Math.abs(rotation) > 0.05) {\r\n    corner1 = rotatePoint(corner1, centerPoint, -rotation)\r\n    corner2 = rotatePoint(corner2, centerPoint, -rotation)\r\n  }\r\n\r\n  const w = Math.abs(corner1.x - corner2.x)\r\n  const h = Math.abs(corner1.y - corner2.y)\r\n\r\n  corner1 = {\r\n    x: Math.min(corner1.x, corner2.x),\r\n    y: Math.min(corner1.y, corner2.y),\r\n  }\r\n\r\n  corner2 = {\r\n    x: corner1.x + w,\r\n    y: corner1.y + h,\r\n  }\r\n\r\n  let corner3 = {\r\n    x: corner1.x + w,\r\n    y: corner1.y,\r\n  }\r\n\r\n  let corner4 = {\r\n    x: corner1.x,\r\n    y: corner1.y + h,\r\n  }\r\n\r\n  if (Math.abs(rotation) > 0.05) {\r\n    corner1 = rotatePoint(corner1, centerPoint, rotation)\r\n    corner2 = rotatePoint(corner2, centerPoint, rotation)\r\n    corner3 = rotatePoint(corner3, centerPoint, rotation)\r\n    corner4 = rotatePoint(corner4, centerPoint, rotation)\r\n  }\r\n\r\n  path(context, options, context => {\r\n    context.moveTo(corner1.x, corner1.y)\r\n    context.lineTo(corner3.x, corner3.y)\r\n    context.lineTo(corner2.x, corner2.y)\r\n    context.lineTo(corner4.x, corner4.y)\r\n    context.lineTo(corner1.x, corner1.y)\r\n  })\r\n}\r\n\r\nfunction getPixelSpacing(image) {\r\n  const imagePlane = cornerstone.metaData.get('imagePlaneModule', image.imageId)\r\n\r\n  if (imagePlane) {\r\n    return {\r\n      rowPixelSpacing: imagePlane.rowPixelSpacing || imagePlane.rowImagePixelSpacing,\r\n      colPixelSpacing: imagePlane.columnPixelSpacing || imagePlane.colImagePixelSpacing,\r\n    }\r\n  }\r\n\r\n  return {\r\n    rowPixelSpacing: image.rowPixelSpacing,\r\n    colPixelSpacing: image.columnPixelSpacing,\r\n  }\r\n}\r\n\r\nfunction calculateSUV(image, storedPixelValue, skipRescale = false) {\r\n  const patientStudyModule = cornerstone.metaData.get('patientStudyModule', image.imageId)\r\n  const seriesModule = cornerstone.metaData.get('generalSeriesModule', image.imageId)\r\n\r\n  if (!patientStudyModule || !seriesModule) {\r\n    return\r\n  }\r\n\r\n  const modality = seriesModule.modality\r\n\r\n  // Image must be PET\r\n  if (modality !== 'PT') {\r\n    return\r\n  }\r\n\r\n  const modalityPixelValue = skipRescale ? storedPixelValue : storedPixelValue * image.slope + image.intercept\r\n\r\n  const patientWeight = patientStudyModule.patientWeight // In kg\r\n\r\n  if (!patientWeight) {\r\n    return\r\n  }\r\n\r\n  const petSequenceModule = cornerstone.metaData.get('petIsotopeModule', image.imageId)\r\n\r\n  if (!petSequenceModule) {\r\n    return\r\n  }\r\n\r\n  const radiopharmaceuticalInfo = petSequenceModule.radiopharmaceuticalInfo\r\n  const startTime = radiopharmaceuticalInfo.radiopharmaceuticalStartTime\r\n  const totalDose = radiopharmaceuticalInfo.radionuclideTotalDose\r\n  const halfLife = radiopharmaceuticalInfo.radionuclideHalfLife\r\n  const seriesAcquisitionTime = seriesModule.seriesTime\r\n\r\n  if (!startTime || !totalDose || !halfLife || !seriesAcquisitionTime) {\r\n    return\r\n  }\r\n\r\n  const acquisitionTimeInSeconds =\r\n    fracToDec(seriesAcquisitionTime.fractionalSeconds || 0) +\r\n    seriesAcquisitionTime.seconds +\r\n    seriesAcquisitionTime.minutes * 60 +\r\n    seriesAcquisitionTime.hours * 60 * 60\r\n  const injectionStartTimeInSeconds =\r\n    fracToDec(startTime.fractionalSeconds || 0) + startTime.seconds + startTime.minutes * 60 + startTime.hours * 60 * 60\r\n  const durationInSeconds = acquisitionTimeInSeconds - injectionStartTimeInSeconds\r\n  const correctedDose = totalDose * Math.exp((-durationInSeconds * Math.log(2)) / halfLife)\r\n  const suv = ((modalityPixelValue * patientWeight) / correctedDose) * 1000\r\n\r\n  return suv\r\n}\r\n\r\n/**\r\n * Returns a decimal value given a fractional value.\r\n * @private\r\n * @method\r\n * @name fracToDec\r\n *\r\n * @param  {number} fractionalValue The value to convert.\r\n * @returns {number}                 The value converted to decimal.\r\n */\r\nfunction fracToDec(fractionalValue) {\r\n  return parseFloat(`.${fractionalValue}`)\r\n}\r\n\r\nexport {\r\n  getToolState,\r\n  getElementToolStateManager,\r\n  getNewContext,\r\n  rotatePoint,\r\n  draw,\r\n  path,\r\n  drawRect,\r\n  getPixelSpacing,\r\n  calculateSUV,\r\n}\r\n","import csTools from 'cornerstone-tools'\r\nimport toolColors from './toolColors.js'\r\nimport { getToolState, getNewContext, draw, drawRect, getPixelSpacing, calculateSUV } from './util'\r\n\r\nconst BaseAnnotationTool = csTools.importInternal('base/BaseAnnotationTool')\r\n\r\nexport default class MarkNoduleTool extends BaseAnnotationTool {\r\n  constructor(props = {}) {\r\n    const defaultProps = {\r\n      name: 'MarkNodule',\r\n      supportedInteractionTypes: ['Mouse'],\r\n      configuration: {\r\n        drawHandles: false,\r\n        drawHandlesOnHover: false,\r\n        hideHandlesIfMoving: true,\r\n        renderDashed: false,\r\n      },\r\n    }\r\n\r\n    super(props, defaultProps)\r\n  }\r\n\r\n  handleSelectedCallback(e) {\r\n    // 覆盖父类方法，禁止工具选中\r\n  }\r\n\r\n  createNewMeasurement(eventData) {\r\n    return {\r\n      visible: true,\r\n      active: false,\r\n      color: undefined,\r\n      invalidated: true,\r\n      handles: {\r\n        start: {\r\n          x: eventData.currentPoints.image.x,\r\n          y: eventData.currentPoints.image.y,\r\n          highlight: false,\r\n          active: false,\r\n        },\r\n        end: {\r\n          x: eventData.currentPoints.image.x,\r\n          y: eventData.currentPoints.image.y,\r\n          highlight: false,\r\n          active: false,\r\n        },\r\n      },\r\n    }\r\n  }\r\n\r\n  pointNearTool(element, data, coords, interactionType) {\r\n    return false\r\n  }\r\n\r\n  // 获取工具框选的信息\r\n  updateCachedStats(image, element, data) {\r\n    const seriesModule = window.cornerstone.metaData.get('generalSeriesModule', image.imageId) || {}\r\n    const modality = seriesModule.modality\r\n    const pixelSpacing = getPixelSpacing(image)\r\n\r\n    const stats = _calculateStats(image, element, data.handles, modality, pixelSpacing)\r\n\r\n    data.cachedStats = stats\r\n    data.invalidated = false\r\n  }\r\n\r\n  renderToolData(evt) {\r\n    const toolData = getToolState(evt.currentTarget, this.name)\r\n\r\n    if (!toolData) {\r\n      return\r\n    }\r\n\r\n    const eventData = evt.detail\r\n    const { element } = eventData\r\n    const context = getNewContext(eventData.canvasContext.canvas)\r\n\r\n    draw(context, context => {\r\n      // If we have tool data for this element - iterate over each set and draw it\r\n      for (let i = 0; i < toolData.data.length; i++) {\r\n        const data = toolData.data[i]\r\n\r\n        if (data.visible === false) {\r\n          continue\r\n        }\r\n\r\n        // Configure\r\n        const color = toolColors.getColorIfActive(data)\r\n\r\n        const rectOptions = { color }\r\n\r\n        // Draw\r\n        drawRect(\r\n          context,\r\n          element,\r\n          data.handles.start,\r\n          data.handles.end,\r\n          rectOptions,\r\n          'pixel',\r\n          data.handles.initialRotation\r\n        )\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nfunction _getRectangleImageCoordinates(startHandle, endHandle) {\r\n  return {\r\n    left: Math.min(startHandle.x, endHandle.x),\r\n    top: Math.min(startHandle.y, endHandle.y),\r\n    width: Math.abs(startHandle.x - endHandle.x),\r\n    height: Math.abs(startHandle.y - endHandle.y),\r\n  }\r\n}\r\n\r\nfunction _calculateRectangleStats(sp, rectangle) {\r\n  let sum = 0\r\n  let sumSquared = 0\r\n  let count = 0\r\n  let index = 0\r\n  let min = sp ? sp[0] : null\r\n  let max = sp ? sp[0] : null\r\n\r\n  for (let y = rectangle.top; y < rectangle.top + rectangle.height; y++) {\r\n    for (let x = rectangle.left; x < rectangle.left + rectangle.width; x++) {\r\n      sum += sp[index]\r\n      sumSquared += sp[index] * sp[index]\r\n      min = Math.min(min, sp[index])\r\n      max = Math.max(max, sp[index])\r\n      count++ // TODO: Wouldn't this just be sp.length?\r\n      index++\r\n    }\r\n  }\r\n\r\n  if (count === 0) {\r\n    return {\r\n      count,\r\n      mean: 0.0,\r\n      variance: 0.0,\r\n      stdDev: 0.0,\r\n      min: 0.0,\r\n      max: 0.0,\r\n    }\r\n  }\r\n\r\n  const mean = sum / count\r\n  const variance = sumSquared / count - mean * mean\r\n\r\n  return {\r\n    count,\r\n    mean,\r\n    variance,\r\n    stdDev: Math.sqrt(variance),\r\n    min,\r\n    max,\r\n  }\r\n}\r\n\r\nfunction _calculateStats(image, element, handles, modality, pixelSpacing) {\r\n  // Retrieve the bounds of the rectangle in image coordinates\r\n  const roiCoordinates = _getRectangleImageCoordinates(handles.start, handles.end)\r\n\r\n  // Retrieve the array of pixels that the rectangle bounds cover\r\n  const pixels = window.cornerstone.getPixels(\r\n    element,\r\n    roiCoordinates.left,\r\n    roiCoordinates.top,\r\n    roiCoordinates.width,\r\n    roiCoordinates.height\r\n  )\r\n\r\n  // Calculate the mean & standard deviation from the pixels and the rectangle details\r\n  const roiMeanStdDev = _calculateRectangleStats(pixels, roiCoordinates)\r\n\r\n  let meanStdDevSUV\r\n\r\n  if (modality === 'PT') {\r\n    meanStdDevSUV = {\r\n      mean: calculateSUV(image, roiMeanStdDev.mean, true) || 0,\r\n      stdDev: calculateSUV(image, roiMeanStdDev.stdDev, true) || 0,\r\n    }\r\n  }\r\n\r\n  // Calculate the image area from the rectangle dimensions and pixel spacing\r\n  const area =\r\n    roiCoordinates.width *\r\n    (pixelSpacing.colPixelSpacing || 1) *\r\n    (roiCoordinates.height * (pixelSpacing.rowPixelSpacing || 1))\r\n\r\n  const perimeter =\r\n    roiCoordinates.width * 2 * (pixelSpacing.colPixelSpacing || 1) +\r\n    roiCoordinates.height * 2 * (pixelSpacing.rowPixelSpacing || 1)\r\n\r\n  return {\r\n    area: area || 0,\r\n    perimeter,\r\n    count: roiMeanStdDev.count || 0,\r\n    mean: roiMeanStdDev.mean || 0,\r\n    variance: roiMeanStdDev.variance || 0,\r\n    stdDev: roiMeanStdDev.stdDev || 0,\r\n    min: roiMeanStdDev.min || 0,\r\n    max: roiMeanStdDev.max || 0,\r\n    meanStdDevSUV,\r\n  }\r\n}\r\n","let defaultColor = 'red',\r\n  activeColor = 'red',\r\n  fillColor = 'transparent'\r\n\r\nfunction setFillColor(color) {\r\n  fillColor = color\r\n}\r\n\r\nfunction getFillColor() {\r\n  return fillColor\r\n}\r\n\r\nfunction setToolColor(color) {\r\n  defaultColor = color\r\n}\r\n\r\nfunction getToolColor() {\r\n  return defaultColor\r\n}\r\n\r\nfunction setActiveColor(color) {\r\n  activeColor = color\r\n}\r\n\r\nfunction getActiveColor() {\r\n  return activeColor\r\n}\r\n\r\nfunction getColorIfActive(data) {\r\n  if (data.color) {\r\n    return data.color\r\n  }\r\n\r\n  return data.active ? activeColor : defaultColor\r\n}\r\n\r\nconst toolColors = {\r\n  setFillColor,\r\n  getFillColor,\r\n  setToolColor,\r\n  getToolColor,\r\n  setActiveColor,\r\n  getActiveColor,\r\n  getColorIfActive,\r\n}\r\n\r\nexport default toolColors\r\n","let defaultWidth = 1,\r\n  activeWidth = 2\r\n\r\nfunction setToolWidth(width) {\r\n  defaultWidth = width\r\n}\r\n\r\nfunction getToolWidth() {\r\n  return defaultWidth\r\n}\r\n\r\nfunction setActiveWidth(width) {\r\n  activeWidth = width\r\n}\r\n\r\nfunction getActiveWidth() {\r\n  return activeWidth\r\n}\r\n\r\nconst toolStyle = {\r\n  setToolWidth,\r\n  getToolWidth,\r\n  setActiveWidth,\r\n  getActiveWidth,\r\n}\r\n\r\nexport default toolStyle\r\n","import cornerstone from 'cornerstone-core'\r\nimport toolStyle from './toolStyle.js'\r\n\r\nfunction getToolState(element, toolName) {\r\n  const toolStateManager = getElementToolStateManager(element)\r\n  return toolStateManager.get(element, toolName)\r\n}\r\n\r\nfunction getElementToolStateManager(element) {\r\n  const enabledElement = cornerstone.getEnabledElement(element)\r\n  return enabledElement.toolStateManager\r\n}\r\n\r\nfunction getNewContext(canvas) {\r\n  const context = canvas.getContext('2d')\r\n  context.setTransform(1, 0, 0, 1, 0, 0)\r\n  return context\r\n}\r\n\r\nfunction draw(context, fn) {\r\n  context.save()\r\n  fn(context)\r\n  context.restore()\r\n}\r\n\r\nfunction rotatePoint(point, center, angle) {\r\n  const angleRadians = angle * (Math.PI / 180) // Convert to radians\r\n  const rotatedX =\r\n    Math.cos(angleRadians) * (point.x - center.x) - Math.sin(angleRadians) * (point.y - center.y) + center.x\r\n  const rotatedY =\r\n    Math.sin(angleRadians) * (point.x - center.x) + Math.cos(angleRadians) * (point.y - center.y) + center.y\r\n\r\n  return {\r\n    x: rotatedX,\r\n    y: rotatedY,\r\n  }\r\n}\r\n\r\nfunction path(context, options = {}, fn) {\r\n  const { color, lineWidth, fillStyle, lineDash, shouldDrawLines = true } = options\r\n\r\n  context.beginPath()\r\n  context.strokeStyle = color || context.strokeStyle\r\n\r\n  context.lineWidth = lineWidth || (lineWidth === undefined && toolStyle.getToolWidth()) || context.lineWidth\r\n  if (lineDash) {\r\n    context.setLineDash(lineDash)\r\n  }\r\n\r\n  fn(context)\r\n\r\n  if (fillStyle) {\r\n    context.fillStyle = fillStyle\r\n    context.fill()\r\n  }\r\n\r\n  if (shouldDrawLines) {\r\n    context.stroke()\r\n  }\r\n\r\n  if (lineDash) {\r\n    context.setLineDash([])\r\n  }\r\n}\r\n\r\nfunction drawRect(context, element, corner1, corner2, options, coordSystem = 'pixel', initialRotation = 0.0) {\r\n  if (coordSystem === 'pixel') {\r\n    corner1 = cornerstone.pixelToCanvas(element, corner1)\r\n    corner2 = cornerstone.pixelToCanvas(element, corner2)\r\n  }\r\n\r\n  const viewport = cornerstone.getViewport(element)\r\n\r\n  // Calculate the center of the image\r\n  const { clientWidth: width, clientHeight: height } = element\r\n  const { scale, translation } = viewport\r\n  const rotation = viewport.rotation - initialRotation\r\n\r\n  const centerPoint = {\r\n    x: width / 2 + translation.x * scale,\r\n    y: height / 2 + translation.y * scale,\r\n  }\r\n\r\n  if (Math.abs(rotation) > 0.05) {\r\n    corner1 = rotatePoint(corner1, centerPoint, -rotation)\r\n    corner2 = rotatePoint(corner2, centerPoint, -rotation)\r\n  }\r\n\r\n  const w = Math.abs(corner1.x - corner2.x)\r\n  const h = Math.abs(corner1.y - corner2.y)\r\n\r\n  corner1 = {\r\n    x: Math.min(corner1.x, corner2.x),\r\n    y: Math.min(corner1.y, corner2.y),\r\n  }\r\n\r\n  corner2 = {\r\n    x: corner1.x + w,\r\n    y: corner1.y + h,\r\n  }\r\n\r\n  let corner3 = {\r\n    x: corner1.x + w,\r\n    y: corner1.y,\r\n  }\r\n\r\n  let corner4 = {\r\n    x: corner1.x,\r\n    y: corner1.y + h,\r\n  }\r\n\r\n  if (Math.abs(rotation) > 0.05) {\r\n    corner1 = rotatePoint(corner1, centerPoint, rotation)\r\n    corner2 = rotatePoint(corner2, centerPoint, rotation)\r\n    corner3 = rotatePoint(corner3, centerPoint, rotation)\r\n    corner4 = rotatePoint(corner4, centerPoint, rotation)\r\n  }\r\n\r\n  path(context, options, context => {\r\n    context.moveTo(corner1.x, corner1.y)\r\n    context.lineTo(corner3.x, corner3.y)\r\n    context.lineTo(corner2.x, corner2.y)\r\n    context.lineTo(corner4.x, corner4.y)\r\n    context.lineTo(corner1.x, corner1.y)\r\n  })\r\n}\r\n\r\nfunction getPixelSpacing(image) {\r\n  const imagePlane = cornerstone.metaData.get('imagePlaneModule', image.imageId)\r\n\r\n  if (imagePlane) {\r\n    return {\r\n      rowPixelSpacing: imagePlane.rowPixelSpacing || imagePlane.rowImagePixelSpacing,\r\n      colPixelSpacing: imagePlane.columnPixelSpacing || imagePlane.colImagePixelSpacing,\r\n    }\r\n  }\r\n\r\n  return {\r\n    rowPixelSpacing: image.rowPixelSpacing,\r\n    colPixelSpacing: image.columnPixelSpacing,\r\n  }\r\n}\r\n\r\nfunction calculateSUV(image, storedPixelValue, skipRescale = false) {\r\n  const patientStudyModule = cornerstone.metaData.get('patientStudyModule', image.imageId)\r\n  const seriesModule = cornerstone.metaData.get('generalSeriesModule', image.imageId)\r\n\r\n  if (!patientStudyModule || !seriesModule) {\r\n    return\r\n  }\r\n\r\n  const modality = seriesModule.modality\r\n\r\n  // Image must be PET\r\n  if (modality !== 'PT') {\r\n    return\r\n  }\r\n\r\n  const modalityPixelValue = skipRescale ? storedPixelValue : storedPixelValue * image.slope + image.intercept\r\n\r\n  const patientWeight = patientStudyModule.patientWeight // In kg\r\n\r\n  if (!patientWeight) {\r\n    return\r\n  }\r\n\r\n  const petSequenceModule = cornerstone.metaData.get('petIsotopeModule', image.imageId)\r\n\r\n  if (!petSequenceModule) {\r\n    return\r\n  }\r\n\r\n  const radiopharmaceuticalInfo = petSequenceModule.radiopharmaceuticalInfo\r\n  const startTime = radiopharmaceuticalInfo.radiopharmaceuticalStartTime\r\n  const totalDose = radiopharmaceuticalInfo.radionuclideTotalDose\r\n  const halfLife = radiopharmaceuticalInfo.radionuclideHalfLife\r\n  const seriesAcquisitionTime = seriesModule.seriesTime\r\n\r\n  if (!startTime || !totalDose || !halfLife || !seriesAcquisitionTime) {\r\n    return\r\n  }\r\n\r\n  const acquisitionTimeInSeconds =\r\n    fracToDec(seriesAcquisitionTime.fractionalSeconds || 0) +\r\n    seriesAcquisitionTime.seconds +\r\n    seriesAcquisitionTime.minutes * 60 +\r\n    seriesAcquisitionTime.hours * 60 * 60\r\n  const injectionStartTimeInSeconds =\r\n    fracToDec(startTime.fractionalSeconds || 0) + startTime.seconds + startTime.minutes * 60 + startTime.hours * 60 * 60\r\n  const durationInSeconds = acquisitionTimeInSeconds - injectionStartTimeInSeconds\r\n  const correctedDose = totalDose * Math.exp((-durationInSeconds * Math.log(2)) / halfLife)\r\n  const suv = ((modalityPixelValue * patientWeight) / correctedDose) * 1000\r\n\r\n  return suv\r\n}\r\n\r\n/**\r\n * Returns a decimal value given a fractional value.\r\n * @private\r\n * @method\r\n * @name fracToDec\r\n *\r\n * @param  {number} fractionalValue The value to convert.\r\n * @returns {number}                 The value converted to decimal.\r\n */\r\nfunction fracToDec(fractionalValue) {\r\n  return parseFloat(`.${fractionalValue}`)\r\n}\r\n\r\nexport {\r\n  getToolState,\r\n  getElementToolStateManager,\r\n  getNewContext,\r\n  rotatePoint,\r\n  draw,\r\n  path,\r\n  drawRect,\r\n  getPixelSpacing,\r\n  calculateSUV,\r\n}\r\n","import csTools from 'cornerstone-tools'\r\nimport toolColors from './toolColors.js'\r\nimport { getToolState, getNewContext, draw, drawRect, getPixelSpacing, calculateSUV } from './util'\r\n\r\nconst BaseAnnotationTool = csTools.importInternal('base/BaseAnnotationTool')\r\n\r\nexport default class AddNoduleTool extends BaseAnnotationTool {\r\n  constructor(props = {}) {\r\n    const defaultProps = {\r\n      name: 'AddNodule',\r\n      supportedInteractionTypes: ['Mouse'],\r\n      configuration: {\r\n        drawHandles: false,\r\n        drawHandlesOnHover: false,\r\n        hideHandlesIfMoving: true,\r\n        renderDashed: false,\r\n      },\r\n    }\r\n\r\n    super(props, defaultProps)\r\n  }\r\n\r\n  handleSelectedCallback(e) {\r\n    // 覆盖父类方法，禁止工具选中\r\n  }\r\n\r\n  createNewMeasurement(eventData) {\r\n    return {\r\n      visible: true,\r\n      active: false,\r\n      color: undefined,\r\n      invalidated: true,\r\n      handles: {\r\n        start: {\r\n          x: eventData.currentPoints.image.x,\r\n          y: eventData.currentPoints.image.y,\r\n          highlight: false,\r\n          active: false,\r\n        },\r\n        end: {\r\n          x: eventData.currentPoints.image.x,\r\n          y: eventData.currentPoints.image.y,\r\n          highlight: false,\r\n          active: false,\r\n        },\r\n      },\r\n    }\r\n  }\r\n\r\n  pointNearTool(element, data, coords, interactionType) {\r\n    return false\r\n  }\r\n\r\n  // 获取工具框选的信息\r\n  updateCachedStats(image, element, data) {\r\n    const seriesModule = window.cornerstone.metaData.get('generalSeriesModule', image.imageId) || {}\r\n    const modality = seriesModule.modality\r\n    const pixelSpacing = getPixelSpacing(image)\r\n\r\n    const stats = _calculateStats(image, element, data.handles, modality, pixelSpacing)\r\n\r\n    data.cachedStats = stats\r\n    data.invalidated = false\r\n  }\r\n\r\n  renderToolData(evt) {\r\n    const toolData = getToolState(evt.currentTarget, this.name)\r\n\r\n    if (!toolData) {\r\n      return\r\n    }\r\n\r\n    const eventData = evt.detail\r\n    const { element } = eventData\r\n    const context = getNewContext(eventData.canvasContext.canvas)\r\n\r\n    draw(context, context => {\r\n      // If we have tool data for this element - iterate over each set and draw it\r\n      for (let i = 0; i < toolData.data.length; i++) {\r\n        const data = toolData.data[i]\r\n\r\n        if (data.visible === false) {\r\n          continue\r\n        }\r\n\r\n        // Configure\r\n        const color = toolColors.getColorIfActive(data)\r\n\r\n        const rectOptions = { color }\r\n\r\n        // Draw\r\n        drawRect(\r\n          context,\r\n          element,\r\n          data.handles.start,\r\n          data.handles.end,\r\n          rectOptions,\r\n          'pixel',\r\n          data.handles.initialRotation\r\n        )\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nfunction _getRectangleImageCoordinates(startHandle, endHandle) {\r\n  return {\r\n    left: Math.min(startHandle.x, endHandle.x),\r\n    top: Math.min(startHandle.y, endHandle.y),\r\n    width: Math.abs(startHandle.x - endHandle.x),\r\n    height: Math.abs(startHandle.y - endHandle.y),\r\n  }\r\n}\r\n\r\nfunction _calculateRectangleStats(sp, rectangle) {\r\n  let sum = 0\r\n  let sumSquared = 0\r\n  let count = 0\r\n  let index = 0\r\n  let min = sp ? sp[0] : null\r\n  let max = sp ? sp[0] : null\r\n\r\n  for (let y = rectangle.top; y < rectangle.top + rectangle.height; y++) {\r\n    for (let x = rectangle.left; x < rectangle.left + rectangle.width; x++) {\r\n      sum += sp[index]\r\n      sumSquared += sp[index] * sp[index]\r\n      min = Math.min(min, sp[index])\r\n      max = Math.max(max, sp[index])\r\n      count++ // TODO: Wouldn't this just be sp.length?\r\n      index++\r\n    }\r\n  }\r\n\r\n  if (count === 0) {\r\n    return {\r\n      count,\r\n      mean: 0.0,\r\n      variance: 0.0,\r\n      stdDev: 0.0,\r\n      min: 0.0,\r\n      max: 0.0,\r\n    }\r\n  }\r\n\r\n  const mean = sum / count\r\n  const variance = sumSquared / count - mean * mean\r\n\r\n  return {\r\n    count,\r\n    mean,\r\n    variance,\r\n    stdDev: Math.sqrt(variance),\r\n    min,\r\n    max,\r\n  }\r\n}\r\n\r\nfunction _calculateStats(image, element, handles, modality, pixelSpacing) {\r\n  // Retrieve the bounds of the rectangle in image coordinates\r\n  const roiCoordinates = _getRectangleImageCoordinates(handles.start, handles.end)\r\n\r\n  // Retrieve the array of pixels that the rectangle bounds cover\r\n  const pixels = window.cornerstone.getPixels(\r\n    element,\r\n    roiCoordinates.left,\r\n    roiCoordinates.top,\r\n    roiCoordinates.width,\r\n    roiCoordinates.height\r\n  )\r\n\r\n  // Calculate the mean & standard deviation from the pixels and the rectangle details\r\n  const roiMeanStdDev = _calculateRectangleStats(pixels, roiCoordinates)\r\n\r\n  let meanStdDevSUV\r\n\r\n  if (modality === 'PT') {\r\n    meanStdDevSUV = {\r\n      mean: calculateSUV(image, roiMeanStdDev.mean, true) || 0,\r\n      stdDev: calculateSUV(image, roiMeanStdDev.stdDev, true) || 0,\r\n    }\r\n  }\r\n\r\n  // Calculate the image area from the rectangle dimensions and pixel spacing\r\n  const area =\r\n    roiCoordinates.width *\r\n    (pixelSpacing.colPixelSpacing || 1) *\r\n    (roiCoordinates.height * (pixelSpacing.rowPixelSpacing || 1))\r\n\r\n  const perimeter =\r\n    roiCoordinates.width * 2 * (pixelSpacing.colPixelSpacing || 1) +\r\n    roiCoordinates.height * 2 * (pixelSpacing.rowPixelSpacing || 1)\r\n\r\n  return {\r\n    area: area || 0,\r\n    perimeter,\r\n    count: roiMeanStdDev.count || 0,\r\n    mean: roiMeanStdDev.mean || 0,\r\n    variance: roiMeanStdDev.variance || 0,\r\n    stdDev: roiMeanStdDev.stdDev || 0,\r\n    min: roiMeanStdDev.min || 0,\r\n    max: roiMeanStdDev.max || 0,\r\n    meanStdDevSUV,\r\n  }\r\n}\r\n","import React from 'react'\r\nimport './AddNewNode.scss'\r\nimport { Radio, Select, Input } from 'antd'\r\nimport cornerstone from 'cornerstone-core'\r\n\r\nconst { Option } = Select\r\n\r\nconst AddNewNode = props => {\r\n  const onLungChange = (e, id) => {\r\n    props.updateToolList(e.target.value, 'lung', id)\r\n  }\r\n\r\n  const onLobeChange = (e, id) => {\r\n    props.updateToolList(e.target.value, 'lobe', id)\r\n  }\r\n\r\n  const handleSelectChange = (val, id) => {\r\n    props.updateToolList(val, 'type', id)\r\n  }\r\n\r\n  return (\r\n    <div className=\"add-new-node-box\">\r\n      <div className=\"title-box\">\r\n        <span className=\"title\">当前帧数：</span>\r\n        <span>\r\n          第 {props.imagesConfig.findIndex(index => index === cornerstone.getImage(props.cornerstoneElement).imageId)} 帧\r\n        </span>\r\n      </div>\r\n\r\n      {props.toolList?.map((item, index) => (\r\n        <div className=\"add-box\" key={item.uuid}>\r\n          <div className=\"list-header\">结节信息</div>\r\n          <div className=\"list\">\r\n            <span className=\"list-title\">肺：</span>\r\n            <Radio.Group value={item.lung} onChange={e => onLungChange(e, item.uuid)}>\r\n              <Radio value={'右肺'}>右肺</Radio>\r\n              <Radio value={'左肺'}>左肺</Radio>\r\n            </Radio.Group>\r\n          </div>\r\n          <div className=\"list\">\r\n            <div className=\"list-title\">肺叶：</div>\r\n            <Radio.Group value={item.lobe} onChange={e => onLobeChange(e, item.uuid)}>\r\n              <Radio value={'上叶'}>上叶</Radio>\r\n              {item.lung === '左肺' ? null : <Radio value={'中叶'}>中叶</Radio>}\r\n              <Radio value={'下叶'}>下叶</Radio>\r\n            </Radio.Group>\r\n          </div>\r\n          <div className=\"list\">\r\n            <div className=\"list-title\">类型：</div>\r\n            <Select\r\n              placeholder={'请选择结节类型'}\r\n              value={item.type}\r\n              style={{ width: 200, fontSize: 13 }}\r\n              onChange={e => handleSelectChange(e, item.uuid)}\r\n            >\r\n              <Option value=\"肺内实性\">肺内实性</Option>\r\n              <Option value=\"部分实性\">部分实性</Option>\r\n              <Option value=\"磨玻璃\">磨玻璃</Option>\r\n              <Option value=\"肺内钙化\">肺内钙化</Option>\r\n              <Option value=\"胸膜实性\">胸膜实性</Option>\r\n              <Option value=\"胸膜钙化\">胸膜钙化</Option>\r\n              <Option value=\"其他\">其他</Option>\r\n            </Select>\r\n          </div>\r\n          <div className=\"list\">\r\n            <span className=\"list-title\">建议：</span>\r\n            <Input\r\n              placeholder=\"请输入当前结节建议信息\"\r\n              size=\"small\"\r\n              style={{ width: 200, height: 30, marginTop: 2, fontSize: 13 }}\r\n              value={item.suggest}\r\n              onChange={e => props.handleToolListTextareaChange(e, item.uuid)}\r\n              onBlur={e => props.handleToolListTextareaBlur(e, item.uuid)}\r\n            />\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default AddNewNode\r\n","const fs = window.fs\r\nconst path = window.path\r\nconst winston = window.winston\r\nconst dbSlot = 'resources/'\r\nconst backup = 'backup/'\r\nconst backupTimer = window.backupTimer\r\n\r\nconst logger = winston.createLogger({\r\n  level: 'info',\r\n  format: winston.format.combine(\r\n      winston.format.timestamp(),\r\n      winston.format.printf(({ level, message, timestamp }) => {\r\n        return `${timestamp} ${level}: ${message}`;\r\n      })\r\n  ),\r\n  transports: [\r\n    new winston.transports.File({ filename: 'logger.log' }),\r\n  ],\r\n});\r\n\r\nconst resourceDir = path.resolve(dbSlot)\r\nconst dbDir = path.resolve(dbSlot + 'db')\r\nconst backupDBDir = path.resolve(backup)\r\nconst filePath = window.join(dbDir, 'dicom.db')\r\nconst sqlite = window.sqlite.verbose()\r\nconst resourceExists = fs.existsSync(resourceDir)\r\nconst backupExists = fs.existsSync(backupDBDir)\r\nconst exists = fs.existsSync(dbDir)\r\n// 如果不存在则创建\r\nif (!resourceExists) {\r\n  fs.mkdirSync(resourceDir)\r\n  // console.log('resourceDir: ', resourceDir)\r\n}\r\nif (!exists) {\r\n  fs.mkdirSync(dbDir)\r\n  // console.log('dbDir: ', dbDir)\r\n}\r\nif (!backupExists) {\r\n  fs.mkdirSync(backupDBDir)\r\n  // console.log('backupDBDir: ', backupDBDir)\r\n}\r\n\r\nconst calculateDate = (days) => {\r\n  const fileStats = fs.statSync(filePath) // read the db's time attribute\r\n  const now = new Date()\r\n  let timeInterval = null\r\n  if (fs.readdirSync(backupDBDir).length > 0) { // It was reached backup time already\r\n    const fsList = []\r\n    fs.readdirSync(backupDBDir).forEach(ele => {\r\n      fsList.push(ele.slice(0, -3))\r\n    })\r\n    fsList.sort((a,b) => a -b)\r\n    console.log(fsList)\r\n    timeInterval = now.getTime() - fsList[fsList.length - 1]\r\n  } else { // first time to back up\r\n    timeInterval = now.getTime() - fileStats.birthtimeMs\r\n  }\r\n  const dayGap = Number((timeInterval / 1000 / 60 / 60 / 24).toFixed(2))\r\n  // console.log('timeInterval: ',days)\r\n  return dayGap > days\r\n}\r\nconst backupDBFile = () => {\r\n  const now = new Date()\r\n  const timeName = now.getTime() + '.db'\r\n  const destination = window.join(backupDBDir, timeName)\r\n  fs.copyFile(filePath, destination, (err) => {\r\n    if (err) throw err;\r\n    console.log(filePath,' was copied to ', destination);\r\n    logger.info(filePath+` was copied to `+ destination)\r\n  });\r\n}\r\n\r\nexport const changeTimeInterval = function () {\r\n  const backupDay = (backupTimer && !isNaN(backupTimer.backupInterval) && backupTimer.backupInterval > 0) ? backupTimer.backupInterval : 10\r\n  if (calculateDate(backupDay)) {\r\n    backupDBFile()\r\n  }\r\n}\r\n\r\n// 是否存在db文件\r\nif (!fs.existsSync(filePath)) {\r\n  fs.openSync(filePath, 'w')\r\n} else {\r\n  // judge the date and decide whether to copy db file to destination folder\r\n  changeTimeInterval()\r\n}\r\n\r\nconst sqlite3 = new sqlite.Database(filePath)\r\n\r\nexport const createTable = function (sql) {\r\n  sqlite3.serialize(function () {\r\n    sqlite3.run(sql, function (err) {\r\n      if (null != err) {\r\n        console.log('ERR:', err)\r\n        return\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\n/// tilesData format; [[level, column, row, content], [level, column, row, content]]\r\nexport const insertData = (sql, objects, callback) => {\r\n  sqlite3.serialize(function () {\r\n    const stmt = sqlite3.prepare(sql)\r\n    for (let i = 0; i < objects.length; ++i) {\r\n      const temp = []\r\n      for (const k in objects[i]) {\r\n        if (objects[i].hasOwnProperty(k)) {\r\n          if (typeof objects[i][k] !== 'object') {\r\n            temp.push(objects[i][k])\r\n          }\r\n        }\r\n      }\r\n      stmt.run(temp)\r\n    }\r\n    stmt.finalize(callback)\r\n  })\r\n}\r\n\r\nexport const queryData = function (sql, callback) {\r\n  sqlite3.all(sql, function (err, rows) {\r\n    if (null != err) {\r\n      console.log('ERR sqlite:', err)\r\n      console.log('rows',rows)\r\n      return\r\n    }\r\n    /// deal query data.\r\n    if (callback) {\r\n      callback(rows)\r\n    }\r\n  })\r\n}\r\n\r\nexport const deleteTableSql = function (name) {\r\n  const sql = 'DROP TABLE if exists ' + name\r\n  sqlite3.run(sql, function (err) {\r\n    if (null != err) {\r\n      // DB.printErrorInfo(err);\r\n      console.log('ERR:', err)\r\n    }\r\n  })\r\n}\r\n\r\nexport const executeSql = function (sql) {\r\n  sqlite3.run(sql, function (err) {\r\n    if (null != err) {\r\n      // DB.printErrorInfo(err);\r\n      console.log('ERR:', err)\r\n    }\r\n  })\r\n}\r\n\r\nexport const close = function () {\r\n  sqlite3.close()\r\n}\r\n\r\n/// export SqliteDB.\r\nexport default sqlite3\r\n\r\nexport const SQLContainer = {\r\n  dicomPatientSql:\r\n    'create table if not exists dicom_patient(id integer NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE, key varchar(64),patientID varchar(32),patientName varchar(32),patientGender varchar(32), patientBirthday varchar(32),acquisitionDate varchar(255),institution varchar(32),deviceManufacturer varchar(32),deviceModelName varchar(32),addTime varchar(32),studyNum varchar(32))',\r\n  dicomStudySql:\r\n    'create table if not exists dicom_study(id integer NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE, key varchar(64),patientID varchar(32),acquisitionDate varchar(255), studyID varchar(32), studyDescription varchar(32),addTime varchar(255),sequenceNum varchar(32))',\r\n  dicomSeriesSql:\r\n    'create table if not exists dicom_series(id integer NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE, key varchar(64),studyID varchar(32),seriesNo varchar(32),seriesDescription varchar(255), layer varchar(32), modality varchar(32),acquisitionDate varchar(255),size varchar(32),addTime varchar(32),frameNum varchar(32),suggest varchar(255))',\r\n  dicomInstanceSql:\r\n    'create table if not exists dicom_instance(id integer NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE, key varchar(64),studyID varchar(64),seriesNo varchar(32),specialID varchar(255),instanceNumber varchar(32),seriesInstanceUID varchar(255),framePath varchar(255), acquisitionDate varchar(255),addTime varchar(32), UNIQUE(specialID))',\r\n  insertPatientSql:\r\n    'insert into dicom_patient(key, patientName,patientID,patientGender,patientBirthday,acquisitionDate,institution, deviceManufacturer,deviceModelName,addTime,studyNum) values(?,?, ?, ?,?, ?, ?,?, ?, ?,?)',\r\n  insertStudySql:\r\n    'insert into dicom_study(key, patientID,acquisitionDate, studyID, studyDescription,addTime,sequenceNum ) values(?,?,?,?,?,?,?)',\r\n  insertSeriesSql:\r\n    'insert into dicom_series(key, studyID,seriesNo,seriesDescription, layer, modality,acquisitionDate,size,addTime,frameNum) values(?,?,?,?,?,?,?,?,?,?)',\r\n  insertInstanceSql:\r\n    'insert OR IGNORE into dicom_instance(key, studyID, seriesNo, specialID, instanceNumber, seriesInstanceUID,framePath, acquisitionDate,addTime) values(?,?,?,?,?,?,?,?,?)',\r\n  queryPatientSql: 'select * from dicom_patient',\r\n  queryStudySql: 'select * from dicom_study',\r\n  querySeriesSql: 'select * from dicom_series',\r\n  queryInstanceSql: 'select * from dicom_instance',\r\n\r\n  nodeListSql:\r\n    'create table if not exists node_list(id integer NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE, patientID varchar(32), seriesNo varchar(32), imageIndex varchar(32), noduleName varchar(32), noduleNum varchar(32), lungLocation varchar(32), lobeLocation varchar(32), featureLabel varchar(32), suggest varchar(32), nodeBox varchar(255))',\r\n  insertNodeListSql:\r\n    'insert into node_list(patientID, seriesNo, imageIndex, noduleName, noduleNum, lungLocation, lobeLocation, featureLabel, suggest, nodeBox ) values(?,?,?,?,?,?,?,?,?,?)',\r\n  queryNodeListSql: 'select * from node_list',\r\n\r\n  removePatientDuplicated:\r\n    'delete from dicom_patient where dicom_patient.rowid not in (select MAX(dicom_patient.rowid) from dicom_patient group by key, patientID)',\r\n  removeStudyDuplicated:\r\n    'delete from dicom_study where dicom_study.rowid not in (select MAX(dicom_study.rowid) from dicom_study group by key, studyID)',\r\n  removeSeriesDuplicated:\r\n    'delete from dicom_series where dicom_series.rowid not in (select MAX(dicom_series.rowid) from dicom_series group by key, seriesNo)',\r\n}\r\n\r\nexport const removeAllDuplicated = patientCallback => {\r\n  queryData(SQLContainer.removePatientDuplicated, res1 => {\r\n    queryData(SQLContainer.removeStudyDuplicated, res2 => {\r\n      queryData(SQLContainer.removeSeriesDuplicated, res3 => {\r\n        queryData(SQLContainer.queryPatientSql, patientCallback)\r\n        // queryData(SQLContainer.queryStudySql,studyCallback)\r\n        // queryData(SQLContainer.querySeriesSql,seriesCallback)\r\n      })\r\n    })\r\n  })\r\n}\r\n\r\n// export const queryInstanceList = (DBFunction, datalist) => {\r\n//   console.log(datalist)\r\n//   const sql = ` where 'instanceNumber' ='${instanceNumber}' and 'seriesInstanceUID' = '${seriesInstanceUID}'`\r\n//   queryData(SQLContainer.queryInstanceExistSql, DBFunction)\r\n// }\r\n\r\n\r\nexport const queryInstanceData = (DBFunction, instanceNumber, seriesInstanceUID) => {\r\n  const sql = (instanceNumber && seriesInstanceUID) ? ` where instanceNumber ='${instanceNumber}' and seriesInstanceUID = '${seriesInstanceUID}'` : ''\r\n  logger.info(`Query Instance data` + sql)\r\n  queryData(SQLContainer.queryInstanceSql + sql, DBFunction)\r\n}\r\nexport const queryInstanceByStudyID = ( studyID, DBFunction) => {\r\n  const sql = ` where studyID ='${studyID}'`\r\n  logger.info(`Query Instance data that studyID ='${studyID}'`)\r\n  queryData(SQLContainer.queryInstanceSql + sql, DBFunction)\r\n}\r\n\r\nexport const queryPatientData = (DBFunction, patientID) => {\r\n  const sql = patientID ? ` where patientID ='${patientID}'` : ''\r\n  logger.info(`Query Patient data` + sql)\r\n  queryData(SQLContainer.queryPatientSql + sql, DBFunction)\r\n}\r\n\r\nexport const queryStudyByPatientID = (patientID, DBFunction) => {\r\n  const sql = ` where patientID ='${patientID}'`\r\n  logger.info(`Query Study data that patientID ='${patientID}'`)\r\n  queryData(SQLContainer.queryStudySql + sql, DBFunction)\r\n}\r\n\r\nexport const querySeriesByStudyID = (studyID, DBFunction) => {\r\n  const sql = studyID ? ` where studyID = '${studyID}'` : ''\r\n  logger.info(`Query Series data` + sql )\r\n  queryData(SQLContainer.querySeriesSql + sql, DBFunction)\r\n}\r\n\r\nexport const queryNodeList = (patientID, seriesNo, callback) => {\r\n  const sql = ` where patientID = '${patientID}' and seriesNo = '${seriesNo}'`\r\n  logger.info(`Query NodeList data that patientID = '${patientID}' and seriesNo = '${seriesNo}'`)\r\n  queryData(SQLContainer.queryNodeListSql + sql, callback)\r\n}\r\n\r\nexport const queryAllNodeList = (patientID, callback) => {\r\n  const sql = ` where patientID = '${patientID}'`\r\n  logger.info(`Query NodeList data that patientID = '${patientID}'`)\r\n  queryData(SQLContainer.queryNodeListSql + sql, callback)\r\n}\r\n\r\nexport const updateSeriesSuggest = (suggest, studyId, seriesNo, callback) => {\r\n  const sql = `update dicom_series set suggest = '${suggest}' where studyId = '${studyId}' and seriesNo = '${seriesNo}'`\r\n  queryData(sql, callback)\r\n}\r\n\r\nexport const querySeriesSuggest = (studyId, seriesNo, callback) => {\r\n  const sql = ` where studyID = '${studyId}' and seriesNo = '${seriesNo}'`\r\n  logger.info(`Query SeriesSuggest that studyID = '${studyId}' and seriesNo = '${seriesNo}'`)\r\n  queryData(SQLContainer.querySeriesSql + sql, callback)\r\n}\r\n\r\nexport const queryPatientList = (value, callback) => {\r\n  const sql = ` select * from dicom_patient where patientName like '%${value}%' or patientGender like '%${value}%' or patientID like '%${value}%' or patientBirthday like '%${value}%' or acquisitionDate like '%${value}%' or institution like '%${value}%' or deviceManufacturer like '%${value}%' or deviceModelName like '%${value}%' or addTime like '%${value}%' or studyNum like '%${value}%'\r\n  `\r\n  logger.info(`Query PatientList from search input box by input value equal '${value}'`)\r\n  queryData(sql, callback)\r\n}\r\n\r\nexport const deleteNodeData = (noduleNum, callback) => {\r\n  const sql = `delete from node_list where noduleNum = '${noduleNum}'`\r\n  queryData(sql, callback)\r\n}\r\n\r\ncreateTable(SQLContainer.dicomPatientSql)\r\n// logger.info('Created Patient table')\r\ncreateTable(SQLContainer.dicomStudySql)\r\n// logger.info('Created Study table')\r\n\r\n// createTable(SQLContainer.dicomSeriesSql)\r\ncreateTable(SQLContainer.dicomInstanceSql)\r\n// logger.info('Created Instance table')\r\n\r\ncreateTable(SQLContainer.nodeListSql)\r\n","import React, { useState, useEffect, useRef } from 'react'\r\nimport './Viewer.scss'\r\nimport LeftSidePanel from '../../components/LeftSidePanel/LeftSidePanel'\r\nimport Toolbar from '../../components/Toolbar/Toolbar'\r\nimport ViewerMain from '../../components/ViewerMain/ViewerMain'\r\nimport MiddleSidePanel from '../../components/MiddleSidePanel/MiddleSidePanel'\r\nimport cornerstone from 'cornerstone-core'\r\nimport cornerstoneTools from 'cornerstone-tools'\r\nimport MarkNoduleTool from '../../components/common/MarkNoduleTool/MarkNoduleTool'\r\nimport AddNoduleTool from '../../components/common/AddNoduleTool/AddNoduleTool'\r\nimport { Modal, message } from 'antd'\r\nimport Draggable from 'react-draggable'\r\nimport AddNewNode from '../../components/common/AddNewNode/AddNewNode'\r\nimport {\r\n  insertData,\r\n  queryNodeList,\r\n  SQLContainer,\r\n  queryAllNodeList,\r\n  querySeriesSuggest,\r\n} from '../../util/sqlite'\r\nimport useWindowSize from '../../hook/useWindowSize'\r\nimport {deleteNodeAPI, downloadFile, updateSuggestAPI} from '../../util/index'\r\n\r\nconst Viewer = props => {\r\n  const size = useWindowSize()\r\n\r\n  // 初始化\r\n  // eslint-disable-next-line no-unused-vars\r\n  const [imagesConfig, setImagesConfig] = useState([])\r\n\r\n  // eslint-disable-next-line no-unused-vars\r\n  // const [sequenceListData, setLeftSidePanelData] = useState([])\r\n  const [noduleList, setNoduleList] = useState([])\r\n  const [noduleMapList, setNoduleMapList] = useState([])\r\n  const [noduleSuggest, setNoduleSuggest] = useState('')\r\n\r\n  // 当前帧数\r\n  const [currentImageIdIndex, setCurrentImageIdIndex] = useState(0)\r\n\r\n  // 视图元素\r\n  const [cornerstoneElement, setCornerstoneElement] = useState(null)\r\n\r\n  // 保存 patientID\r\n  const [patientID, setPatientID] = useState('')\r\n\r\n  // 临时变量\r\n  const nodeRef = useRef()\r\n\r\n  useEffect(() => {\r\n    nodeRef.current = {\r\n      noduleList,\r\n      noduleMapList,\r\n      imagesConfig,\r\n    }\r\n  }, [imagesConfig, noduleList, noduleMapList])\r\n\r\n  // 影像信息初始化\r\n  useEffect(() => {\r\n    const seriesInfo = props.data.seriesInfo.find(item => item.active === true)\r\n    const seriesNo = seriesInfo.seriesNo\r\n    const patientID = props.data.patientID\r\n    setPatientID(patientID)\r\n\r\n    seriesInfo.imageIDList.then(res => {\r\n      if (res.length > 0) {\r\n        const imagesConfig = []\r\n        for (let i = 0; i < res.length; i++) {\r\n          imagesConfig.push(res[i])\r\n        }\r\n        queryNodeList(patientID, seriesNo, res => {\r\n          formatNodeData(res)\r\n          setImagesConfig([...imagesConfig])\r\n        })\r\n      }\r\n    })\r\n  }, [props.data])\r\n\r\n  // 结节总结信息初始化\r\n  useEffect(() => {\r\n    const seriesInfo = props.data.seriesInfo.find(item => item.active === true)\r\n    const studyId = seriesInfo.studyID\r\n    const seriesNo = seriesInfo.seriesNo\r\n    querySeriesSuggest(studyId, seriesNo, res => {\r\n      setNoduleSuggest(res[0].suggest)\r\n    })\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [])\r\n\r\n  // 点击序列切换\r\n  const getSelectedSeries = selectedSeries => {\r\n    setCurrentImageIdIndex(0)\r\n    cornerstoneTools.clearToolState(cornerstoneElement, 'MarkNodule')\r\n    cornerstone.updateImage(cornerstoneElement)\r\n    setNoduleList([])\r\n    setNoduleMapList([])\r\n\r\n    selectedSeries.imageIDList.then(res => {\r\n      setImagesConfig([...res])\r\n      const seriesNo = selectedSeries.seriesNo\r\n      const studyId = selectedSeries.studyID\r\n      queryNodeList(patientID, seriesNo, data => {\r\n        formatNodeData(data)\r\n      })\r\n      querySeriesSuggest(studyId, seriesNo, data => {\r\n        setNoduleSuggest(data[0].suggest)\r\n      })\r\n      setTimeout(() => {\r\n        addNodeTool(cornerstoneElement, 0)\r\n      }, 200)\r\n    })\r\n  }\r\n\r\n  // 启用工具\r\n  const setToolEnable = () => {\r\n    const WwwcTool = cornerstoneTools.WwwcTool\r\n    cornerstoneTools.addTool(WwwcTool)\r\n\r\n    const StackScrollMouseWheelTool = cornerstoneTools.StackScrollMouseWheelTool\r\n    const RectangleRoiTool = cornerstoneTools.RectangleRoiTool\r\n    const EraserTool = cornerstoneTools.EraserTool\r\n    const MagnifyTool = cornerstoneTools.MagnifyTool\r\n    const EllipticalRoiTool = cornerstoneTools.EllipticalRoiTool\r\n    const AngleTool = cornerstoneTools.AngleTool\r\n    const LengthTool = cornerstoneTools['LengthTool']\r\n    const PanTool = cornerstoneTools.PanTool\r\n    const ZoomTool = cornerstoneTools.ZoomTool\r\n\r\n    cornerstoneTools.addTool(StackScrollMouseWheelTool)\r\n    cornerstoneTools.addTool(RectangleRoiTool)\r\n    cornerstoneTools.addTool(EraserTool)\r\n    cornerstoneTools.addTool(MagnifyTool)\r\n    cornerstoneTools.addTool(EllipticalRoiTool)\r\n    cornerstoneTools.addTool(AngleTool)\r\n    cornerstoneTools.addTool(LengthTool)\r\n    cornerstoneTools.addTool(PanTool)\r\n    cornerstoneTools.addTool(ZoomTool)\r\n\r\n    // 自定义工具\r\n    cornerstoneTools.addTool(MarkNoduleTool)\r\n    cornerstoneTools.addTool(AddNoduleTool)\r\n\r\n    // 默认灰阶调节\r\n    cornerstoneTools.setToolActive('Wwwc', { mouseButtonMask: 1 })\r\n    cornerstoneTools.setToolActive('Wwwc', { mouseButtonMask: 2 })\r\n  }\r\n\r\n  // 格式化结节数据\r\n  const formatNodeData = resultInfo => {\r\n    const nodulesList = []\r\n    const nodulesMapList = []\r\n    let index = 0\r\n    for (let i = 0; i < resultInfo.length; i++) {\r\n      const item = resultInfo[i]\r\n      const nodeBox = item.nodeBox.split(',')\r\n      nodulesList.push({\r\n        id: index,\r\n        checked: false,\r\n        active: false,\r\n        num: item.imageIndex,\r\n        noduleName: item.noduleName,\r\n        noduleNum: item.noduleNum,\r\n        lung: item.lungLocation,\r\n        lobe: item.lobeLocation,\r\n        type: item.featureLabel,\r\n        featureLabelG: item.featureLabel,\r\n        suggest: item.suggest,\r\n        nodeBox: nodeBox,\r\n      })\r\n\r\n      index++\r\n\r\n      nodulesMapList.push({\r\n        noduleName: item.noduleName,\r\n        noduleNum: item.noduleNum,\r\n        index: item.imageIndex,\r\n        startX: nodeBox[0],\r\n        startY: nodeBox[1],\r\n        endX: nodeBox[2],\r\n        endY: nodeBox[3],\r\n      })\r\n    }\r\n\r\n    setNoduleList([...nodulesList])\r\n    setNoduleMapList([...nodulesMapList])\r\n  }\r\n\r\n  // 导出结节信息\r\n  const handleExportExcel = () => {\r\n    queryAllNodeList(patientID, res => {\r\n      // if (res.length === 0) {\r\n      //   message.warn(`当前病人暂无结节信息`)\r\n      //   return false\r\n      // }\r\n\r\n      const exportData = []\r\n\r\n      for (let i = 0; i < res.length; i++) {\r\n        exportData.push({\r\n          patientID: res[i].patientID,\r\n          seriesNo: res[i].seriesNo,\r\n          imageIndex: res[i].imageIndex,\r\n          nodeBox: res[i].nodeBox,\r\n        })\r\n      }\r\n\r\n      const fileName = `病人ID-${patientID}`\r\n      downloadFile(exportData, fileName)\r\n    })\r\n  }\r\n\r\n  // ===========================================================\r\n\r\n  // 添加结节标注\r\n  const addNodeTool = (cornerstoneElement, index = 0) => {\r\n    const item = nodeRef.current.noduleMapList.filter(item => Number(item.index) === Number(index))\r\n    const checkItme = nodeRef.current.noduleList.find(item => item.checked === true)\r\n\r\n    if (item.length >= 1) {\r\n      cornerstoneTools.clearToolState(cornerstoneElement, 'MarkNodule')\r\n      if (checkItme) {\r\n        const checkNode = item.filter(item => item.noduleName === checkItme.noduleName)\r\n        for (let i = 0; i < item.length; i++) {\r\n          const measurementData = {\r\n            visible: true,\r\n            active: true,\r\n            color: item[i].noduleName === (checkNode[0] && checkNode[0].noduleName) ? undefined : 'white',\r\n            invalidated: true,\r\n            handles: {\r\n              start: {\r\n                x: item[i].startX,\r\n                y: item[i].startY,\r\n                highlight: true,\r\n                active: true,\r\n              },\r\n              end: {\r\n                x: item[i].endX,\r\n                y: item[i].endY,\r\n                highlight: true,\r\n                active: true,\r\n              },\r\n            },\r\n          }\r\n          cornerstoneTools.addToolState(cornerstoneElement, 'MarkNodule', measurementData)\r\n        }\r\n      } else {\r\n        for (let i = 0; i < item.length; i++) {\r\n          const measurementData = {\r\n            visible: true,\r\n            active: true,\r\n            color: 'white',\r\n            invalidated: true,\r\n            handles: {\r\n              start: {\r\n                x: item[i].startX,\r\n                y: item[i].startY,\r\n                highlight: true,\r\n                active: true,\r\n              },\r\n              end: {\r\n                x: item[i].endX,\r\n                y: item[i].endY,\r\n                highlight: true,\r\n                active: true,\r\n              },\r\n            },\r\n          }\r\n          cornerstoneTools.addToolState(cornerstoneElement, 'MarkNodule', measurementData)\r\n        }\r\n      }\r\n      cornerstone.updateImage(cornerstoneElement)\r\n    } else {\r\n      cornerstoneTools.clearToolState(cornerstoneElement, 'MarkNodule')\r\n      cornerstone.updateImage(cornerstoneElement)\r\n    }\r\n  }\r\n\r\n  // ===========================================================\r\n\r\n  // 结节点击事件\r\n  const onCheckChange = (index, num) => {\r\n    handleCheckedListClick(num)\r\n    noduleList.map(item => (item.checked = false))\r\n    noduleList[index].checked = true\r\n    setNoduleList([...noduleList])\r\n  }\r\n\r\n  // 列表点击事件\r\n  const handleCheckedListClick = (index, el) => {\r\n    const corElement = el || cornerstoneElement\r\n\r\n    // 设置当中帧数\r\n    setCurrentImageIdIndex(index)\r\n\r\n    // 设置当前视图选中项\r\n    if (corElement) {\r\n      changeActiveImage(index, corElement)\r\n    }\r\n  }\r\n\r\n  // ===========================================================\r\n\r\n  // 切换当前工具栏选中项\r\n  const changeToolActive = (checked, type) => {\r\n    if (checked) {\r\n      cornerstoneTools.setToolActive(type, { mouseButtonMask: 1 })\r\n    } else {\r\n      cornerstoneTools.setToolActive('Wwwc', { mouseButtonMask: 1 })\r\n    }\r\n  }\r\n\r\n  // 设定当前选中工具状态\r\n  const setActiveToolState = () => {\r\n    const activeTool = document.querySelector('.tool-bar-box .active')\r\n    if (activeTool) {\r\n      cornerstoneTools.setToolActive(activeTool.dataset.type, { mouseButtonMask: 1 })\r\n    } else {\r\n      cornerstoneTools.setToolActive('Wwwc', { mouseButtonMask: 1 })\r\n    }\r\n  }\r\n\r\n  // 工具栏切换\r\n  const handleToolbarClick = (type, checked) => {\r\n    let viewport = cornerstone.getViewport(cornerstoneElement)\r\n    switch (type) {\r\n      case 'Magnify':\r\n      case 'RectangleRoi':\r\n      case 'Eraser':\r\n      case 'EllipticalRoi':\r\n      case 'Angle':\r\n      case 'Length':\r\n      case 'MarkNodule':\r\n      case 'AddNodule':\r\n      case 'Zoom':\r\n      case 'Pan':\r\n        changeToolActive(checked, type)\r\n        break\r\n      case 'hflip':\r\n        viewport.hflip = !viewport.hflip\r\n        cornerstone.setViewport(cornerstoneElement, viewport)\r\n        break\r\n      case 'vflip':\r\n        viewport.vflip = !viewport.vflip\r\n        cornerstone.setViewport(cornerstoneElement, viewport)\r\n        break\r\n      case 'playClip':\r\n        if (checked) {\r\n          cornerstoneTools.playClip(cornerstoneElement, 10)\r\n        } else {\r\n          cornerstoneTools.stopClip(cornerstoneElement)\r\n        }\r\n        break\r\n      case 'Reset':\r\n        cornerstone.reset(cornerstoneElement)\r\n        // windowChange(cornerstoneElement, cornerstone.getImage(cornerstoneElement), 2)\r\n        break\r\n      default:\r\n        break\r\n    }\r\n  }\r\n\r\n  // 切换当前视图\r\n  const changeActiveImage = (index, cornerstoneElement) => {\r\n    cornerstone.loadImage(nodeRef.current.imagesConfig[index]).then(image => {\r\n      cornerstone.displayImage(cornerstoneElement, image)\r\n      cornerstoneTools.addStackStateManager(cornerstoneElement, ['stack'])\r\n      cornerstoneTools.addToolState(cornerstoneElement, 'stack', {\r\n        currentImageIdIndex: Number(index),\r\n        imageIds: nodeRef.current.imagesConfig,\r\n      })\r\n    })\r\n  }\r\n\r\n  // ===========================================================\r\n\r\n  // 格式化提交数据\r\n  const formatPostData = () => {\r\n    const seriesInfo = props.data.seriesInfo.find(item => item.active === true)\r\n    const item = noduleList[noduleList.length - 1]\r\n    const postData = [\r\n      {\r\n        patientID: props.data.patientID,\r\n        seriesNo: seriesInfo.seriesNo,\r\n        imageIndex: item.num,\r\n        noduleName: item.noduleName,\r\n        noduleNum: item.noduleNum,\r\n        lungLocation: item.lung,\r\n        lobeLocation: item.lobe,\r\n        featureLabel: item.type,\r\n        suggest: item.suggest,\r\n        nodeBox: item.nodeBox.toString(),\r\n      },\r\n    ]\r\n    return postData\r\n  }\r\n\r\n  // 暂存结节数据\r\n  const saveResults = () => {\r\n    const postData = formatPostData()\r\n    insertData(SQLContainer.insertNodeListSql, postData)\r\n    message.success(`新增结节成功`)\r\n  }\r\n\r\n  // ===========================================================\r\n\r\n  const draggleRef = React.createRef()\r\n  const [modalVisible, setModalVisible] = useState(false)\r\n  const [modalDisabled, setModalDisabled] = useState(true)\r\n  const [modalBounds, setModalBounds] = useState({ left: 0, top: 0, bottom: 0, right: 0 })\r\n  const [toolList, setToolList] = useState([])\r\n\r\n  // 格式化新增结节数据\r\n  const formatNewNodeData = data => {\r\n    const toolList = []\r\n    toolList.push({\r\n      uuid: data.uuid,\r\n      lung: '',\r\n      lobe: '',\r\n      type: undefined,\r\n      suggest: '',\r\n      cachedStats: data.cachedStats,\r\n      startX: data.handles.start.x,\r\n      startY: data.handles.start.y,\r\n      endX: data.handles.end.x,\r\n      endY: data.handles.end.y,\r\n    })\r\n    setToolList(toolList)\r\n  }\r\n\r\n  // 更新结节事件\r\n  const updateToolList = (val, type, id) => {\r\n    const checkItme = toolList.find(item => item.uuid === id)\r\n    if (checkItme && type === 'lung') {\r\n      checkItme.lung = val\r\n    }\r\n    if (checkItme && type === 'lobe') {\r\n      checkItme.lobe = val\r\n    }\r\n    if (checkItme && type === 'type') {\r\n      checkItme.type = val\r\n    }\r\n    setToolList([...toolList])\r\n  }\r\n\r\n  // 更新医生影像建议内容\r\n  const handleToolListTextareaChange = (e, id) => {\r\n    const checkItme = toolList.find(item => item.uuid === id)\r\n    if (checkItme) {\r\n      checkItme.suggest = e.target.value\r\n      setToolList([...toolList])\r\n    }\r\n  }\r\n\r\n  // 建议框失去焦点后保存数据\r\n  const handleToolListTextareaBlur = (e, id) => {\r\n    const checkItme = toolList.find(item => item.uuid === id)\r\n    if (checkItme) {\r\n      checkItme.suggest = e.target.value\r\n      setToolList([...toolList])\r\n    }\r\n  }\r\n\r\n  // 新增结节列表\r\n  const handleOk = e => {\r\n    for (let i = 0; i < toolList.length; i++) {\r\n      if (!toolList[i].lung) {\r\n        message.warn(`请选择结节的肺属性后在进行新增`)\r\n        return false\r\n      }\r\n\r\n      if (!toolList[i].lobe) {\r\n        message.warn(`请选择结节的肺叶属性后在进行新增`)\r\n        return false\r\n      }\r\n\r\n      if (!toolList[i].type) {\r\n        message.warn(`请选择结节的类型属性后在进行新增`)\r\n        return false\r\n      }\r\n    }\r\n\r\n    const tool = cornerstoneTools.getToolState(cornerstoneElement, 'AddNodule')\r\n    const newToolData = [...tool.data]\r\n    const toolData = newToolData.pop()\r\n\r\n    const startX = toolData.handles.start.x.toFixed(2)\r\n    const startY = toolData.handles.start.y.toFixed(2)\r\n    const endX = toolData.handles.end.x.toFixed(2)\r\n    const endY = toolData.handles.end.y.toFixed(2)\r\n\r\n    const imageId = cornerstone.getImage(cornerstoneElement).imageId\r\n    const imageIndex = nodeRef.current.imagesConfig.findIndex(item => item === imageId)\r\n\r\n    const newNoduleList = {\r\n      active: false,\r\n      checked: false,\r\n      lobe: toolList[0].lobe,\r\n      lung: toolList[0].lung,\r\n      noduleName: `nodule_${toolList[0].uuid}`,\r\n      noduleNum: toolList[0].uuid,\r\n      num: imageIndex,\r\n      suggest: toolList[0].suggest,\r\n      type: toolList[0].type,\r\n      nodeBox: [startX, startY, endX, endY],\r\n    }\r\n\r\n    const newNoduleMapList = {\r\n      startX: startX,\r\n      startY: startY,\r\n      endX: endX,\r\n      endY: endY,\r\n      noduleNum: toolList[0].uuid,\r\n      noduleName: `nodule_${toolList[0].uuid}`,\r\n      index: imageIndex,\r\n    }\r\n\r\n    noduleList.push(newNoduleList)\r\n    setNoduleList([...noduleList])\r\n\r\n    noduleMapList.push(newNoduleMapList)\r\n    setNoduleMapList([...noduleMapList])\r\n\r\n    saveResults()\r\n\r\n    cornerstoneTools.clearToolState(cornerstoneElement, 'AddNodule')\r\n\r\n    setTimeout(() => {\r\n      addNodeTool(cornerstoneElement, imageIndex)\r\n    }, 200)\r\n\r\n    setModalVisible(false)\r\n  }\r\n\r\n  // 结节列表删除\r\n  const handleDeleteNode = (e, item) => {\r\n    e.stopPropagation()\r\n\r\n    const noduleIndex = noduleList.findIndex(n => n.noduleNum === item.noduleNum)\r\n    const noduleMapIndex = noduleMapList.findIndex(n => n.noduleNum === item.noduleNum)\r\n\r\n    noduleList.splice(noduleIndex, 1)\r\n    noduleMapList.splice(noduleMapIndex, 1)\r\n\r\n    setNoduleList([...noduleList])\r\n    setNoduleMapList([...noduleMapList])\r\n\r\n    // deleteNodeData(item.noduleNum, () => {\r\n    //   message.success(`删除结节成功`)\r\n    // })\r\n\r\n    deleteNodeAPI({noduleNum: item.noduleNum}).then(res => {\r\n      // console.log('res: ', res)\r\n      message.success(`删除结节成功`)\r\n    }).catch(err => {\r\n      console.log(err)\r\n    })\r\n\r\n    setTimeout(() => {\r\n      addNodeTool(cornerstoneElement, item.num)\r\n    }, 200)\r\n  }\r\n\r\n  const handleCancel = e => {\r\n    setModalVisible(false)\r\n    handleCloseCallback()\r\n  }\r\n\r\n  const onStart = (event, uiData) => {\r\n    const { clientWidth, clientHeight } = window.document.documentElement\r\n    const targetRect = draggleRef.current?.getBoundingClientRect()\r\n    if (!targetRect) {\r\n      return\r\n    }\r\n    setModalBounds({\r\n      left: -targetRect.left + uiData.x,\r\n      right: clientWidth - (targetRect.right - uiData.x),\r\n      top: -targetRect.top + uiData.y,\r\n      bottom: clientHeight - (targetRect.bottom - uiData.y),\r\n    })\r\n  }\r\n\r\n  // 结节总结信息保存\r\n  const handleTextareaOnChange = suggest => {\r\n    const seriesInfo = props.data.seriesInfo.find(item => item.active === true)\r\n    const seriesNo = seriesInfo.seriesNo\r\n    const studyId = seriesInfo.studyID\r\n    // updateSeriesSuggest(suggest, studyId, seriesNo, res => {\r\n    //   message.success(`结节总结信息添加成功 `)\r\n    // })\r\n    const data = {\r\n      suggest,\r\n      studyId,\r\n      seriesNo\r\n    }\r\n    updateSuggestAPI({...data}).then(res => {\r\n      message.success(`结节总结信息添加成功 `)\r\n      console.log('res: ', res)\r\n    }).catch(err => {\r\n      console.log(err)\r\n    })\r\n  }\r\n\r\n  // =======================================================\r\n\r\n  const showMarkDialog = (e, cornerstoneElement) => {\r\n    const tool = cornerstoneTools.getToolState(cornerstoneElement, 'AddNodule')\r\n    let mark = document.getElementById('mark')\r\n    if (tool && mark && mark.classList.contains('active')) {\r\n      const newToolData = [...tool.data]\r\n      const toolData = newToolData.pop()\r\n      formatNewNodeData(toolData)\r\n      setModalVisible(true)\r\n    }\r\n  }\r\n\r\n  // 工具操作函数\r\n  const handleCloseCallback = () => {\r\n    const tool = cornerstoneTools.getToolState(cornerstoneElement, 'AddNodule')\r\n    const toolData = tool.data.pop()\r\n    cornerstoneTools.removeToolState(cornerstoneElement, 'AddNodule', toolData)\r\n    cornerstone.updateImage(cornerstoneElement)\r\n    setModalVisible(false)\r\n  }\r\n\r\n  // 监听视图变化事件\r\n  const handleElementEnabledEvt = elementEnabledEvt => {\r\n    const cornerstoneElement = elementEnabledEvt.detail.element\r\n    setCornerstoneElement(cornerstoneElement)\r\n\r\n    let toolFlag = true\r\n\r\n    cornerstoneElement.addEventListener('cornerstonenewimage', newImage => {\r\n      const curImageId = newImage.detail.image.imageId\r\n      const index = nodeRef.current.imagesConfig.findIndex(item => item === curImageId)\r\n\r\n      if (toolFlag) {\r\n        setToolEnable()\r\n        toolFlag = false\r\n      }\r\n\r\n      cornerstoneTools.setToolActive('MarkNodule', { mouseButtonMask: 1 })\r\n      cornerstoneTools.setToolActive('StackScrollMouseWheel', {})\r\n\r\n      setTimeout(() => {\r\n        addNodeTool(cornerstoneElement, index)\r\n        setActiveToolState()\r\n      }, 0)\r\n    })\r\n\r\n    // cornerstoneElement.addEventListener('cornerstoneimageloaded', newImage => {\r\n    //   console.log(1)\r\n    // })\r\n\r\n    // cornerstoneElement.addEventListener('cornerstoneimagerendered', imageRenderedEvent => {\r\n    //   const curImageId = imageRenderedEvent.detail.image.imageId\r\n    //   const index = imagesConfig.findIndex(item => item === curImageId)\r\n    //   setCurrentImageIdIndex(index)\r\n    // })\r\n\r\n    cornerstoneElement.addEventListener('cornerstonetoolsmeasurementcompleted', e => {\r\n      const tool = cornerstoneTools.getToolState(cornerstoneElement, 'AddNodule')\r\n      if (tool) {\r\n        showMarkDialog(e, cornerstoneElement)\r\n      }\r\n    })\r\n  }\r\n\r\n  // 调整窗宽窗位\r\n  const windowChange = (element, image, index) => {\r\n    /*\r\n     * index = 1，ww: default, wl: default\r\n     * index = 2，ww: 1500, wl: -450\r\n     * index = 3，ww: 250, wl: 30\r\n     * index = 4，ww: 1000, wl: 250\r\n     * index = 5，ww: 300, wl: 40\r\n     */\r\n    const viewportDefault = cornerstone.getDefaultViewportForImage(element, image)\r\n    const viewport = cornerstone.getViewport(element)\r\n    viewport.voiLUT = undefined\r\n\r\n    if (index === 1) {\r\n      viewport.voi.windowWidth = viewportDefault.voi.windowWidth\r\n      viewport.voi.windowCenter = viewportDefault.voi.windowCenter\r\n    } else if (index === 2) {\r\n      viewport.voi.windowWidth = 1500\r\n      viewport.voi.windowCenter = -400\r\n    } else if (index === 3) {\r\n      viewport.voi.windowWidth = 250\r\n      viewport.voi.windowCenter = 30\r\n    } else if (index === 4) {\r\n      viewport.voi.windowWidth = 1000\r\n      viewport.voi.windowCenter = 250\r\n    } else if (index === 5) {\r\n      viewport.voi.windowWidth = 300\r\n      viewport.voi.windowCenter = 40\r\n    }\r\n\r\n    cornerstone.setViewport(element, viewport)\r\n  }\r\n\r\n  return (\r\n    <div className=\"viewer-box\">\r\n      <Toolbar\r\n        handleExportExcel={handleExportExcel}\r\n        handleToolbarClick={handleToolbarClick}\r\n        setShowViewer={props.setShowViewer}\r\n        globalData={props.data}\r\n      />\r\n      <div\r\n        className=\"viewer-center-box\"\r\n        style={{\r\n          height: `${size.height - 53}px`,\r\n        }}\r\n      >\r\n        <LeftSidePanel patientInfo={props.data} getSelectedSeries={getSelectedSeries} />\r\n        <ViewerMain\r\n          handleToolbarClick={handleToolbarClick}\r\n          handleElementEnabledEvt={handleElementEnabledEvt}\r\n          imagesConfig={imagesConfig}\r\n          noduleList={noduleList}\r\n          imageIdIndex={Number(currentImageIdIndex)}\r\n        />\r\n        <div className=\"middle-box-wrap\">\r\n          <MiddleSidePanel\r\n            data={props.data}\r\n            noduleSuggest={noduleSuggest}\r\n            handleCheckedListClick={handleCheckedListClick}\r\n            onCheckChange={onCheckChange}\r\n            handleTextareaOnChange={handleTextareaOnChange}\r\n            handleDeleteNode={handleDeleteNode}\r\n            noduleList={noduleList}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <Modal\r\n        title={\r\n          <div\r\n            style={{\r\n              width: '100%',\r\n              cursor: 'move',\r\n            }}\r\n            onMouseOver={() => {\r\n              if (modalDisabled) {\r\n                setModalDisabled(false)\r\n              }\r\n            }}\r\n            onMouseOut={() => {\r\n              setModalDisabled(true)\r\n            }}\r\n            onFocus={() => {}}\r\n            onBlur={() => {}}\r\n            // end\r\n          >\r\n            新增结节\r\n          </div>\r\n        }\r\n        // maskStyle={{background: 'transparent'}}\r\n        okText={'确定'}\r\n        cancelText={'取消'}\r\n        visible={modalVisible}\r\n        maskClosable={false}\r\n        onOk={handleOk}\r\n        onCancel={handleCancel}\r\n        modalRender={modal => (\r\n          <Draggable disabled={modalDisabled} bounds={modalBounds} onStart={(event, uiData) => onStart(event, uiData)}>\r\n            <div ref={draggleRef}>{modal}</div>\r\n          </Draggable>\r\n        )}\r\n      >\r\n        <AddNewNode\r\n          handleToolListTextareaChange={handleToolListTextareaChange}\r\n          handleToolListTextareaBlur={handleToolListTextareaBlur}\r\n          updateToolList={updateToolList}\r\n          currentImageIdIndex={currentImageIdIndex}\r\n          toolList={toolList}\r\n          imagesConfig={imagesConfig}\r\n          cornerstoneElement={cornerstoneElement}\r\n        />\r\n      </Modal>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Viewer\r\n","import React from 'react'\r\nimport './About.scss';\r\n\r\nconst About = (props) => {\r\n\r\n    return (\r\n        <div className=\"modal-content-wrap\" >\r\n            <div className='info'>\r\n                <div className='label'>\r\n                    版本信息\r\n                </div>\r\n                <div className='txt'>\r\n                    医学影像处理软件V0.1.1\r\n                </div>\r\n            </div>\r\n            <div className='footer'>\r\n                Copyright © 2022 Tailai. All Right Reserved. 泰莱公司 版权所有\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default About\r\n","import React, {useEffect, useState} from 'react'\r\nimport './SelectFile.scss'\r\nimport * as path from \"path\";\r\nimport {Button, message, Modal, Spin} from 'antd'\r\nimport cornerstone from 'cornerstone-core'\r\nimport {readFileInfo, dicomDateTimeToLocale, keyFormat} from \"../../util\";\r\nimport {insertData, queryInstanceData, querySeriesByStudyID, SQLContainer} from \"../../util/sqlite\";\r\nimport About from \"../About/About\";\r\nimport {getDicomType} from \"../../util/index\";\r\nimport {CheckCircleTwoTone, ExclamationCircleTwoTone} from \"@ant-design/icons\";\r\n\r\nconst SelectFile = (props) => {\r\n    const [visible, setVisible] = useState(false)\r\n    const [CDVisible, setCDVisible] = useState(false)\r\n    // const [isLoading, setLoading] = useState(0)\r\n    const [importFailed, setImportFailed] = useState(0)\r\n    const [importSucceed, setImportSucceed] = useState(0)\r\n    const [importDuplicated, setImportDuplicated] = useState(0)\r\n    const [importSucceedCounter, setImportSucceedCounter] = useState(0)\r\n    const [importFailedCounter, setImportFailedCounter] = useState(0)\r\n    const [importDuplicatedCounter, setImportDuplicatedCounter] = useState(0)\r\n    const [fileAmount, setFileAmount] = useState(0)\r\n    let isSeriesDuplicate = false\r\n    let dicomList = []\r\n    let patientList = []\r\n    let studyList = []\r\n    let seriesList = []\r\n    let indexKey = 0\r\n\r\n    useEffect(() => {\r\n        // console.log('kkk: ', importSucceed)\r\n        setTimeout(() => {\r\n            setImportSucceedCounter(importSucceed);\r\n        }, 10);\r\n    }, [importSucceed])\r\n    useEffect(() => {\r\n        setTimeout(() => {\r\n            setImportFailedCounter(importFailed);\r\n        }, 10);\r\n    }, [importFailed])\r\n    useEffect(() => {\r\n        setTimeout(() => {\r\n            setImportDuplicatedCounter(importDuplicated);\r\n        }, 10);\r\n    }, [importDuplicated])\r\n\r\n    const creatPatient = (dict, time) => {\r\n        const theDay = dict['00080022'] ? dict['00080022'].Value[0] : dict['00080020'].Value[0]\r\n        const theTime = dict['00080032'] ? dict['00080032'].Value[0] : dict['00080030'].Value[0]\r\n        try {\r\n            // patientList.push(\r\n            return {\r\n                    key: keyFormat(dict['00100020'].Value[0] + '_'+ theDay),\r\n                    patientName: dict['00100010'].Value[0],\r\n                    patientID: dict['00100020'].Value[0],\r\n                    patientGender: dict['00100040'].Value[0],\r\n                    patientBirthday: dict['00100030'].Value[0],\r\n                    acquisitionDate: dicomDateTimeToLocale(theDay + '.' + theTime),\r\n                    institution: dict['00080080'] ? dict['00080080'].Value[0] : 'No Institution',\r\n                    deviceManufacturer: dict['00080070'].Value[0],\r\n                    deviceModelName: dict['00081090'] ? dict['00081090'].Value[0] : 'No Model Name',\r\n                    addTime: time,\r\n                    studyNum: 0,\r\n                    studyInfo: []\r\n                }\r\n            // )\r\n\r\n        } catch (err) {\r\n            // console.log('patient err: ', err)\r\n            // return false\r\n        }\r\n    }\r\n    const createStudy = (dict, time) => {\r\n        const theDay = dict['00080022'] ? dict['00080022'].Value[0] : dict['00080020'].Value[0]\r\n        const theTime = dict['00080032'] ? dict['00080032'].Value[0] : dict['00080030'].Value[0]\r\n        try {\r\n            // studyList.push(\r\n               return  {\r\n                key: dict['00100020'].Value[0] + '_' + dict['00200010'].Value[0],\r\n                patientID: dict['00100020'].Value[0],\r\n                acquisitionDate:  dicomDateTimeToLocale(theDay + '.' + theTime),\r\n                seriesInfo: [],\r\n                studyID: studyIDFormat(dict),\r\n                studyDescription: dict['00081030'].Value[0],\r\n                addTime: time,\r\n                sequenceNum: 0\r\n            }\r\n            // )\r\n        } catch (err) {\r\n            // console.log('study err: ', err)\r\n            // return false\r\n        }\r\n    }\r\n    const createSeries = (dict, time) => {\r\n        const theDay = dict['00080022'] ? dict['00080022'].Value[0] : dict['00080020'].Value[0]\r\n        const theTime = dict['00080032'] ? dict['00080032'].Value[0] : dict['00080030'].Value[0]\r\n\r\n        try {\r\n            // seriesList.push(\r\n               return  {\r\n                key: dict['00100020'].Value[0] + '_' + dict['00200011'].Value[0],\r\n                studyID: studyIDFormat(dict),\r\n                seriesNo: seriesNoFormat(dict),\r\n                seriesDescription: dict['0008103E'].Value[0],\r\n                layer: dict['00180050'].Value[0] + 'mm',\r\n                modality: dict['00080060'].Value[0],\r\n                acquisitionDate:  dicomDateTimeToLocale(theDay + '.' + theTime),\r\n                size: dict['00280010'].Value[0] + ' x ' + dict['00280011'].Value[0],\r\n                addTime: time,\r\n                patientInfo: {\r\n                    patientName: dict['00100010'].Value[0],\r\n                    patientID: dict['00100020'].Value[0],\r\n                    patientGender: dict['00100040'].Value[0],\r\n                    patientBirthday: dict['00100030'].Value[0],\r\n                },\r\n                instanceNumber: [],\r\n                framePath: [],\r\n                frameNum: 0\r\n            }\r\n            // )\r\n        } catch (err) {\r\n            // console.log('series err: ', err)\r\n            // return false\r\n        }\r\n        // console.log(\"seriesList: \", seriesList)\r\n    }\r\n    const createInstance = (dict, path,time) => {\r\n        const theDay = dict['00080022'] ? dict['00080022'].Value[0] : dict['00080020'].Value[0]\r\n        const theTime = dict['00080032'] ? dict['00080032'].Value[0] : dict['00080030'].Value[0]\r\n\r\n        try {\r\n           return  {\r\n                key: dict['00100020'].Value[0] + '_' + dict['00200011'].Value[0],\r\n                studyID: studyIDFormat(dict),\r\n               seriesNo: seriesNoFormat(dict),\r\n               specialID: dict['00200013'].Value[0] + dict['0020000E'].Value[0],\r\n                instanceNumber: dict['00200013'].Value[0],\r\n                seriesInstanceUID: dict['0020000E'].Value[0],\r\n                framePath: path,\r\n                acquisitionDate:  dicomDateTimeToLocale(theDay + '.' + theTime),\r\n                addTime: time\r\n            }\r\n        } catch (err) {\r\n            // console.log('series err: ', err)\r\n            // return false\r\n        }\r\n    }\r\n\r\n    const checkDICOMIntegrity = (dict) => {\r\n        const now = new Date().toLocaleString()\r\n        const patientPartInLocal = creatPatient(dict, now)\r\n        const studyPartInLocal = createStudy(dict, now)\r\n        const seriesPartInLocal = createSeries(dict, now)\r\n        return patientPartInLocal && studyPartInLocal && seriesPartInLocal\r\n    }\r\n\r\n    const createDBTables= (dict) => {\r\n        const now = new Date().toLocaleString()\r\n        indexKey++\r\n        const patientPartInLocal = creatPatient(dict, now)\r\n        const studyPartInLocal = createStudy(dict, now)\r\n        const seriesPartInLocal = createSeries(dict, now)\r\n        isSeriesDuplicate=false\r\n        // check whether the patientID of upload file is existed in whole files\r\n        const indexPatient = patientList.findIndex( x => x.patientID === dict['00100020'].Value[0])\r\n        const indexStudy = studyList.findIndex( x => x.studyID === studyIDFormat(dict))\r\n        const indexSeries = seriesList.findIndex( x => x.seriesNo === seriesNoFormat(dict))\r\n\r\n        if (patientPartInLocal && studyPartInLocal && seriesPartInLocal) { // file is correct\r\n            if (indexPatient === -1) {\r\n                patientList.push(patientPartInLocal)\r\n            }\r\n            if (indexStudy === -1) {\r\n                studyList.push(studyPartInLocal)\r\n            }\r\n            if (indexSeries === -1) {\r\n                seriesList.push(seriesPartInLocal)\r\n            }\r\n            setImportSucceed(prev => prev + 1)\r\n        } else {\r\n            setImportFailed(prev => prev + 1)\r\n        }\r\n    }\r\n\r\n    const studyIDFormat = (dict) => {\r\n        try {\r\n            return dict['00200010'].Value[0] + '_' + dict['0020000D'].Value[0]\r\n        } catch (err) {\r\n            // console.log('studyID err: ', err)\r\n        }\r\n    }\r\n    const seriesNoFormat = (dict) => {\r\n        try {\r\n            return dict['00200011'].Value[0] + '_' + dict['0020000E'].Value[0]\r\n        } catch (err) {\r\n            // console.log('seriesNo err: ', err)\r\n        }\r\n    }\r\n\r\n    const DicomBuilder = () => {\r\n        studyList.forEach(studyEle => {\r\n            seriesList.forEach(sEle => {\r\n                if (studyEle.studyID === sEle.studyID) {\r\n                    studyEle.sequenceNum ++\r\n                    studyEle.seriesInfo.push(sEle)\r\n                }\r\n            })\r\n        })\r\n        patientList.forEach(pEle => {\r\n            studyList.forEach(studyEle => {\r\n                if (pEle.patientID === studyEle.patientID) {\r\n                    pEle.studyNum ++\r\n                    pEle.studyInfo.push(studyEle)\r\n                }\r\n            })\r\n        })\r\n    }\r\n\r\n    const importHandler = () => {\r\n        let inputObj = null\r\n        if (document.getElementById('_ef')) {\r\n            inputObj = document.getElementById('_ef')\r\n            // remove the existed input element and eventListener\r\n            inputObj.removeEventListener('change', function () {})\r\n            document.body.removeChild(inputObj)\r\n        }\r\n        inputObj = document.createElement('input')\r\n        // 设置属性\r\n        inputObj.setAttribute('id', '_ef')\r\n        inputObj.setAttribute('type', 'file')\r\n        inputObj.setAttribute('accept', '*/dicom,.dcm, image/dcm, */dcm, .dicom')\r\n        inputObj.setAttribute('multiple', '')\r\n        inputObj.setAttribute('style', 'visibility:hidden')\r\n        inputObj.setAttribute('webkitdirectory', '')\r\n        inputObj.setAttribute('directory', '')\r\n        // 添加到DOM中\r\n        document.body.appendChild(inputObj)\r\n\r\n        // 添加事件监听器\r\n        inputObj.addEventListener('change', openDir)\r\n        // // 模拟点击\r\n        inputObj.click()\r\n    }\r\n    // const getDicomFromDB = (objects) => {\r\n    //     props.addDicomFromUpload([...objects])\r\n    // }\r\n    const checkDICMType = (file, dicmBox) => {\r\n        let reader = new FileReader();\r\n        return new Promise((resolve, reject) => {\r\n            reader.readAsArrayBuffer(file);\r\n            reader.onload = (evt) => {\r\n                if (evt.target.readyState === FileReader.DONE) {\r\n                    let array = new Uint8Array(evt.target.result);\r\n                    let s = \"\";\r\n                    let start = 128, end = 132;\r\n                    for (let i = start; i < end; ++i) {\r\n                        s += String.fromCharCode(array[i]);\r\n                    }\r\n                    if (s == \"DICM\") {\r\n                        dicmBox.push(file)\r\n                        resolve(file)\r\n                    } else {\r\n                        resolve(null)\r\n                        console.log(file.name,' is not dicom')\r\n                    }\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    const openDir = () => {\r\n\r\n        // console.log(files)\r\n        props.setLoading(1)\r\n        setImportSucceed(0)\r\n        setImportFailed(0)\r\n        setFileAmount(0)\r\n        setImportDuplicated(0)\r\n        querySeriesByStudyID(null, uploadData)\r\n    }\r\n\r\n    const createInstanceList = (list) => {\r\n        const now = new Date().toLocaleString()\r\n        queryInstanceData(res => {\r\n            console.log(res)\r\n            const decodeFileList = []\r\n            list.forEach(ele => {\r\n                const dicomDict = readFileInfo(ele)\r\n                const dict = dicomDict['dict']\r\n                const meta = dicomDict['meta']\r\n                const dicomTypeList = getDicomType()\r\n                const dicomType = dicomTypeList[meta['00020002']['Value'][0]].ciod\r\n                if ( dicomType !== 'CT Image') {\r\n                    setImportFailed(prev => prev + 1)\r\n                } else {\r\n                    const instanceNumber = dict['00200013'].Value[0]\r\n                    const seriesInstanceUID = dict['0020000E'].Value[0]\r\n                    if ((dicomList.length == 0 || dicomList.filter(e => e.specialID === instanceNumber + seriesInstanceUID).length == 0) &&\r\n                        res.filter(e => e.specialID === instanceNumber + seriesInstanceUID).length == 0\r\n                    ) {\r\n                        if (checkDICOMIntegrity(dict)) {\r\n                            dicomList.push(createInstance(dict, ele.path,now))\r\n                            decodeFileList.push(dict)\r\n                        } else {\r\n                            setImportFailed(prev => prev + 1)\r\n                        }\r\n                    } else if (dicomList.filter(e => e.specialID === instanceNumber + seriesInstanceUID).length > 0 ||\r\n                        res.filter(e => e.specialID === instanceNumber + seriesInstanceUID).length > 0) {\r\n                        setImportDuplicated(prev => prev + 1)\r\n                        isSeriesDuplicate = true\r\n                    }\r\n                }\r\n            })\r\n\r\n            insertData(SQLContainer.insertInstanceSql, dicomList,(res) => {\r\n                // console.log(res)\r\n                // const innerPromises =[]\r\n                decodeFileList.forEach(ele => {\r\n                    // innerPromises.push(createDBTables(ele))\r\n                    createDBTables(ele)\r\n                })\r\n                // Promise.all(innerPromises).then(innerRes=> {\r\n                //     console.log('finished')\r\n                    DicomBuilder()\r\n                    console.log('list: ', patientList, ', d: ', studyList,', s: ', seriesList)\r\n                    if (patientList.length > 0 && studyList.length > 0 && seriesList.length > 0) {\r\n                        insertData(SQLContainer.insertPatientSql, patientList);\r\n                        insertData(SQLContainer.insertStudySql, studyList);\r\n                        // seriesList.forEach(ele => {\r\n                        //     ele.framePath = ele.framePath.toString()\r\n                        //     ele.instanceNumber = ele.instanceNumber.toString()\r\n                        // })\r\n                        // console.log('s: ',seriesList)\r\n                        insertData(SQLContainer.insertSeriesSql, seriesList, props.removeDuplicates);\r\n                        // props.setLoading(2)\r\n                    } else if (isSeriesDuplicate) {\r\n                        props.setLoading(2)\r\n                    } else {\r\n                        message.warning(`所导入的DICOM文件不是有效的文件`)\r\n                        props.setLoading(0)\r\n                    }\r\n                // })\r\n            })\r\n        })\r\n    }\r\n\r\n\r\n    const uploadData = (allSeries) => {\r\n        const inputObj = document.getElementById('_ef')\r\n        const files = inputObj.files\r\n\r\n        try {\r\n            // console.log('allSeries', allSeries)\r\n            // 临时变量的值赋给输出路径\r\n            // this.dirPath = files\r\n            if (files.length > 0) {\r\n                const fileArr = new Set(files)\r\n                const tempArr = Array.from(fileArr)\r\n                // console.log('File list: ', tempArr)\r\n                // check the files are dcm or not\r\n                const promises = []\r\n                const dicmBox = []\r\n                for(let i of tempArr) {\r\n                    promises.push(checkDICMType(i, dicmBox))\r\n                }\r\n                Promise.all(promises).then(res=> {\r\n                    // console.log(res,',',dicmBox)\r\n                    if (dicmBox.length > 0) {\r\n                        setFileAmount(dicmBox.length)\r\n                        createInstanceList(dicmBox)\r\n                        // console.log(dicomList)\r\n                    } else {\r\n                        message.warning(`所选文件夹内没有有效的DICOM文件`)\r\n                        props.setLoading(0)\r\n                    }\r\n                }).catch(reason => {\r\n                    console.log(reason)\r\n                    props.setLoading(0)\r\n                })\r\n            }\r\n            // 移除事件监听器\r\n            inputObj.removeEventListener('change', function () {})\r\n            // 从DOM中移除input\r\n            document.body.removeChild(inputObj)\r\n        } catch (error) {\r\n            console.log(error)\r\n            props.setLoading(0)\r\n        }\r\n    }\r\n\r\n    const CDImportHandler = () => {\r\n        setCDVisible(true)\r\n    }\r\n\r\n    const openCDImport = () => {\r\n        setCDVisible(false)\r\n        importHandler()\r\n    }\r\n\r\n  return (\r\n    <div className=\"select-file-box\">\r\n        {props.isLoading > 0 ? (\r\n            <div className=\"mask\">\r\n                <div className=\"maskWhite\">\r\n                    {\r\n                        props.isLoading == 2 ?  <CheckCircleTwoTone twoToneColor=\"#52c41a\" /> : <Spin size=\"large\" />\r\n                    }\r\n                    <div className=\"importProgress\">\r\n                        <div className=\"itemTxt\">\r\n                            DICOM文件数量: {fileAmount <= 0 ? '加载中' : fileAmount}\r\n                        </div>\r\n                        <div className=\"itemTxt\">\r\n                            导入成功: {importSucceedCounter}\r\n                        </div>\r\n                        <div className=\"itemTxt\">\r\n                            导入失败的非标准DICOM: {importFailedCounter}\r\n                        </div>\r\n                        <div className=\"itemTxt\">\r\n                            重复文件: {importDuplicatedCounter}\r\n                            {/*重复文件: {fDup}*/}\r\n                        </div>\r\n                    </div>\r\n                    <Button onClick={e => props.setLoading(0)} type=\"primary\" disabled={props.isLoading < 2}>\r\n                        确定\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n        ) : null}\r\n      <Button onClick={() => {\r\n          importHandler()\r\n      }}>本地导入</Button>\r\n      <Button onClick={() => {\r\n          CDImportHandler()\r\n      }}>光盘导入</Button>\r\n      <div className='about' onClick={() => setVisible(true)}>关于</div>\r\n\r\n        <Modal\r\n            title=\"关于\"\r\n            centered\r\n            visible={visible}\r\n            onOk={() => setVisible(false)}\r\n            onCancel={() => setVisible(false)}\r\n            bodyStyle={{\r\n                height: 400,\r\n            }}\r\n            width={600}\r\n            footer={null}\r\n        >\r\n            <About />\r\n        </Modal>\r\n        <Modal\r\n            title=\"光盘导入提示\"\r\n            centered\r\n            visible={CDVisible}\r\n            onOk={() => setCDVisible(false)}\r\n            onCancel={() => setCDVisible(false)}\r\n            bodyStyle={{\r\n                height: 240,\r\n            }}\r\n            width={600}\r\n            footer={null}\r\n        >\r\n            <div className='cdImport'>\r\n                <ExclamationCircleTwoTone twoToneColor=\"#ffcf00\" />\r\n                <div className='txt'>\r\n                    从光盘中直接导入需要花费数分钟时间，推荐先手动将DICOM文件夹复制到本地硬盘，再用本地导入，则更节省时间。\r\n                    若需要从光盘中导入，点击’确定‘按钮。\r\n                </div>\r\n                <div className='btnGroup'>\r\n                    <Button onClick={e => openCDImport()} type=\"primary\">\r\n                        确定\r\n                    </Button>\r\n                    <Button onClick={() => setCDVisible(false)}>\r\n                        取消\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n        </Modal>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default SelectFile\r\n","import React, { useState, useEffect } from 'react'\r\nimport './StudyList.scss'\r\nimport { Table, Input, Button, message } from 'antd'\r\nimport SelectFile from '../../components/SelectFile/SelectFile'\r\nimport {\r\n  queryStudyByPatientID,\r\n  querySeriesByStudyID,\r\n  queryPatientData,\r\n  removeAllDuplicated,\r\n  queryAllNodeList,\r\n  queryPatientList,\r\n  deleteTableSql,\r\n  queryInstanceByStudyID,\r\n} from '../../util/sqlite'\r\nimport { formatFile, downloadFile, queryPatientAPI, createSeriesAPI } from '../../util/index'\r\nconst dicomColumns = [\r\n  {\r\n    title: '姓名',\r\n    dataIndex: 'patientName',\r\n  },\r\n  {\r\n    title: '性别',\r\n    dataIndex: 'patientGender',\r\n  },\r\n  {\r\n    title: '生日',\r\n    dataIndex: 'patientBirthday',\r\n  },\r\n  {\r\n    title: 'PatientID',\r\n    dataIndex: 'patientID',\r\n  },\r\n  {\r\n    title: '检测次数',\r\n    dataIndex: 'studyNum',\r\n  },\r\n  {\r\n    title: '检查时间',\r\n    dataIndex: 'acquisitionDate',\r\n  },\r\n  {\r\n    title: '添加时间',\r\n    dataIndex: 'addTime',\r\n    defaultSortOrder: 'descend',\r\n    sorter: (a, b) => new Date(a.addTime) - new Date(b.addTime),\r\n  },\r\n  {\r\n    title: '上次修改时间',\r\n    dataIndex: 'LastModifiedTime',\r\n  },\r\n  {\r\n    title: '医院',\r\n    dataIndex: 'institution',\r\n  },\r\n  {\r\n    title: 'CT机品牌型号',\r\n    dataIndex: 'deviceManufacturer',\r\n  },\r\n]\r\n\r\nconst testColumns = [\r\n  {\r\n    title: '检测日期',\r\n    dataIndex: 'acquisitionDate',\r\n  },\r\n  {\r\n    title: '检测ID',\r\n    dataIndex: 'studyID',\r\n    render: (txt) => <span>{txt.split('_')[0]}</span>,\r\n  },\r\n  {\r\n    title: '检测描述',\r\n    dataIndex: 'studyDescription',\r\n  },\r\n  {\r\n    title: '序列数',\r\n    dataIndex: 'sequenceNum',\r\n  },\r\n  {\r\n    title: '添加时间',\r\n    dataIndex: 'addTime',\r\n    defaultSortOrder: 'descend',\r\n    sorter: (a, b) => new Date(a.addTime) - new Date(b.addTime),\r\n  },\r\n]\r\n\r\nconst listColumns = [\r\n  {\r\n    title: '序列号',\r\n    dataIndex: 'seriesNo',\r\n    render: (txt) => <span>{txt.split('_')[0]}</span>,\r\n  },\r\n  {\r\n    title: '序列描述',\r\n    dataIndex: 'seriesDescription',\r\n  },\r\n  {\r\n    title: '层厚',\r\n    dataIndex: 'layer',\r\n  },\r\n  {\r\n    title: '形式',\r\n    dataIndex: 'modality',\r\n  },\r\n  {\r\n    title: '影像大小',\r\n    dataIndex: 'size',\r\n  },\r\n  {\r\n    title: '帧数',\r\n    dataIndex: 'frameNum',\r\n  },\r\n  {\r\n    title: '添加时间',\r\n    dataIndex: 'acquisitionDate',\r\n  },\r\n]\r\n\r\nconst StudyList = props => {\r\n  const [patientData, setPatientData] = useState([])\r\n  const [studyData, setStudyData] = useState([])\r\n  const [seriesData, setSeriesData] = useState([])\r\n  const [selectedData, setSelectedData] = useState([])\r\n  const [isLoading, setLoading] = useState(0)\r\n  const [selectedRows, setSelectedRows] = useState([])\r\n  const [searchData, setSearchData] = useState('')\r\n\r\n  useEffect(() => {\r\n    // queryPatientData(getDicomFromDB)\r\n    if (!isLoading) {\r\n      setLoading(1)\r\n      queryPatientAPI().then(res => {\r\n        getDicomFromDB(res[\"data\"])\r\n        setLoading(0)\r\n      }).catch(err => {\r\n        console.log(err)\r\n      })\r\n    }\r\n\r\n    createSeriesAPI().then(res => {\r\n      // console.log('res: ', res)\r\n    }).catch(err => {\r\n      console.log(err)\r\n    })\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [])\r\n\r\n  const getDicomFromDB = objects => {\r\n    setPatientData(objects)\r\n  }\r\n\r\n  const addDicomFromUpload = objects => {\r\n    setPatientData(patientData.concat(objects))\r\n  }\r\n\r\n  const getStudyFromDB = objects => {\r\n    setStudyData(objects)\r\n  }\r\n\r\n  const getSeriesFromDB = (objects, loading, isSeriesGetAll) => {\r\n    if (objects.length > 0) {\r\n      queryInstanceByStudyID(objects[0].studyID, (res) => {\r\n        // console.log(res)\r\n        objects.forEach(ele => {\r\n          const framePath = []\r\n          const instanceNumber = []\r\n          res.forEach(x => {\r\n            if (ele.seriesNo === x.seriesNo) {\r\n              framePath.push(x.framePath)\r\n              instanceNumber.push(x.instanceNumber)\r\n              ele.frameNum ++\r\n            }\r\n          })\r\n          ele.instanceNumber = sortPathByInstanceNumber(instanceNumber, framePath, 0)\r\n          ele.framePath = sortPathByInstanceNumber(instanceNumber, framePath, 1)\r\n          // console.log(ele)\r\n        })\r\n        setSeriesData(objects)\r\n        if (isSeriesGetAll) {\r\n          seriesGetAll(objects)\r\n        }\r\n        if (loading) {\r\n          setLoading(2)\r\n        }\r\n      })\r\n    } else {\r\n      setSeriesData(objects)\r\n      if (loading) {\r\n        setLoading(2)\r\n      }\r\n    }\r\n  }\r\n\r\n  const sortPathByInstanceNumber = (instanceNumbers, paths, returnIndex) => {\r\n    const indices = [...instanceNumbers.keys()]\r\n    indices.sort((x,y) => instanceNumbers[x] - instanceNumbers[y])\r\n    paths = indices.map(i=>paths[i])\r\n    instanceNumbers = indices.map(i=>instanceNumbers[i])\r\n    if (returnIndex === 0) {\r\n      return instanceNumbers\r\n    } else if (returnIndex === 1) {\r\n      return paths\r\n    }\r\n  }\r\n\r\n  const patientRowClicked = record => {\r\n    if (selectedData.patientID !== record.patientID) {\r\n      setSeriesData(null)\r\n    }\r\n    queryStudyByPatientID(record.patientID, getStudyFromDB)\r\n    setSelectedData(record)\r\n  }\r\n\r\n  const getAllByPatientID = studyList => {\r\n    selectedData.studyInfo = studyList[0]\r\n    querySeriesByStudyID(selectedData.studyInfo.studyID, e => getSeriesFromDB(e, false, true))\r\n  }\r\n\r\n  const patientGetAll = record => {\r\n    queryStudyByPatientID(record.patientID, getAllByPatientID)\r\n  }\r\n\r\n  const studyGetAll = record => {\r\n    selectedData.studyInfo = record\r\n    querySeriesByStudyID(record.studyID, e => getSeriesFromDB(e, false, true))\r\n  }\r\n\r\n  const seriesGetAll = (seriesList, selectedIndex) => {\r\n    if (selectedIndex || selectedIndex === 0) {\r\n      selectedData.seriesInfo = Array.isArray(seriesData) ? seriesData : [seriesData]\r\n      selectedData.seriesInfo[selectedIndex].active = true\r\n    } else {\r\n      selectedData.seriesInfo = Array.isArray(seriesList) ? seriesList : [seriesList]\r\n      selectedData.seriesInfo[0].active = true\r\n    }\r\n    const promises = []\r\n    selectedData.seriesInfo.forEach(ele => {\r\n      ele.imageIDList = formatFile(ele.framePath)\r\n      promises.push(ele.imageIDList)\r\n    })\r\n    Promise.all(promises).then(res => {\r\n      // check if file is inexistent when path is exists in DB\r\n      if (res.findIndex(x => x == undefined) >= 0) {\r\n        console.log('no file be found')\r\n      } else {\r\n        // set the dcm image as cover\r\n        res.forEach((ele, index) => {\r\n          selectedData.seriesInfo[index].cover = ele[0]\r\n        })\r\n        props.setData(selectedData)\r\n        // console.log('all: ', selectedData)\r\n        props.setShowViewer(true)\r\n      }\r\n    })\r\n  }\r\n\r\n  const studyRowClicked = (record, index) => {\r\n    querySeriesByStudyID(record.studyID, getSeriesFromDB)\r\n  }\r\n\r\n  const seriesRowClicked = (record, index) => {\r\n    // console.log('index: ', index, 'row: ', record)\r\n  }\r\n\r\n  const rowSelection = {\r\n    onChange: (selectedRowKeys, selectedRows) => {\r\n      setSelectedRows(selectedRows)\r\n    },\r\n    getCheckboxProps: record => ({\r\n      // disabled: record.name === 'Disabled User',\r\n      // Column configuration not to be checked\r\n      name: record.name,\r\n    }),\r\n  }\r\n  const removeDuplicates = () => {\r\n    removeAllDuplicated(getDicomFromDB)\r\n    // 关闭 study 和 series 列表，需要手动打开\r\n    getStudyFromDB([])\r\n    getSeriesFromDB([], true)\r\n  }\r\n\r\n  // 导出结节信息\r\n  const handleExport = () => {\r\n    if (selectedRows.length === 0) {\r\n      message.warn(`请先选择需要导出的病人`)\r\n    }\r\n\r\n    selectedRows.forEach(item => {\r\n      queryAllNodeList(item.patientID, res => {\r\n        const exportData = []\r\n        for (let i = 0; i < res.length; i++) {\r\n          exportData.push({\r\n            patientID: res[i].patientID,\r\n            seriesNo: res[i].seriesNo,\r\n            imageIndex: res[i].imageIndex,\r\n            nodeBox: res[i].nodeBox,\r\n          })\r\n        }\r\n        const fileName = `病人ID-${item.patientID}`\r\n        downloadFile(exportData, fileName)\r\n      })\r\n    })\r\n  }\r\n\r\n  const handleSearch = (type) => {\r\n    if (type === 'reset') {\r\n      setSearchData('')\r\n    }\r\n    queryPatientList(type === 'reset' ? '' : searchData, res => {\r\n      console.log(res)\r\n      getDicomFromDB(res)\r\n      getStudyFromDB([])\r\n      getSeriesFromDB([])\r\n    })\r\n  }\r\n\r\n  const selectedRowStyle = (record, index) => {\r\n    let resource = null\r\n    switch (index) {\r\n      case 0:\r\n        resource = patientData\r\n        break;\r\n      case 1:\r\n        resource = studyData\r\n        break;\r\n      case 2:\r\n        resource = seriesData\r\n        break;\r\n    }\r\n    resource.forEach(ele => {\r\n      ele.styleActive = false\r\n      if (ele.key === record.key) {\r\n        ele.styleActive = true\r\n      }\r\n    })\r\n    if (index === 2) {\r\n      setSeriesData([...resource])\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"study-list-container\">\r\n      <div>\r\n        <SelectFile\r\n          setPatientData={setPatientData}\r\n          setData={props.setData}\r\n          setLoading={setLoading}\r\n          isLoading={isLoading}\r\n          addDicomFromUpload={addDicomFromUpload}\r\n          removeDuplicates={removeDuplicates}\r\n        />\r\n        <div className=\"search-box-wrap\">\r\n          <div className=\"search-box\">\r\n            <div className=\"search-group\">\r\n              <Input value={searchData} style={{ width: 400 }} placeholder=\"请输入内容进行模糊查询\" onChange={e => setSearchData(e.target.value)} />\r\n            </div>\r\n            <div className=\"search-btns\">\r\n              <Button type=\"primary\" onClick={handleSearch}>检索</Button>\r\n              <Button onClick={e=> handleSearch('reset')} type=\"primary\">\r\n                重置\r\n              </Button>\r\n              <Button onClick={e => deleteTableSql('dicom_patient')} type=\"primary\">\r\n                      删除 patient\r\n                    </Button>\r\n                    <Button onClick={e => deleteTableSql('dicom_study')} type=\"primary\">\r\n                      删除 study\r\n                    </Button>\r\n                    <Button onClick={e => deleteTableSql('dicom_series')} type=\"primary\">\r\n                      删除 series\r\n                    </Button>\r\n                    <Button onClick={e => deleteTableSql('dicom_instance')} type=\"primary\">\r\n                      删除 instance\r\n                    </Button>\r\n              {/*<Button onClick={e => setLoading(1)} type=\"primary\">*/}\r\n              {/*  loading*/}\r\n              {/*</Button>*/}\r\n              {/*<Select defaultValue={10} style={{ width: 120 }} onChange={e => changeTimeInterval(e)}>*/}\r\n              {/*  <Option value={10}>10</Option>*/}\r\n              {/*  <Option value={20}>20</Option>*/}\r\n              {/*  <Option value={30}>30</Option>*/}\r\n              {/*  <Option value={45}>45</Option>*/}\r\n              {/*</Select>*/}\r\n                    {/*<Button onClick={e => changeTimeInterval(20)} type=\"primary\">*/}\r\n                    {/*  changeTimeInterval*/}\r\n                    {/*</Button>*/}\r\n                    {/*<Button onClick={e => removeDuplicates } type=\"primary\">*/}\r\n                    {/*  去重 Patient*/}\r\n                    {/*</Button>*/}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"table-box\">\r\n          <header className=\"export-box\">\r\n            <span>DICOM记录</span>\r\n            <Button onClick={handleExport}>导出结节信息</Button>\r\n          </header>\r\n          <Table\r\n            rowSelection={{\r\n              ...rowSelection,\r\n            }}\r\n            columns={dicomColumns}\r\n            dataSource={patientData}\r\n            showSorterTooltip={false}\r\n            size={'small'}\r\n            rowClassName={(record, index) => record['styleActive'] ? 'rowClick' : '' }\r\n            onRow={record => {\r\n              return {\r\n                onClick: () => {\r\n                  patientRowClicked(record)\r\n                  selectedRowStyle(record, 0)\r\n                },\r\n                onDoubleClick: event => {\r\n                  // console.log('Patient list: ', patientData)\r\n                  patientGetAll(record)\r\n                },\r\n              }\r\n            }}\r\n          />\r\n        </div>\r\n        <div className=\"table-box\">\r\n          <header>检测记录</header>\r\n          <Table\r\n            columns={testColumns}\r\n            dataSource={studyData}\r\n            showSorterTooltip={false}\r\n            size={'small'}\r\n            rowClassName={(record, index) => record['styleActive'] ? 'rowClick' : '' }\r\n            onRow={(record, index) => {\r\n              return {\r\n                onClick: () => {\r\n                  studyRowClicked(record, index)\r\n                  selectedRowStyle(record, 1)\r\n                },\r\n                onDoubleClick: event => {\r\n                  studyGetAll(record)\r\n                },\r\n              }\r\n            }}\r\n          />\r\n        </div>\r\n        <div className=\"table-box\">\r\n          <header>序列清单</header>\r\n          <Table\r\n            columns={listColumns}\r\n            dataSource={seriesData}\r\n            size={'small'}\r\n            rowClassName={(record, index) => record['styleActive'] ? 'rowClick' : '' }\r\n            onRow={(record, index) => {\r\n              return {\r\n                onClick: () => {\r\n                  seriesRowClicked(record, index)\r\n                  selectedRowStyle(record, 2)\r\n                },\r\n                onDoubleClick: event => {\r\n                  seriesGetAll(record, index)\r\n                },\r\n              }\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default StudyList\r\n","import React, { useState } from 'react'\r\nimport 'antd/dist/antd.css'\r\nimport './assets/scss/reset.scss'\r\nimport './assets/scss/common.scss'\r\nimport Viewer from './pages/Viewer/Viewer'\r\nimport StudyList from './pages/StudyList/StudyList'\r\n\r\nconst App = () => {\r\n  const [showViewer, setShowViewer] = useState(false)\r\n  const [data, setData] = useState(null)\r\n\r\n  return (\r\n    <div className=\"App\">\r\n      <main>\r\n        {showViewer ? null : <StudyList setShowViewer={setShowViewer} setData={setData} />}\r\n        {showViewer ? <Viewer data={data} setShowViewer={setShowViewer} /> : null}\r\n      </main>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default App\r\n","const reportWebVitals = onPerfEntry => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry)\r\n      getFID(onPerfEntry)\r\n      getFCP(onPerfEntry)\r\n      getLCP(onPerfEntry)\r\n      getTTFB(onPerfEntry)\r\n    })\r\n  }\r\n}\r\n\r\nexport default reportWebVitals\r\n","import dicomParser from 'dicom-parser'\r\nimport cornerstone from 'cornerstone-core'\r\nimport cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader'\r\nimport cornerstoneMath from 'cornerstone-math'\r\nimport cornerstoneTools from 'cornerstone-tools'\r\nimport Hammer from 'hammerjs'\r\n\r\nexport default function initCornerstone() {\r\n  // Cornertone Tools\r\n  cornerstoneTools.external.cornerstone = cornerstone\r\n  cornerstoneTools.external.Hammer = Hammer\r\n  cornerstoneTools.external.cornerstoneMath = cornerstoneMath\r\n\r\n  // 初始化\r\n  cornerstoneTools.init()\r\n\r\n  // Preferences\r\n  const fontFamily =\r\n    'Work Sans, Roboto, OpenSans, HelveticaNeue-Light, Helvetica Neue Light, Helvetica Neue, Helvetica, Arial, Lucida Grande, sans-serif'\r\n  cornerstoneTools.textStyle.setFont(`16px ${fontFamily}`)\r\n  cornerstoneTools.toolStyle.setToolWidth(2)\r\n  cornerstoneTools.toolColors.setToolColor('rgb(255, 255, 0)')\r\n  cornerstoneTools.toolColors.setActiveColor('rgb(0, 255, 0)')\r\n\r\n  cornerstoneTools.store.state.touchProximity = 40\r\n\r\n  // IMAGE LOADER\r\n  cornerstoneWADOImageLoader.external.cornerstone = cornerstone\r\n  cornerstoneWADOImageLoader.external.dicomParser = dicomParser\r\n  cornerstoneWADOImageLoader.webWorkerManager.initialize({\r\n    maxWebWorkers: navigator.hardwareConcurrency || 1,\r\n    startWebWorkersOnDemand: true,\r\n    taskConfiguration: {\r\n      decodeTask: {\r\n        initializeCodecsOnStartup: false,\r\n        usePDFJS: false,\r\n        strict: false,\r\n      },\r\n    },\r\n  })\r\n\r\n  // Debug\r\n  window.cornerstone = cornerstone\r\n  window.cornerstoneTools = cornerstoneTools\r\n  window.dicomParser = dicomParser\r\n}\r\n","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport App from './App'\r\nimport reportWebVitals from './reportWebVitals'\r\nimport initCornerstone from './initCornerstone.js'\r\n\r\n// 初始化\r\ninitCornerstone()\r\n\r\nReactDOM.render(<App />, document.getElementById('root'))\r\n\r\nreportWebVitals()\r\n\r\n\r\n"],"sourceRoot":""}